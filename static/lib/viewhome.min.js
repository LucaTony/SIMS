/*
 * viewhome.min.js  version 1.2
 *
 * Sweet Home 3D, Copyright (c) 2016 Emmanuel PUYBARET / eTeks <info@eteks.com>
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */
function CatalogPieceOfFurniture(n,C,u,z,l,b,a,y,h,e,p,B,m,r,v,d,o,t,k,c,x,i,g,w,A,s,j,f,q){this.id=n;this.name=C;this.description=u;this.information=z;this.tags=l;this.creationDate=b;this.grade=a;this.icon=y;this.planIcon=h;this.model=e;this.width=p;this.depth=B;this.height=m;this.elevation=r;this.dropOnTopElevation=v;this.movable=d;this.doorOrWindow=o;this.color=t;this.staircaseCutOutShape=k;this.creator=i;this.price=s;this.valueAddedTaxPercentage=j;this.currency=f;if(c==null){this.modelRotation=[[1,0,0],[0,1,0],[0,0,1]]}else{this.modelRotation=this.deepCopy(c)}this.resizable=g;this.deformable=w;this.texturable=A;this.backFaceShown=x;this.iconYaw=Math.PI/8;this.proportional=true;this.modifiable=q!==undefined?q:false;this.category=null}CatalogPieceOfFurniture.prototype.getId=function(){return this.id};CatalogPieceOfFurniture.prototype.getName=function(){return this.name};CatalogPieceOfFurniture.prototype.getDescription=function(){return this.description};CatalogPieceOfFurniture.prototype.getInformation=function(){return this.information};CatalogPieceOfFurniture.prototype.getTags=function(){return this.tags};CatalogPieceOfFurniture.prototype.getCreationDate=function(){return this.creationDate};CatalogPieceOfFurniture.prototype.getGrade=function(){return this.grade};CatalogPieceOfFurniture.prototype.getDepth=function(){return this.depth};CatalogPieceOfFurniture.prototype.getHeight=function(){return this.height};CatalogPieceOfFurniture.prototype.getWidth=function(){return this.width};CatalogPieceOfFurniture.prototype.getElevation=function(){return this.elevation};CatalogPieceOfFurniture.prototype.getDropOnTopElevation=function(){return this.dropOnTopElevation};CatalogPieceOfFurniture.prototype.isMovable=function(){return this.movable};CatalogPieceOfFurniture.prototype.isDoorOrWindow=function(){return this.doorOrWindow};CatalogPieceOfFurniture.prototype.getIcon=function(){return this.icon};CatalogPieceOfFurniture.prototype.getPlanIcon=function(){return this.planIcon};CatalogPieceOfFurniture.prototype.getModel=function(){return this.model};CatalogPieceOfFurniture.prototype.getModelRotation=function(){return this.deepCopy(this.modelRotation)};CatalogPieceOfFurniture.prototype.deepCopy=function(a){return[[a[0][0],a[0][1],a[0][2]],[a[1][0],a[1][1],a[1][2]],[a[2][0],a[2][1],a[2][2]]]};CatalogPieceOfFurniture.prototype.getStaircaseCutOutShape=function(){return this.staircaseCutOutShape};CatalogPieceOfFurniture.prototype.getCreator=function(){return this.creator};CatalogPieceOfFurniture.prototype.isBackFaceShown=function(){return this.backFaceShown};CatalogPieceOfFurniture.prototype.getColor=function(){return this.color};CatalogPieceOfFurniture.prototype.getIconYaw=function(){return this.iconYaw};CatalogPieceOfFurniture.prototype.isProportional=function(){return this.proportional};CatalogPieceOfFurniture.prototype.isModifiable=function(){return this.modifiable};CatalogPieceOfFurniture.prototype.isResizable=function(){return this.resizable};CatalogPieceOfFurniture.prototype.isDeformable=function(){return this.deformable};CatalogPieceOfFurniture.prototype.isTexturable=function(){return this.texturable};CatalogPieceOfFurniture.prototype.getPrice=function(){return this.price};CatalogPieceOfFurniture.prototype.getValueAddedTaxPercentage=function(){return this.valueAddedTaxPercentage};CatalogPieceOfFurniture.prototype.getCurrency=function(){return this.currency};CatalogPieceOfFurniture.prototype.getCategory=function(){return this.category};CatalogPieceOfFurniture.prototype.setCategory=function(a){this.category=a};CatalogPieceOfFurniture.compare=function(c,b){var a=c.name.localeCompare(b.name);if(a!=0){return a}else{return c.modifiable==b.modifiable?0:(c.modifiable?1:-1)}};CatalogPieceOfFurniture.prototype.matchesFilter=function(c){var d=new RegExp(c,"i");if(this.getName().match(d)||this.getCategory()!==null&&this.getCategory().getName().match(d)||this.getDescription()!==null&&this.getDescription().match(d)||this.getCreator()!==null&&this.getCreator().match(d)){return true}else{var a=this.getTags();for(var b=0;b<a.length;b++){if(a[b].match(d)){return true}}}return false};function CatalogTexture(g,c,f,e,a,d,b){this.id=g;this.name=c;this.image=f;this.width=e;this.height=a;this.creator=d;this.modifiable=b!==undefined?b:false;this.category=null}CatalogTexture.prototype.getId=function(){return this.id};CatalogTexture.prototype.getName=function(){return this.name};CatalogTexture.prototype.getImage=function(){return this.image};CatalogTexture.prototype.getIcon=function(){return this.getImage()};CatalogTexture.prototype.getWidth=function(){return this.width};CatalogTexture.prototype.getHeight=function(){return this.height};CatalogTexture.prototype.getCreator=function(){return this.creator};CatalogTexture.prototype.isModifiable=function(){return this.modifiable};CatalogTexture.prototype.getCategory=function(){return this.category};CatalogTexture.prototype.setCategory=function(a){this.category=a};CatalogTexture.compare=function(a,c){var b=a.name.localeCompare(c.name);if(b!=0){return b}else{return a.modifiable==c.modifiable?0:(a.modifiable?1:-1)}};CatalogTexture.prototype.matchesFilter=function(c){var d=new RegExp(c,"i");if(this.getName().match(d)||this.getCategory()!==null&&this.getCategory().getName().match(d)||this.getCreator()!==null&&this.getCreator().match(d)){return true}else{var a=this.getTags();for(var b=0;b<a.length;b++){if(a[b].match(d)){return true}}}return false};function HomeObject(){}HomeObject.prototype.getProperty=function(a){if(this.hasOwnProperty("properties")){return this.properties[a]}else{return null}};HomeObject.prototype.setProperty=function(a,b){if(b===null){if(this.hasOwnProperty("properties")&&this.properties.hasOwnProperty(a)){delete this.properties[a]}}else{if(!this.hasOwnProperty("properties")){this.properties={}}this.properties[a]=b}};HomeObject.prototype.getPropertyNames=function(){if(this.hasOwnProperty("properties")){return Object.keys(this.properties)}else{return[]}};HomeObject.prototype.clone=function(){var a=new HomeObject();this.duplicateAttributes(a);return a};HomeObject.prototype.duplicateAttributes=function(a){if(this.hasOwnProperty("properties")){a.properties={};for(var b in this.properties){if(this.properties.hasOwnProperty(b)){a.properties[b]=this.properties[b]}}}};function HomePieceOfFurniture(a){this.name=a.getName();this.level=null;this.description=a.getDescription();this.information=a.getInformation();this.icon=a.getIcon();this.planIcon=a.getPlanIcon();this.model=a.getModel();this.width=a.getWidth();this.depth=a.getDepth();this.height=a.getHeight();this.elevation=a.getElevation();this.dropOnTopElevation=a.getDropOnTopElevation();this.movable=a.isMovable();this.doorOrWindow=a.isDoorOrWindow();this.color=a.getColor();this.modelRotation=a.getModelRotation();this.staircaseCutOutShape=a.getStaircaseCutOutShape();this.creator=a.getCreator();this.backFaceShown=a.isBackFaceShown();this.resizable=a.isResizable();this.deformable=a.isDeformable();this.texturable=a.isTexturable();this.price=a.getPrice();this.valueAddedTaxPercentage=a.getValueAddedTaxPercentage();this.currency=a.getCurrency();if(a instanceof HomePieceOfFurniture){this.catalogId=a.getCatalogId();this.nameVisible=a.isNameVisible();this.nameXOffset=a.getNameXOffset();this.nameYOffset=a.getNameYOffset();this.nameAngle=a.getNameAngle();this.nameStyle=a.getNameStyle();this.visible=a.isVisible();this.angle=a.getAngle();this.x=a.getX();this.y=a.getY();this.modelMirrored=a.isModelMirrored();this.texture=a.getTexture();this.shininess=a.getShininess();this.modelMaterials=a.getModelMaterials()}else{if(a instanceof CatalogPieceOfFurniture){this.catalogId=a.getId()}else{this.catalogId=null}this.nameVisible=false;this.nameXOffset=0;this.nameYOffset=0;this.nameAngle=0;this.nameStyle=null;this.visible=true;this.angle=0;this.x=this.width/2;this.y=this.depth/2;this.modelMirrored=false;this.texture=null;this.shininess=0;this.modelMaterials=null}this.propertyChangeSupport=new PropertyChangeSupport(this);this.shapeCache=null}HomePieceOfFurniture.prototype=Object.create(HomeObject.prototype);HomePieceOfFurniture.prototype.constructor=HomePieceOfFurniture;HomePieceOfFurniture.TWICE_PI=2*Math.PI;HomePieceOfFurniture.IDENTITY=[[1,0,0],[0,1,0],[0,0,1]];HomePieceOfFurniture.prototype.addPropertyChangeListener=function(a){this.propertyChangeSupport.addPropertyChangeListener(a)};HomePieceOfFurniture.prototype.removePropertyChangeListener=function(a){this.propertyChangeSupport.removePropertyChangeListener(a)};HomePieceOfFurniture.prototype.getCatalogId=function(){return this.catalogId};HomePieceOfFurniture.prototype.getName=function(){return this.name};HomePieceOfFurniture.prototype.setName=function(a){if(a!=this.name){var b=this.name;this.name=a;this.propertyChangeSupport.firePropertyChange("NAME",b,a)}};HomePieceOfFurniture.prototype.isNameVisible=function(){return this.nameVisible};HomePieceOfFurniture.prototype.setNameVisible=function(a){if(a!==this.nameVisible){this.nameVisible=a;this.propertyChangeSupport.firePropertyChange("NAME_VISIBLE",!a,a)}};HomePieceOfFurniture.prototype.getNameXOffset=function(){return this.nameXOffset};HomePieceOfFurniture.prototype.setNameXOffset=function(a){if(a!==this.nameXOffset){var b=this.nameXOffset;this.nameXOffset=a;this.propertyChangeSupport.firePropertyChange("NAME_X_OFFSET",b,a)}};HomePieceOfFurniture.prototype.getNameYOffset=function(){return this.nameYOffset};HomePieceOfFurniture.prototype.setNameYOffset=function(a){if(a!==this.nameYOffset){var b=this.nameYOffset;this.nameYOffset=a;this.propertyChangeSupport.firePropertyChange("NAME_Y_OFFSET",b,a)}};HomePieceOfFurniture.prototype.getNameStyle=function(){return this.nameStyle};HomePieceOfFurniture.prototype.setNameStyle=function(b){if(b!==this.nameStyle){var a=this.nameStyle;this.nameStyle=b;this.propertyChangeSupport.firePropertyChange("NAME_STYLE",a,b)}};HomePieceOfFurniture.prototype.getNameAngle=function(){return this.nameAngle};HomePieceOfFurniture.prototype.setNameAngle=function(a){a=(a%HomePieceOfFurniture.TWICE_PI+HomePieceOfFurniture.TWICE_PI)%HomePieceOfFurniture.TWICE_PI;if(a!==this.nameAngle){var b=this.nameAngle;this.nameAngle=a;this.propertyChangeSupport.firePropertyChange("NAME_ANGLE",b,a)}};HomePieceOfFurniture.prototype.getDescription=function(){return this.description};HomePieceOfFurniture.prototype.setDescription=function(a){if(a!==this.description){var b=this.description;this.description=a;this.propertyChangeSupport.firePropertyChange("DESCRIPTION",b,a)}};HomePieceOfFurniture.prototype.getInformation=function(){return this.information};HomePieceOfFurniture.prototype.getDepth=function(){return this.depth};HomePieceOfFurniture.prototype.setDepth=function(b){if(this.isResizable()){if(b!==this.depth){var a=this.depth;this.depth=b;this.shapeCache=null;this.propertyChangeSupport.firePropertyChange("DEPTH",a,b)}}else{throw new IllegalStateException("Piece isn't resizable")}};HomePieceOfFurniture.prototype.getHeight=function(){return this.height};HomePieceOfFurniture.prototype.setHeight=function(a){if(this.isResizable()){if(a!==this.height){var b=this.height;this.height=a;this.propertyChangeSupport.firePropertyChange("HEIGHT",b,a)}}else{throw new IllegalStateException("Piece isn't resizable")}};HomePieceOfFurniture.prototype.getWidth=function(){return this.width};HomePieceOfFurniture.prototype.setWidth=function(b){if(this.isResizable()){if(b!==this.width){var a=this.width;this.width=b;this.shapeCache=null;this.propertyChangeSupport.firePropertyChange("WIDTH",a,b)}}else{throw new IllegalStateException("Piece isn't resizable")}};HomePieceOfFurniture.prototype.getElevation=function(){return this.elevation};HomePieceOfFurniture.prototype.getDropOnTopElevation=function(){return this.dropOnTopElevation};HomePieceOfFurniture.prototype.getGroundElevation=function(){if(this.level!==null){return this.elevation+this.level.getElevation()}else{return this.elevation}};HomePieceOfFurniture.prototype.setElevation=function(b){if(b!==this.elevation){var a=this.elevation;this.elevation=b;this.propertyChangeSupport.firePropertyChange("ELEVATION",a,b)}};HomePieceOfFurniture.prototype.isMovable=function(){return this.movable};HomePieceOfFurniture.prototype.setMovable=function(a){if(a!==this.movable){this.movable=a;this.propertyChangeSupport.firePropertyChange("MOVABLE",!a,a)}};HomePieceOfFurniture.prototype.isDoorOrWindow=function(){return this.doorOrWindow};HomePieceOfFurniture.prototype.getIcon=function(){return this.icon};HomePieceOfFurniture.prototype.getPlanIcon=function(){return this.planIcon};HomePieceOfFurniture.prototype.getModel=function(){return this.model};HomePieceOfFurniture.prototype.setModelMaterials=function(d){if(this.isTexturable()){var b=d===null&&this.modelMaterials===null;if(!b){if(d===null||this.modelMaterials===null){b=false}else{for(var c=0;b&&(c<d.length);c++){if(d[c]!==this.modelMaterials[c]){b=false}}}}if(!b){var a=this.modelMaterials;this.modelMaterials=d!==null?d.slice(0):null;this.propertyChangeSupport.firePropertyChange("MODEL_MATERIALS",a,d)}}else{throw new IllegalStateException("Piece isn't texturable")}};HomePieceOfFurniture.prototype.getModelMaterials=function(){if(this.modelMaterials!==null){return this.modelMaterials.slice(0)}else{return null}};HomePieceOfFurniture.prototype.getColor=function(){return this.color};HomePieceOfFurniture.prototype.setColor=function(a){if(this.isTexturable()){if(a!==this.color){var b=this.color;this.color=a;this.propertyChangeSupport.firePropertyChange("COLOR",b,a)}}else{throw new IllegalStateException("Piece isn't texturable")}};HomePieceOfFurniture.prototype.getTexture=function(){return this.texture};HomePieceOfFurniture.prototype.setTexture=function(b){if(this.isTexturable()){if(b!==this.texture&&(b===null||!b.equals(this.texture))){var a=this.texture;this.texture=b;this.propertyChangeSupport.firePropertyChange("TEXTURE",a,b)}}else{throw new IllegalStateException("Piece isn't texturable")}};HomePieceOfFurniture.prototype.getShininess=function(){return this.shininess};HomePieceOfFurniture.prototype.setShininess=function(b){if(this.isTexturable()){if(b!==this.shininess){var a=this.shininess;this.shininess=b;this.propertyChangeSupport.firePropertyChange("SHININESS",a,b)}}else{throw new IllegalStateException("Piece isn't texturable")}};HomePieceOfFurniture.prototype.isResizable=function(){return this.resizable};HomePieceOfFurniture.prototype.isDeformable=function(){return this.deformable};HomePieceOfFurniture.prototype.isTexturable=function(){return this.texturable};HomePieceOfFurniture.prototype.getPrice=function(){return this.price};HomePieceOfFurniture.prototype.setPrice=function(b){if(b!==this.price&&(b===null||!b.eq(this.price))){var a=this.price;this.price=b;this.propertyChangeSupport.firePropertyChange("PRICE",a,b)}};HomePieceOfFurniture.prototype.getValueAddedTaxPercentage=function(){return this.valueAddedTaxPercentage};HomePieceOfFurniture.prototype.getValueAddedTax=function(){if(this.price!==null&&this.valueAddedTaxPercentage!==null){return this.price.times(this.valueAddedTaxPercentage).round(2)}else{return null}};HomePieceOfFurniture.prototype.getPriceValueAddedTaxIncluded=function(){if(this.price!==null&&this.valueAddedTaxPercentage!==null){return this.price.plus(this.getValueAddedTax())}else{return this.price}};HomePieceOfFurniture.prototype.getCurrency=function(){return this.currency};HomePieceOfFurniture.prototype.isVisible=function(){return this.visible};HomePieceOfFurniture.prototype.setVisible=function(a){if(a!==this.visible){this.visible=a;this.propertyChangeSupport.firePropertyChange("VISIBLE",!a,a)}};HomePieceOfFurniture.prototype.getX=function(){return this.x};HomePieceOfFurniture.prototype.setX=function(a){if(a!==this.x){var b=this.x;this.x=a;this.shapeCache=null;this.propertyChangeSupport.firePropertyChange("X",b,a)}};HomePieceOfFurniture.prototype.getY=function(){return this.y};HomePieceOfFurniture.prototype.setY=function(b){if(b!==this.y){var a=this.y;this.y=b;this.shapeCache=null;this.propertyChangeSupport.firePropertyChange("Y",a,b)}};HomePieceOfFurniture.prototype.getAngle=function(){return this.angle};HomePieceOfFurniture.prototype.setAngle=function(b){b=(b%HomePieceOfFurniture.TWICE_PI+HomePieceOfFurniture.TWICE_PI)%HomePieceOfFurniture.TWICE_PI;if(b!==this.angle){var a=this.angle;this.angle=b;this.shapeCache=null;this.propertyChangeSupport.firePropertyChange("ANGLE",a,b)}};HomePieceOfFurniture.prototype.isModelMirrored=function(){return this.modelMirrored};HomePieceOfFurniture.prototype.setModelMirrored=function(a){if(this.isResizable()){if(a!==this.modelMirrored){this.modelMirrored=a;this.propertyChangeSupport.firePropertyChange("MODEL_MIRRORED",!a,a)}}else{throw new IllegalStateException("Piece isn't resizable")}};HomePieceOfFurniture.prototype.getModelRotation=function(){return[[this.modelRotation[0][0],this.modelRotation[0][1],this.modelRotation[0][2]],[this.modelRotation[1][0],this.modelRotation[1][1],this.modelRotation[1][2]],[this.modelRotation[2][0],this.modelRotation[2][1],this.modelRotation[2][2]]]};HomePieceOfFurniture.prototype.getStaircaseCutOutShape=function(){return this.staircaseCutOutShape};HomePieceOfFurniture.prototype.getCreator=function(){return this.creator};HomePieceOfFurniture.prototype.isBackFaceShown=function(){return this.backFaceShown};HomePieceOfFurniture.prototype.getLevel=function(){return this.level};HomePieceOfFurniture.prototype.setLevel=function(b){if(b!==this.level){var a=this.level;this.level=b;this.propertyChangeSupport.firePropertyChange("LEVEL",a,b)}};HomePieceOfFurniture.prototype.isAtLevel=function(c){if(this.level===c){return true}else{if(this.level!==null&&c!==null){var a=this.level.getElevation();var b=c.getElevation();return a===b&&this.level.getElevationIndex()<c.getElevationIndex()||a<b&&this.isTopAtLevel(c)}else{return false}}};HomePieceOfFurniture.prototype.isTopAtLevel=function(b){var a=this.level.getElevation()+this.elevation+this.height;if(this.staircaseCutOutShape!==null){return a>=b.getElevation()}else{return a>b.getElevation()}};HomePieceOfFurniture.prototype.getPoints=function(){var a=new Array(4);var c=this.getShape().getPathIterator(null);for(var b=0;b<a.length;b++){a[b]=[0,0];c.currentSegment(a[b]);c.next()}return a};HomePieceOfFurniture.prototype.intersectsRectangle=function(c,e,a,d){if(typeof Rectangle2D==="undefined"){throw"Missing geom.js"}var b=new Rectangle2D(c,e,0,0);b.add(a,d);return this.getShape().intersects(b)};HomePieceOfFurniture.prototype.containsPoint=function(a,c,b){if(b===0){return this.getShape().contains(a,c)}else{return this.getShape().intersects(a-b,c-b,2*b,2*b)}};HomePieceOfFurniture.prototype.isPointAt=function(b,f,e){var d=this.getPoints();for(var c=0;c<d.length;c++){var a=d[c];if(Math.abs(b-a[0])<=e&&Math.abs(f-a[1])<=e){return true}}return false};HomePieceOfFurniture.prototype.isTopLeftPointAt=function(b,e,d){var c=this.getPoints();var a=Point2D.distanceSq(b,e,c[0][0],c[0][1]);return a<=d*d&&a<Point2D.distanceSq(b,e,c[1][0],c[1][1])&&a<Point2D.distanceSq(b,e,c[3][0],c[3][1])};HomePieceOfFurniture.prototype.isTopRightPointAt=function(a,e,d){var b=this.getPoints();var c=Point2D.distanceSq(a,e,b[1][0],b[1][1]);return c<=d*d&&c<Point2D.distanceSq(a,e,b[0][0],b[0][1])&&c<Point2D.distanceSq(a,e,b[2][0],b[2][1])};HomePieceOfFurniture.prototype.isBottomLeftPointAt=function(a,e,d){var c=this.getPoints();var b=Point2D.distanceSq(a,e,c[3][0],c[3][1]);return b<=d*d&&b<Point2D.distanceSq(a,e,c[0][0],c[0][1])&&b<Point2D.distanceSq(a,e,c[2][0],c[2][1])};HomePieceOfFurniture.prototype.isBottomRightPointAt=function(a,e,d){var b=this.getPoints();var c=Point2D.distanceSq(a,e,b[2][0],b[2][1]);return c<=d*d&&c<Point2D.distanceSq(a,e,b[1][0],b[1][1])&&c<Point2D.distanceSq(a,e,b[3][0],b[3][1])};HomePieceOfFurniture.prototype.isNameCenterPointAt=function(a,c,b){return Math.abs(a-this.getX()-this.getNameXOffset())<=b&&Math.abs(c-this.getY()-this.getNameYOffset())<=b};HomePieceOfFurniture.prototype.getShape=function(){if(typeof Rectangle2D==="undefined"){throw"Missing geom.js"}if(this.shapeCache===null){var a=new Rectangle2D(this.getX()-this.getWidth()/2,this.getY()-this.getDepth()/2,this.getWidth(),this.getDepth());var b=AffineTransform.getRotateInstance(this.getAngle(),this.getX(),this.getY());var d=a.getPathIterator(b);var c=new GeneralPath();c.append(d,false);this.shapeCache=c}return this.shapeCache};HomePieceOfFurniture.prototype.move=function(b,a){this.setX(this.getX()+b);this.setY(this.getY()+a)};HomePieceOfFurniture.prototype.clone=function(){var a=new HomePieceOfFurniture(this);this.duplicateAttributes(a);a.shapeCache=this.shapeCache;return a};function HomeFurnitureGroup(g,d,b,a){HomePieceOfFurniture.call(this,g[0]);if(b===undefined){a=d;var f=g[0];d=f.getAngle();b=false}else{if(a===undefined){var f=b;d=f.getAngle();a=b;b=false}}this.furniture=g.slice(0);var h=true;var c=false;for(var e=0;e<g.length;e++){var j=g[e];h&=j.isMovable();c|=j.isVisible()}this.setName(a);this.setNameVisible(false);this.setNameXOffset(0);this.setNameYOffset(0);this.setNameStyle(null);this.setDescription(null);HomePieceOfFurniture.prototype.setMovable.call(this,h);this.setVisible(c);this.updateLocationAndSize(g,d,true);HomePieceOfFurniture.prototype.setAngle.call(this,d);HomePieceOfFurniture.prototype.setModelMirrored.call(this,b);this.addFurnitureListener()}HomeFurnitureGroup.prototype=Object.create(HomePieceOfFurniture.prototype);HomeFurnitureGroup.prototype.constructor=HomeFurnitureGroup;HomeFurnitureGroup.prototype.updateLocationAndSize=function(l,f,r){this.resizable=true;this.deformable=true;this.texturable=true;this.doorOrWindow=true;this.currency=l[0].getCurrency();for(var k=0;k<l.length;k++){var s=l[k];this.resizable&=s.isResizable();this.deformable&=s.isDeformable();this.texturable&=s.isTexturable();this.doorOrWindow&=s.isDoorOrWindow();if(this.currency!==null){if(s.getCurrency()===null||!s.getCurrency()===this.currency){this.currency=null}}}var p=Number.MAX_VALUE;if(r){var c=null;for(var k=0;k<l.length;k++){var s=l[k];var d=s.getLevel();if(d!==null&&(c===null||d.getElevation()<c.getElevation())){c=d}}for(var k=0;k<l.length;k++){var s=l[k];if(s.getLevel()!==null){p=Math.min(p,s.getGroundElevation()-c.getElevation());s.setElevation(s.getGroundElevation()-c.getElevation());s.setLevel(null)}else{p=Math.min(p,s.getElevation())}}}else{for(var k=0;k<l.length;k++){p=Math.min(p,l[k].getElevation())}}HomePieceOfFurniture.prototype.setElevation.call(this,p);var o=0;var e=-1;for(var k=0;k<l.length;k++){var s=l[k];o=Math.max(o,s.getElevation()+s.getHeight());if(s.getDropOnTopElevation()>=0){e=Math.max(e,s.getElevation()+s.getHeight()*s.getDropOnTopElevation())}}o-=p;e-=p;if(this.resizable){HomePieceOfFurniture.prototype.setHeight.call(this,o)}else{this.fixedHeight=o}this.dropOnTopElevation=e/o;if(typeof Rectangle2D!=="undefined"){var q=AffineTransform.getRotateInstance(-f);var b=null;var n=this.getFurnitureWithoutGroups(l);for(var k=0;k<n.length;k++){var s=n[k];var g=new GeneralPath();var m=s.getPoints();g.moveTo(m[0][0],m[0][1]);for(var h=1;h<m.length;h++){g.lineTo(m[h][0],m[h][1])}g.closePath();if(b===null){b=g.createTransformedShape(q).getBounds2D()}else{b.add(g.createTransformedShape(q).getBounds2D())}}var a=new Point2D(b.getCenterX(),b.getCenterY());q.setToRotation(f);q.transform(a,a);if(this.resizable){HomePieceOfFurniture.prototype.setWidth.call(this,b.getWidth());HomePieceOfFurniture.prototype.setDepth.call(this,b.getHeight())}else{this.fixedWidth=b.getWidth();this.fixedDepth=b.getHeight()}HomePieceOfFurniture.prototype.setX.call(this,a.getX());HomePieceOfFurniture.prototype.setY.call(this,a.getY())}};HomeFurnitureGroup.prototype.addFurnitureListener=function(){var b=this;this.furnitureListener=function(c){if("X"==c.getPropertyName()||"Y"==c.getPropertyName()||"ELEVATION"==c.getPropertyName()||"ANGLE"==c.getPropertyName()||"WIDTH"==c.getPropertyName()||"DEPTH"==c.getPropertyName()||"HEIGHT"==c.getPropertyName()){b.updateLocationAndSize(b.getFurniture(),b.getAngle(),false)}};for(var a=0;a<this.furniture.length;a++){this.furniture[a].addPropertyChangeListener(this.furnitureListener)}};HomeFurnitureGroup.prototype.getFurnitureWithoutGroups=function(d){var c=[];for(var a=0;a<d.length;a++){var b=d[a];if(b instanceof HomeFurnitureGroup){c.push.apply(c,this.getFurnitureWithoutGroups(b.getFurniture()))}else{c.push(b)}}return c};HomeFurnitureGroup.prototype.getAllFurniture=function(){var c=this.furniture.slice(0);for(var a=0;a<this.furniture.length;a++){var b=this.furniture[a];if(b instanceof HomeFurnitureGroup){c.push.apply(c,b.getAllFurniture())}}return c};HomeFurnitureGroup.prototype.getFurniture=function(){return this.furniture};HomeFurnitureGroup.prototype.addPieceOfFurniture=function(b,a){this.furniture=this.furniture.slice(0);b.setLevel(this.getLevel());this.furniture.splice(a,0,b);b.addPropertyChangeListener(this.furnitureListener);this.updateLocationAndSize(this.furniture,this.getAngle(),false)};HomeFurnitureGroup.prototype.deletePieceOfFurniture=function(b){var a=this.furniture.indexOf(b);if(a!==-1){if(this.furniture.length>1){b.setLevel(null);b.removePropertyChangeListener(this.furnitureListener);this.furniture=this.furniture.slice(0);this.furniture.splice(a,1);this.updateLocationAndSize(this.furniture,this.getAngle(),false)}else{throw new IllegalStateException("Group can't be empty")}}};HomeFurnitureGroup.prototype.getCatalogId=function(){return null};HomeFurnitureGroup.prototype.getInformation=function(){return null};HomeFurnitureGroup.prototype.isMovable=function(){return HomePieceOfFurniture.prototype.isMovable.call(this)};HomeFurnitureGroup.prototype.setMovable=function(b){HomePieceOfFurniture.prototype.setMovable.call(this,b);for(var a=0;a<this.furniture.length;a++){this.furniture[a].setMovable(b)}};HomeFurnitureGroup.prototype.isDoorOrWindow=function(){return this.doorOrWindow};HomeFurnitureGroup.prototype.isResizable=function(){return this.resizable};HomeFurnitureGroup.prototype.isDeformable=function(){return this.deformable};HomeFurnitureGroup.prototype.isTexturable=function(){return this.texturable};HomeFurnitureGroup.prototype.getX=function(){if(typeof Rectangle2D==="undefined"){throw"Missing geom.js"}return HomePieceOfFurniture.prototype.getX.call(this)};HomeFurnitureGroup.prototype.getY=function(){if(typeof Rectangle2D==="undefined"){throw"Missing geom.js"}return HomePieceOfFurniture.prototype.getY.call(this)};HomeFurnitureGroup.prototype.getWidth=function(){if(typeof Rectangle2D==="undefined"){throw"Missing geom.js"}if(!this.resizable){return this.fixedWidth}else{return HomePieceOfFurniture.prototype.getWidth.call(this)}};HomeFurnitureGroup.prototype.getDepth=function(){if(typeof Rectangle2D==="undefined"){throw"Missing geom.js"}if(!this.resizable){return this.fixedDepth}else{return HomePieceOfFurniture.prototype.getDepth.call(this)}};HomeFurnitureGroup.prototype.getHeight=function(){if(!this.resizable){return this.fixedHeight}else{return HomePieceOfFurniture.prototype.getHeight.call(this)}};HomeFurnitureGroup.prototype.getIcon=function(){return null};HomeFurnitureGroup.prototype.getPlanIcon=function(){return null};HomeFurnitureGroup.prototype.getModel=function(){return null};HomeFurnitureGroup.prototype.getModelRotation=function(){return HomePieceOfFurniture.IDENTITY};HomeFurnitureGroup.prototype.getStaircaseCutOutShape=function(){return null};HomeFurnitureGroup.prototype.getCreator=function(){return null};HomeFurnitureGroup.prototype.getPrice=function(){var c=null;for(var a=0;a<this.furniture.length;a++){var b=this.furniture[a];if(b.getPrice()!==null){if(c===null){c=b.getPrice()}else{c=c.plus(b.getPrice())}}}if(c===null){return HomePieceOfFurniture.prototype.getPrice.call(this)}else{return c}};HomeFurnitureGroup.prototype.setPrice=function(b){for(var a=0;a<this.furniture.length;a++){if(this.furniture[a].getPrice()!==null){throw new UnsupportedOperationException("Can't change the price of a group containing pieces with a price")}}HomePieceOfFurniture.prototype.setPrice.call(this,b)};HomeFurnitureGroup.prototype.getValueAddedTaxPercentage=function(){var c=this.furniture[0].getValueAddedTaxPercentage();if(c!==null){for(var b=0;b<this.furniture.length;b++){var a=this.furniture[b].getValueAddedTaxPercentage();if(a===null||!a.eq(c)){return null}}}return c};HomeFurnitureGroup.prototype.getCurrency=function(){return this.currency};HomeFurnitureGroup.prototype.getValueAddedTax=function(){var a=null;for(var b=0;b<this.furniture.length;b++){var c=this.furniture[b].getValueAddedTax();if(c!==null){if(a===null){a=c}else{a=a.plus(c)}}}return a};HomeFurnitureGroup.prototype.getPriceValueAddedTaxIncluded=function(){var a=null;for(var b=0;b<this.furniture.length;b++){var c=this.furniture[b];if(c.getPrice()!==null){if(a===null){a=c.getPriceValueAddedTaxIncluded()}else{a=a.plus(c.getPriceValueAddedTaxIncluded())}}}return a};HomeFurnitureGroup.prototype.isBackFaceShown=function(){return false};HomeFurnitureGroup.prototype.getColor=function(){return null};HomeFurnitureGroup.prototype.setColor=function(a){if(this.isTexturable()){for(var b=0;b<this.furniture.length;b++){this.furniture[b].setColor(a)}}};HomeFurnitureGroup.prototype.getTexture=function(){return null};HomeFurnitureGroup.prototype.setTexture=function(b){if(this.isTexturable()){for(var a=0;a<this.furniture.length;a++){this.furniture[a].setTexture(b)}}};HomeFurnitureGroup.prototype.getModelMaterials=function(){return null};HomeFurnitureGroup.prototype.setModelMaterials=function(b){if(this.isTexturable()){for(var a=0;a<this.furniture.length;a++){this.furniture[a].setModelMaterials(b)}}};HomeFurnitureGroup.prototype.getShininess=function(){return null};HomeFurnitureGroup.prototype.setShininess=function(b){if(this.isTexturable()){for(var a=0;a<this.furniture.length;a++){this.furniture[a].setShininess(b)}}};HomeFurnitureGroup.prototype.setAngle=function(h){if(h!==this.getAngle()){var a=h-this.getAngle();var d=Math.cos(a);var e=Math.sin(a);for(var b=0;b<this.furniture.length;b++){var c=this.furniture[b];c.removePropertyChangeListener(this.furnitureListener);c.setAngle(c.getAngle()+a);var g=this.getX()+((c.getX()-this.getX())*d-(c.getY()-this.getY())*e);var f=this.getY()+((c.getX()-this.getX())*e+(c.getY()-this.getY())*d);c.setX(g);c.setY(f);c.addPropertyChangeListener(this.furnitureListener)}HomePieceOfFurniture.prototype.setAngle.call(this,h)}};HomeFurnitureGroup.prototype.setX=function(a){if(a!==this.getX()){var b=a-this.getX();for(var c=0;c<this.furniture.length;c++){var d=this.furniture[c];d.removePropertyChangeListener(this.furnitureListener);d.setX(d.getX()+b);d.addPropertyChangeListener(this.furnitureListener)}HomePieceOfFurniture.prototype.setX.call(this,a)}};HomeFurnitureGroup.prototype.setY=function(d){if(d!==this.getY()){var a=d-this.getY();for(var b=0;b<this.furniture.length;b++){var c=this.furniture[b];c.addPropertyChangeListener(this.furnitureListener);c.setY(c.getY()+a);c.removePropertyChangeListener(this.furnitureListener)}HomePieceOfFurniture.prototype.setY.call(this,d)}};HomeFurnitureGroup.prototype.setWidth=function(b){if(b!==this.getWidth()){var h=b/this.getWidth();var f=this.getAngle();for(var g=0;g<this.furniture.length;g++){var m=this.furniture[g];m.removePropertyChangeListener(this.furnitureListener);var e=m.getAngle()-f;var k=m.getWidth();var c=m.getDepth();m.setWidth(k+k*(h-1)*Math.abs(Math.cos(e)));m.setDepth(c+c*(h-1)*Math.abs(Math.sin(e)));var j=Math.cos(f);var d=Math.sin(f);var a=this.getX()+((m.getX()-this.getX())*j+(m.getY()-this.getY())*d);var l=this.getY()+((m.getX()-this.getX())*-d+(m.getY()-this.getY())*j);a=this.getX()+(a-this.getX())*h;m.setX(this.getX()+((a-this.getX())*j-(l-this.getY())*d));m.setY(this.getY()+((a-this.getX())*d+(l-this.getY())*j));m.addPropertyChangeListener(this.furnitureListener)}HomePieceOfFurniture.prototype.setWidth.call(this,b)}};HomeFurnitureGroup.prototype.setDepth=function(g){if(g!==this.getDepth()){var b=g/this.getDepth();var f=this.getAngle();for(var h=0;h<this.furniture.length;h++){var m=this.furniture[h];m.removePropertyChangeListener(this.furnitureListener);var e=m.getAngle()-f;var k=m.getWidth();var c=m.getDepth();m.setWidth(k+k*(b-1)*Math.abs(Math.sin(e)));m.setDepth(c+c*(b-1)*Math.abs(Math.cos(e)));var j=Math.cos(f);var d=Math.sin(f);var a=this.getX()+((m.getX()-this.getX())*j+(m.getY()-this.getY())*d);var l=this.getY()+((m.getX()-this.getX())*-d+(m.getY()-this.getY())*j);l=this.getY()+(l-this.getY())*b;m.setX(this.getX()+((a-this.getX())*j-(l-this.getY())*d));m.setY(this.getY()+((a-this.getX())*d+(l-this.getY())*j));m.addPropertyChangeListener(this.furnitureListener)}HomePieceOfFurniture.prototype.setDepth.call(this,g)}};HomeFurnitureGroup.prototype.setHeight=function(a){if(a!==this.getHeight()){var b=a/this.getHeight();for(var c=0;c<this.furniture.length;c++){var d=this.furniture[c];d.removePropertyChangeListener(this.furnitureListener);d.setHeight(d.getHeight()*b);d.setElevation(this.getElevation()+(d.getElevation()-this.getElevation())*b);d.addPropertyChangeListener(this.furnitureListener)}HomePieceOfFurniture.prototype.setHeight.call(this,a)}};HomeFurnitureGroup.prototype.setElevation=function(c){if(c!==this.getElevation()){var d=c-this.getElevation();for(var a=0;a<this.furniture.length;a++){var b=this.furniture[a];b.removePropertyChangeListener(this.furnitureListener);b.setElevation(b.getElevation()+d);b.addPropertyChangeListener(this.furnitureListener)}HomePieceOfFurniture.prototype.setElevation.call(this,c)}};HomeFurnitureGroup.prototype.setModelMirrored=function(a){if(a!==this.isModelMirrored()){var h=this.getAngle();for(var c=0;c<this.furniture.length;c++){var d=this.furniture[c];d.removePropertyChangeListener(this.furnitureListener);d.setModelMirrored(!d.isModelMirrored());var b=Math.cos(h);var e=Math.sin(h);var g=this.getX()+((d.getX()-this.getX())*b+(d.getY()-this.getY())*e);var f=this.getY()+((d.getX()-this.getX())*-e+(d.getY()-this.getY())*b);g=this.getX()-(g-this.getX());d.setX(this.getX()+((g-this.getX())*b-(f-this.getY())*e));d.setY(this.getY()+((g-this.getX())*e+(f-this.getY())*b));d.addPropertyChangeListener(this.furnitureListener)}HomePieceOfFurniture.prototype.setModelMirrored.call(this,a)}};HomeFurnitureGroup.prototype.setVisible=function(b){for(var a=0;a<this.furniture.length;a++){this.furniture[a].setVisible(b)}HomePieceOfFurniture.prototype.setVisible.call(this,b)};HomeFurnitureGroup.prototype.setLevel=function(b){for(var a=0;a<this.furniture.length;a++){this.furniture[a].setLevel(b)}HomePieceOfFurniture.prototype.setLevel.call(this,b)};HomeFurnitureGroup.prototype.intersectsRectangle=function(c,e,a,d){for(var b=0;b<this.furniture.length;b++){if(this.furniture[b].intersectsRectangle(c,e,a,d)){return true}}return false};HomeFurnitureGroup.prototype.containsPoint=function(a,d,c){for(var b=0;b<this.furniture.length;b++){if(this.furniture[b].containsPoint(a,d,c)){return true}}return false};HomeFurnitureGroup.prototype.clone=function(){var d=new Array(this.furniture.length);for(var b=0;b<this.furniture.length;b++){var c=this.furniture[b];var a=c.clone();d[b]=a;if(typeof HomeDoorOrWindow!=="undefined"&&c instanceof HomeDoorOrWindow&&c.isBoundToWall()){a.setBoundToWall(true)}}var e=new HomeFurnitureGroup(d,name);this.duplicateAttributes(e);e.description=this.description;e.information=this.information;e.icon=this.icon;e.planIcon=this.planIcon;e.model=this.model;e.width=this.width;e.depth=this.depth;e.height=this.height;e.elevation=this.elevation;e.dropOnTopElevation=this.dropOnTopElevation;e.movable=this.movable;e.doorOrWindow=this.doorOrWindow;e.color=this.color;e.modelRotation=this.modelRotation;e.staircaseCutOutShape=this.staircaseCutOutShape;e.creator=this.creator;e.backFaceShown=this.backFaceShown;e.resizable=this.resizable;e.deformable=this.deformable;e.texturable=this.texturable;e.price=this.price;e.valueAddedTaxPercentage=this.valueAddedTaxPercentage;e.currency=this.currency;e.catalogId=this.catalogId;e.nameVisible=this.nameVisible;e.nameXOffset=this.nameXOffset;e.nameYOffset=this.nameYOffset;e.nameAngle=this.nameAngle;e.nameStyle=this.nameStyle;e.visible=this.visible;e.angle=this.angle;e.x=this.x;e.y=this.y;e.modelMirrored=this.modelMirrored;e.texture=this.texture;e.shininess=this.shininess;e.modelMaterials=this.modelMaterials;return e};function Camera(a,h,g,e,d,f,c,b){this.x=a;this.y=h;this.z=g;this.yaw=e;this.pitch=d;this.fieldOfView=f;this.time=c!==undefined?c:Camera.midday();this.lens=b!==undefined?b:Camera.Lens.PINHOLE;this.propertyChangeSupport=new PropertyChangeSupport(this)}Camera.prototype=Object.create(HomeObject.prototype);Camera.prototype.constructor=Camera;Camera.Lens={PINHOLE:0,NORMAL:1,FISHEYE:2,SPHERICAL:3};Camera.midday=function(){var a=new Date();a.setHours(12,0,0,0);return a.getTime()};Camera.prototype.addPropertyChangeListener=function(a){this.propertyChangeSupport.addPropertyChangeListener(a)};Camera.prototype.removePropertyChangeListener=function(a){this.propertyChangeSupport.removePropertyChangeListener(a)};Camera.prototype.getName=function(){return this.name};Camera.prototype.setName=function(a){if(a!=this.name){var b=this.name;this.name=a;this.propertyChangeSupport.firePropertyChange("NAME",b,a)}};Camera.prototype.getYaw=function(){return this.yaw};Camera.prototype.setYaw=function(b){if(b!==this.yaw){var a=this.yaw;this.yaw=b;this.propertyChangeSupport.firePropertyChange("YAW",a,b)}};Camera.prototype.getPitch=function(){return this.pitch};Camera.prototype.setPitch=function(b){if(b!==this.pitch){var a=this.pitch;this.pitch=b;this.propertyChangeSupport.firePropertyChange("PITCH",a,b)}};Camera.prototype.getFieldOfView=function(){return this.fieldOfView};Camera.prototype.setFieldOfView=function(a){if(a!==this.fieldOfView){var b=this.fieldOfView;this.fieldOfView=a;this.propertyChangeSupport.firePropertyChange("FIELD_OF_VIEW",b,a)}};Camera.prototype.getX=function(){return this.x};Camera.prototype.setX=function(a){if(a!==this.x){var b=this.x;this.x=a;this.propertyChangeSupport.firePropertyChange("X",b,a)}};Camera.prototype.getY=function(){return this.y};Camera.prototype.setY=function(b){if(b!==this.y){var a=this.y;this.y=b;this.propertyChangeSupport.firePropertyChange("Y",a,b)}};Camera.prototype.getZ=function(){return this.z};Camera.prototype.setZ=function(b){if(b!==this.z){var a=this.z;this.z=b;this.propertyChangeSupport.firePropertyChange("Z",a,b)}};Camera.prototype.getTime=function(){return this.time};Camera.prototype.setTime=function(a){if(this.time!==a){var b=this.time;this.time=a;this.propertyChangeSupport.firePropertyChange("TIME",b,a)}};Camera.convertTimeToTimeZone=function(a,c){if(c===undefined){c=""}var d=new Date(a);var e=d.toString();e=e.substring(0,e.indexOf("GMT"));var b=new Date(e+c).getTime();if(isNaN(b)){return new Date(e+"GMT").getTime()}else{return b}};Camera.prototype.getLens=function(){return this.lens};Camera.prototype.setLens=function(a){if(a!==this.lens){var b=this.lens;this.lens=a;this.propertyChangeSupport.firePropertyChange("LENS",b,a)}};Camera.prototype.setCamera=function(a){this.setX(a.getX());this.setY(a.getY());this.setZ(a.getZ());this.setYaw(a.getYaw());this.setPitch(a.getPitch());this.setFieldOfView(a.getFieldOfView())};Camera.prototype.clone=function(){var a=new Camera(this.getX(),this.getY(),this.getZ(),this.getYaw(),this.getPitch(),this.getFieldOfView(),this.getTime(),this.getLens());this.duplicateAttributes(a);return a};function ObserverCamera(a,f,e,c,b,d){Camera.call(this,a,f,e,c,b,d);this.fixedSize=false;this.shapeCache=null;this.rectangleShapeCache=null}ObserverCamera.prototype=Object.create(Camera.prototype);ObserverCamera.prototype.constructor=ObserverCamera;ObserverCamera.prototype.setFixedSize=function(c){if(this.fixedSize!==c){var a=this.getWidth();var b=this.getDepth();var d=this.getHeight();this.fixedSize=c;this.shapeCache=null;this.rectangleShapeCache=null;this.propertyChangeSupport.firePropertyChange("WIDTH",a,this.getWidth());this.propertyChangeSupport.firePropertyChange("DEPTH",b,this.getDepth());this.propertyChangeSupport.firePropertyChange("HEIGHT",d,this.getHeight())}};ObserverCamera.prototype.isFixedSize=function(){return this.fixedSize};ObserverCamera.prototype.setYaw=function(a){Camera.prototype.setYaw.call(this,a);this.shapeCache=null;this.rectangleShapeCache=null};ObserverCamera.prototype.setX=function(a){Camera.prototype.setX.call(this,a);this.shapeCache=null;this.rectangleShapeCache=null};ObserverCamera.prototype.setY=function(a){Camera.prototype.setY.call(this,a);this.shapeCache=null;this.rectangleShapeCache=null};ObserverCamera.prototype.setZ=function(c){var a=this.getWidth();var b=this.getDepth();var d=this.getHeight();Camera.prototype.setZ.call(this,c);this.shapeCache=null;this.rectangleShapeCache=null;this.propertyChangeSupport.firePropertyChange("WIDTH",a,this.getWidth());this.propertyChangeSupport.firePropertyChange("DEPTH",b,this.getDepth());this.propertyChangeSupport.firePropertyChange("HEIGHT",d,this.getHeight())};ObserverCamera.prototype.getWidth=function(){if(this.fixedSize){return 46.6}else{var a=this.getZ()*4/14;return Math.min(Math.max(a,20),62.5)}};ObserverCamera.prototype.getDepth=function(){if(this.fixedSize){return 18.6}else{var a=this.getZ()*8/70;return Math.min(Math.max(a,8),25)}};ObserverCamera.prototype.getHeight=function(){if(this.fixedSize){return 175}else{return this.getZ()*15/14}};ObserverCamera.prototype.getPoints=function(){var c=new Array(4);var b=this.getRectangleShape().getPathIterator(null);for(var a=0;a<c.length;a++){c[a]=[0,0];b.currentSegment(c[a]);b.next()}return c};ObserverCamera.prototype.intersectsRectangle=function(c,e,a,d){var b=new Rectangle2D(c,e,0,0);b.add(a,d);return this.getShape().intersects(b)};ObserverCamera.prototype.containsPoint=function(a,c,b){if(b==0){return this.getShape().contains(a,c)}else{return this.getShape().intersects(a-b,c-b,2*b,2*b)}};ObserverCamera.prototype.getShape=function(){if(this.shapeCache==null){var a=new Ellipse2D(this.getX()-this.getWidth()/2,this.getY()-this.getDepth()/2,this.getWidth(),this.getDepth());var b=AffineTransform.getRotateInstance(this.getYaw(),this.getX(),this.getY());var d=a.getPathIterator(b);var c=new GeneralPath();c.append(d,false);this.shapeCache=c}return this.shapeCache};ObserverCamera.prototype.getRectangleShape=function(){if(this.rectangleShapeCache==null){var a=new Rectangle2D(this.getX()-this.getWidth()/2,this.getY()-this.getDepth()/2,this.getWidth(),this.getDepth());var b=AffineTransform.getRotateInstance(this.getYaw(),this.getX(),this.getY());var c=a.getPathIterator(b);var d=new GeneralPath();d.append(c,false);this.rectangleShapeCache=d}return this.rectangleShapeCache};ObserverCamera.prototype.move=function(b,a){this.setX(this.getX()+b);this.setY(this.getY()+a)};ObserverCamera.prototype.clone=function(){var a=new ObserverCamera(this.getX(),this.getY(),this.getZ(),this.getYaw(),this.getPitch(),this.getFieldOfView(),this.getTime(),this.getLens());a.fixedSize=this.fixedSize;a.shapeCache=this.shapeCache;a.rectangleShapeCache=this.rectangleShapeCache;return a};function BackgroundImage(e,i,h,b,f,c,a,g,d){this.image=e;this.scaleDistance=i;this.scaleDistanceXStart=h;this.scaleDistanceYStart=b;this.scaleDistanceXEnd=f;this.scaleDistanceYEnd=c;this.xOrigin=a;this.yOrigin=g;this.invisible=!d}BackgroundImage.prototype.getImage=function(){return this.image};BackgroundImage.prototype.getScaleDistance=function(){return this.scaleDistance};BackgroundImage.prototype.getScaleDistanceXStart=function(){return this.scaleDistanceXStart};BackgroundImage.prototype.getScaleDistanceYStart=function(){return this.scaleDistanceYStart};BackgroundImage.prototype.getScaleDistanceXEnd=function(){return this.scaleDistanceXEnd};BackgroundImage.prototype.getScaleDistanceYEnd=function(){return this.scaleDistanceYEnd};BackgroundImage.prototype.getScale=function(){return BackgroundImage.getScale(this.scaleDistance,this.scaleDistanceXStart,this.scaleDistanceYStart,this.scaleDistanceXEnd,this.scaleDistanceYEnd)};BackgroundImage.getScale=function(d,a,e,c,b){if(typeof Point2D==="undefined"){throw"Missing geom.js"}return d/Point2D.distance(a,e,c,b)};BackgroundImage.prototype.getXOrigin=function(){return this.xOrigin};BackgroundImage.prototype.getYOrigin=function(){return this.yOrigin};BackgroundImage.prototype.isVisible=function(){return !this.invisible};function HomeMaterial(b,d,a,e,c){this.name=b;this.key=d;this.color=a;this.texture=e;this.shininess=c}HomeMaterial.prototype.getName=function(){return this.name};HomeMaterial.prototype.getKey=function(){return this.key};HomeMaterial.prototype.getColor=function(){return this.color};HomeMaterial.prototype.getTexture=function(){return this.texture};HomeMaterial.prototype.getShininess=function(){return this.shininess};function HomeTexture(b,c,a){if(a===undefined){a=false}if(c===undefined){c=0}this.name=b.getName();this.image=b.getImage();this.width=b.getWidth();this.height=b.getHeight();this.angle=c;this.leftToRightOriented=a;if(b instanceof HomeTexture){this.catalogId=b.getCatalogId()}else{if(b instanceof CatalogTexture){this.catalogId=b.getId()}else{this.catalogId=null}}}HomeTexture.prototype.getCatalogId=function(){return this.catalogId};HomeTexture.prototype.getName=function(){return this.name};HomeTexture.prototype.getImage=function(){return this.image};HomeTexture.prototype.getWidth=function(){return this.width};HomeTexture.prototype.getHeight=function(){return this.height};HomeTexture.prototype.getAngle=function(){return this.angle};HomeTexture.prototype.isLeftToRightOriented=function(){return this.leftToRightOriented};HomeTexture.prototype.equals=function(b){if(b==this){return true}else{if(b instanceof HomeTexture){var a=b;return(a.name==this.name)&&(a.image===this.image||a.image!==null&&a.image.equals(this.image))&&a.width===this.width&&a.height===this.height&&a.leftToRightOriented===this.leftToRightOriented&&a.angle===this.angle}else{return false}}};function TextStyle(d,e,b,a,c){if(c===undefined){c=true}if(a===undefined){a=b;b=e;e=d;d=null}else{if(e===undefined){a=false;b=false;e=d;d=null}}this.fontName=d;this.fontSize=e;this.bold=b;this.italic=a;if(c){TextStyle.textStylesCache.push(this)}}TextStyle.textStylesCache=[];TextStyle.prototype.getInstance=function(d,e,c,a){var g=new TextStyle(d,e,c,a,false);for(var b=0;b<TextStyle.textStylesCache.length;b++){var f=TextStyle.textStylesCache[b];if(f.equals(g)){return g}}TextStyle.textStylesCache.push(g);return g};TextStyle.prototype.getFontName=function(){return this.fontName};TextStyle.prototype.getFontSize=function(){return this.fontSize};TextStyle.prototype.isBold=function(){return this.bold};TextStyle.prototype.isItalic=function(){return this.italic};TextStyle.prototype.deriveStyle=function(a){if(typeof a==="string"){if(this.getFontName()==a){return this}else{return this.getInstance(this.fontName,this.getFontSize(),this.isBold(),this.isItalic())}}else{var b=a;if(this.getFontSize()==b){return this}else{return this.getInstance(this.getFontName(),b,this.isBold(),this.isItalic())}}};TextStyle.prototype.deriveBoldStyle=function(a){if(this.isBold()==a){return this}else{return this.getInstance(this.getFontName(),this.getFontSize(),a,this.isItalic())}};TextStyle.prototype.deriveItalicStyle=function(a){if(this.isItalic()==a){return this}else{return this.getInstance(this.getFontName(),this.getFontSize(),this.isBold(),a)}};TextStyle.prototype.equals=function(a){if(a instanceof TextStyle){var b=a;return b.fontName==this.fontName&&b.fontSize===this.fontSize&&b.bold===this.bold&&b.italic===this.italic}return false};function HomeEnvironment(d,f,c,b,a,e){this.groundColor=d!==undefined?d:11053224;this.groundTexture=f!==undefined?f:null;this.skyColor=c!==undefined?c:13427964;this.skyTexture=b!==undefined?b:null;this.lightColor=a!==undefined?a:13684944;this.wallsAlpha=e!==undefined?e:0;this.ceilingLightColor=4291875024;this.observerCameraElevationAdjusted=true;this.drawingMode=HomeEnvironment.DrawingMode.FILL;this.subpartSizeUnderLight=0;this.allLevelsVisible=false;this.photoWidth=400;this.photoHeight=300;this.photoAspectRatio=AspectRatio.VIEW_3D_RATIO;this.photoQuality=0;this.videoWidth=320;this.videoAspectRatio=AspectRatio.RATIO_4_3;this.videoQuality=0;this.videoFrameRate=25;this.cameraPath=[];this.propertyChangeSupport=new PropertyChangeSupport(this)}HomeEnvironment.DrawingMode={FILL:0,OUTLINE:1,FILL_AND_OUTLINE:2};HomeEnvironment.prototype.addPropertyChangeListener=function(b,a){this.propertyChangeSupport.addPropertyChangeListener(b,a)};HomeEnvironment.prototype.removePropertyChangeListener=function(b,a){this.propertyChangeSupport.removePropertyChangeListener(b,a)};HomeEnvironment.prototype.isObserverCameraElevationAdjusted=function(){return this.observerCameraElevationAdjusted};HomeEnvironment.prototype.setObserverCameraElevationAdjusted=function(a){if(this.observerCameraElevationAdjusted!==a){this.observerCameraElevationAdjusted=a;this.propertyChangeSupport.firePropertyChange("OBSERVER_CAMERA_ELEVATION_ADJUSTED",!a,a)}};HomeEnvironment.prototype.getGroundColor=function(){return this.groundColor};HomeEnvironment.prototype.setGroundColor=function(a){if(a!==this.groundColor){var b=this.groundColor;this.groundColor=a;this.propertyChangeSupport.firePropertyChange("GROUND_COLOR",b,a)}};HomeEnvironment.prototype.getGroundTexture=function(){return this.groundTexture};HomeEnvironment.prototype.setGroundTexture=function(b){if(b!==this.groundTexture){var a=this.groundTexture;this.groundTexture=b;this.propertyChangeSupport.firePropertyChange("GROUND_TEXTURE",a,b)}};HomeEnvironment.prototype.getSkyColor=function(){return this.skyColor};HomeEnvironment.prototype.setSkyColor=function(b){if(b!==this.skyColor){var a=this.skyColor;this.skyColor=b;this.propertyChangeSupport.firePropertyChange("SKY_COLOR",a,b)}};HomeEnvironment.prototype.getSkyTexture=function(){return this.skyTexture};HomeEnvironment.prototype.setSkyTexture=function(a){if(a!==this.skyTexture){var b=this.skyTexture;this.skyTexture=a;this.propertyChangeSupport.firePropertyChange("SKY_TEXTURE",b,a)}};HomeEnvironment.prototype.getLightColor=function(){return this.lightColor};HomeEnvironment.prototype.setLightColor=function(a){if(a!==this.lightColor){var b=this.lightColor;this.lightColor=a;this.propertyChangeSupport.firePropertyChange("LIGHT_COLOR",b,a)}};HomeEnvironment.prototype.getCeillingLightColor=function(){return this.ceilingLightColor};HomeEnvironment.prototype.setCeillingLightColor=function(a){if(a!==this.ceilingLightColor){var b=this.ceilingLightColor;this.ceilingLightColor=a;this.propertyChangeSupport.firePropertyChange("CEILING_LIGHT_COLOR",b,a)}};HomeEnvironment.prototype.getWallsAlpha=function(){return this.wallsAlpha};HomeEnvironment.prototype.setWallsAlpha=function(b){if(b!==this.wallsAlpha){var a=this.wallsAlpha;this.wallsAlpha=b;this.propertyChangeSupport.firePropertyChange("WALLS_ALPHA",a,b)}};HomeEnvironment.prototype.getDrawingMode=function(){return this.drawingMode};HomeEnvironment.prototype.setDrawingMode=function(a){if(a!==this.drawingMode){var b=this.drawingMode;this.drawingMode=a;this.propertyChangeSupport.firePropertyChange("DRAWING_MODE",b,a)}};HomeEnvironment.prototype.getSubpartSizeUnderLight=function(){return this.subpartSizeUnderLight};HomeEnvironment.prototype.setSubpartSizeUnderLight=function(a){if(a!==this.subpartSizeUnderLight){var b=this.subpartSizeUnderLight;this.subpartSizeUnderLight=a;this.propertyChangeSupport.firePropertyChange("SUBPART_SIZE_UNDER_LIGHT",b,a)}};HomeEnvironment.prototype.isAllLevelsVisible=function(){return this.allLevelsVisible};HomeEnvironment.prototype.setAllLevelsVisible=function(a){if(a!==this.allLevelsVisible){this.allLevelsVisible=a;this.propertyChangeSupport.firePropertyChange("ALL_LEVELS_VISIBLE",!a,a)}};HomeEnvironment.prototype.getPhotoWidth=function(){return this.photoWidth};HomeEnvironment.prototype.setPhotoWidth=function(b){if(this.photoWidth!==b){var a=this.photoWidth;this.photoWidth=b;this.propertyChangeSupport.firePropertyChange("PHOTO_WIDTH",a,b)}};HomeEnvironment.prototype.getPhotoHeight=function(){return this.photoHeight};HomeEnvironment.prototype.setPhotoHeight=function(a){if(this.photoHeight!==a){var b=this.photoHeight;this.photoHeight=a;this.propertyChangeSupport.firePropertyChange("PHOTO_HEIGHT",b,a)}};HomeEnvironment.prototype.getPhotoAspectRatio=function(){return this.photoAspectRatio};HomeEnvironment.prototype.setPhotoAspectRatio=function(a){if(this.photoAspectRatio!==a){var b=this.photoAspectRatio;this.photoAspectRatio=a;this.propertyChangeSupport.firePropertyChange("PHOTO_ASPECT_RATIO",b,a)}};HomeEnvironment.prototype.getPhotoQuality=function(){return this.photoQuality};HomeEnvironment.prototype.setPhotoQuality=function(a){if(this.photoQuality!==a){var b=this.photoQuality;this.photoQuality=a;this.propertyChangeSupport.firePropertyChange("PHOTO_QUALITY",b,a)}};HomeEnvironment.prototype.getVideoWidth=function(){return this.videoWidth};HomeEnvironment.prototype.setVideoWidth=function(b){if(this.videoWidth!==b){var a=this.videoWidth;this.videoWidth=b;this.propertyChangeSupport.firePropertyChange("VIDEO_WIDTH",a,b)}};HomeEnvironment.prototype.getVideoHeight=function(){return Math.round(getVideoWidth()/this.getVideoAspectRatio().getValue())};HomeEnvironment.prototype.getVideoAspectRatio=function(){return this.videoAspectRatio};HomeEnvironment.prototype.setVideoAspectRatio=function(b){if(this.videoAspectRatio!==b){var a=this.videoAspectRatio;this.videoAspectRatio=b;this.propertyChangeSupport.firePropertyChange("VIDEO_ASPECT_RATIO",a,b)}};HomeEnvironment.prototype.getVideoQuality=function(){return this.videoQuality};HomeEnvironment.prototype.setVideoQuality=function(a){if(this.videoQuality!==a){var b=this.videoQuality;this.videoQuality=a;this.propertyChangeSupport.firePropertyChange("VIDEO_QUALITY",b,a)}};HomeEnvironment.prototype.getVideoFrameRate=function(){return this.videoFrameRate};HomeEnvironment.prototype.setVideoFrameRate=function(b){if(this.videoFrameRate!==b){var a=this.videoFrameRate;this.videoFrameRate=b;this.propertyChangeSupport.firePropertyChange("VIDEO_FRAME_RATE",a,b)}};HomeEnvironment.prototype.getVideoCameraPath=function(){return this.cameraPath.slice(0)};HomeEnvironment.prototype.setVideoCameraPath=function(a){if(this.cameraPath!==a){var b=this.cameraPath;if(a!==null){this.cameraPath=a.slice(0)}else{this.cameraPath=[]}this.propertyChangeSupport.firePropertyChange("VIDEO_CAMERA_PATH",b,a)}};HomeEnvironment.prototype.clone=function(){var b=new HomeEnvironment(this.groundColor,this.groundTexture,this.skyColor,this.skyTexture,this.lightColor,this.wallsAlpha);b.ceilingLightColor=this.ceilingLightColor;b.observerCameraElevationAdjusted=this.observerCameraElevationAdjusted;b.drawingMode=this.drawingMode;b.subpartSizeUnderLight=this.subpartSizeUnderLight;b.allLevelsVisible=this.allLevelsVisible;b.photoWidth=this.photoWidth;b.photoHeight=this.photoHeight;b.photoAspectRatio=this.photoAspectRatio;b.photoQuality=this.photoQuality;b.videoWidth=this.videoWidth;b.videoAspectRatio=this.videoAspectRatio;b.videoQuality=this.videoQuality;b.videoFrameRate=this.videoFrameRate;b.cameraPath=new Array(this.cameraPath.length);for(var a=0;a<this.cameraPath.length;a++){b.cameraPath[a]=this.cameraPath[a].clone()}b.propertyChangeSupport=new PropertyChangeSupport(b);return b};var AspectRatio={FREE_RATIO:{getValue:function(){return null}},VIEW_3D_RATIO:{getValue:function(){return null}},RATIO_4_3:{getValue:function(){return 4/3}},RATIO_3_2:{getValue:function(){return 1.5}},RATIO_16_9:{getValue:function(){return 16/9}},RATIO_2_1:{getValue:function(){return 2}},SQUARE_RATIO:{getValue:function(){return 1}}};function Level(b,c,d,a){this.name=b;this.elevation=c;this.floorThickness=d;this.height=a;this.backgroundImage=null;this.visible=true;this.viewable=true;this.elevationIndex=-1;this.propertyChangeSupport=new PropertyChangeSupport(this)}Level.prototype=Object.create(HomeObject.prototype);Level.prototype.constructor=Level;Level.prototype.addPropertyChangeListener=function(a){this.propertyChangeSupport.addPropertyChangeListener(a)};Level.prototype.removePropertyChangeListener=function(a){this.propertyChangeSupport.removePropertyChangeListener(a)};Level.prototype.getName=function(){return this.name};Level.prototype.setName=function(a){if(a!=this.name){var b=this.name;this.name=a;this.propertyChangeSupport.firePropertyChange("NAME",b,a)}};Level.prototype.getElevation=function(){return this.elevation};Level.prototype.setElevation=function(b){if(b!=this.elevation){var a=this.elevation;this.elevation=b;this.propertyChangeSupport.firePropertyChange("ELEVATION",a,b)}};Level.prototype.getFloorThickness=function(){return this.floorThickness};Level.prototype.setFloorThickness=function(b){if(b!=this.floorThickness){var a=this.floorThickness;this.floorThickness=b;this.propertyChangeSupport.firePropertyChange("FLOOR_THICKNESS",a,b)}};Level.prototype.getHeight=function(){return this.height};Level.prototype.setHeight=function(a){if(a!=this.height){var b=this.height;this.height=a;this.propertyChangeSupport.firePropertyChange("HEIGHT",b,a)}};Level.prototype.getBackgroundImage=function(){return this.backgroundImage};Level.prototype.setBackgroundImage=function(b){if(b!=this.backgroundImage){var a=this.backgroundImage;this.backgroundImage=b;this.propertyChangeSupport.firePropertyChange("BACKGROUND_IMAGE",a,b)}};Level.prototype.isVisible=function(){return this.visible};Level.prototype.setVisible=function(a){if(a!=this.visible){this.visible=a;this.propertyChangeSupport.firePropertyChange("VISIBLE",!a,a)}};Level.prototype.isViewable=function(){return this.viewable};Level.prototype.setViewable=function(a){if(a!=this.viewable){this.viewable=a;this.propertyChangeSupport.firePropertyChange("VIEWABLE",!a,a)}};Level.prototype.isViewableAndVisible=function(){return this.viewable&&this.visible};Level.prototype.getElevationIndex=function(){return this.elevationIndex};Level.prototype.setElevationIndex=function(a){if(a!=this.elevationIndex){var b=this.elevationIndex;this.elevationIndex=a;this.propertyChangeSupport.firePropertyChange("ELEVATION_INDEX",b,a)}};Level.prototype.clone=function(){var a=new Level(this.name,this.elevation,this.floorThickness,this.height);this.duplicateAttributes(a);a.backgroundImage=this.backgroundImage;a.visible=this.visible;a.viewable=this.viewable;a.elevationIndex=this.elevationIndex;a.propertyChangeSupport=new PropertyChangeSupport(a);return a};function SelectionEvent(a,b){this.source=a;this.selectedItems=b}SelectionEvent.prototype.getSource=function(){return this.source};SelectionEvent.prototype.getSelectedItems=function(){return this.selectedItems};function Home(b){var a=[];if(b===undefined){b=250}else{if(typeof b==="object"){if(b instanceof Home){var c=b;this.wallHeight=c.getWallHeight();Home.copyHomeData(c,this);Home.initListenersSupport(this);this.addModelListeners();return}a=b}}this.furniture=a.slice(0);this.selectedItems=[];this.allLevelsSelection=false;this.levels=[];this.selectedLevel=null;this.walls=[];this.rooms=[];this.polylines=[];this.dimensionLines=[];this.labels=[];this.camera=null;this.name=null;this.wallHeight=b;this.modified=false;this.recovered=false;this.repaired=false;this.backgroundImage=null;this.observerCamera=new ObserverCamera(50,50,170,7*Math.PI/4,Math.PI/16,Math.PI*63/180);this.topCamera=new Camera(50,1050,1010,Math.PI,Math.PI/4,Math.PI*63/180);this.storedCameras=[];this.environment=new HomeEnvironment();this.print=null;this.furnitureDescendingSorted=false;this.properties={};this.version=Home.CURRENT_VERSION;this.basePlanLocked=false;this.compass=null;this.furnitureSortedProperty=false;this.furnitureVisibleProperties=["NAME","WIDTH","DEPTH","HEIGHT","VISIBLE"];Home.initListenersSupport(this);this.addModelListeners()}Home.CURRENT_VERSION=5300;Home.LEVEL_ELEVATION_COMPARATOR=function(c,b){var a=b.getElevation()-c.getElevation();if(a!==0){return a}else{return c.getElevationIndex()-b.getElevationIndex()}};Home.initListenersSupport=function(a){a.furnitureChangeSupport=new CollectionChangeSupport(a);a.selectionListeners=[];a.levelsChangeSupport=new CollectionChangeSupport(a);a.wallsChangeSupport=new CollectionChangeSupport(a);a.roomsChangeSupport=new CollectionChangeSupport(a);a.polylinesChangeSupport=new CollectionChangeSupport(a);a.dimensionLinesChangeSupport=new CollectionChangeSupport(a);a.labelsChangeSupport=new CollectionChangeSupport(a);a.propertyChangeSupport=new PropertyChangeSupport(a)};Home.prototype.addModelListeners=function(){var c=this.levels;var b=function(d){if("ELEVATION"==d.getPropertyName()||"ELEVATION_INDEX"==d.getPropertyName()){c=c.slice(0);c.sort(Home.LEVEL_ELEVATION_COMPARATOR)}};for(var a=0;a<this.levels.length;a++){this.levels[a].addPropertyChangeListener(b)}this.addLevelsListener(function(d){switch(d.getType()){case CollectionEvent.Type.ADD:d.getItem().addPropertyChangeListener(b);break;case CollectionEvent.Type.DELETE:d.getItem().removePropertyChangeListener(b);break}})};Home.prototype.getGroupFurniture=function(c){var a=[];var e=c.getFurniture();for(var b=0;b<e.length;b++){var d=e[b];if(d instanceof HomeFurnitureGroup){a.push.apply(a,this.getGroupFurniture(d))}else{a.push(d)}}return a};Home.prototype.addLevelsListener=function(a){this.levelsChangeSupport.addCollectionListener(a)};Home.prototype.removeLevelsListener=function(a){this.levelsChangeSupport.removeCollectionListener(a)};Home.prototype.getLevels=function(){return this.levels};Home.prototype.addLevel=function(e){if(e.getElevationIndex()<0){var b=0;for(var c=0;c<this.levels.length;c++){var a=this.levels[c];if(a.getElevation()===e.getElevation()){b=a.getElevationIndex()+1}else{if(a.getElevation()>e.getElevation()){break}}}e.setElevationIndex(b)}this.levels=this.levels.slice(0);var d=0;while(d<this.levels.length&&Home.LEVEL_ELEVATION_COMPARATOR(e,this.levels[d])<=0){d++}this.levels.splice(d,0,e);this.levelsChangeSupport.fireCollectionChanged(e,d,CollectionEvent.Type.ADD)};Home.prototype.deleteLevel=function(b){var d=this.levels.indexOf(b);if(d!==-1){for(var c=0;c<this.furniture.length;c++){var j=this.furniture[c];if(j[c].getLevel()===b){this.deletePieceOfFurniture(j)}}for(var c=0;c<this.rooms.length;c++){var a=this.rooms[c];if(a.getLevel()===b){this.deleteRoom(a)}}for(var c=0;c<this.walls.length;c++){var g=this.walls[c];if(g.getLevel()===b){this.deleteWall(g)}}for(var c=0;c<this.polylines.length;c++){var f=this.polylines[c];if(f.getLevel()===b){this.deletePolyline(f)}}for(var c=0;c<this.dimensionLines.length;c++){var h=this.dimensionLines[c];if(h.getLevel()===b){this.deleteDimensionLine(h)}}for(var c=0;c<this.labels.length;c++){var e=this.labels[c];if(e.getLevel()===b){this.deleteLabel(e)}}if(this.selectedLevel===b){if(this.levels.length===1){this.setSelectedLevel(null);this.setAllLevelsSelection(false)}else{this.setSelectedLevel(this.levels[d>=1?d-1:d+1])}}this.levels=this.levels.clone();this.levels.splice(d,1);this.levelsChangeSupport.fireCollectionChanged(b,d,DELETE)}};Home.prototype.getSelectedLevel=function(){return this.selectedLevel};Home.prototype.setSelectedLevel=function(b){if(b!==this.selectedLevel){var a=this.selectedLevel;this.selectedLevel=b;this.propertyChangeSupport.firePropertyChange("SELECTED_LEVEL",a,b)}};Home.prototype.isAllLevelsSelection=function(){return this.allLevelsSelection};Home.prototype.setAllLevelsSelection=function(a){if(a!==this.allLevelsSelection){this.allLevelsSelection=a;this.propertyChangeSupport.firePropertyChange("ALL_LEVELS_SELECTION",!a,a)}};Home.prototype.addFurnitureListener=function(a){this.furnitureChangeSupport.addCollectionListener(a)};Home.prototype.removeFurnitureListener=function(a){this.furnitureChangeSupport.removeCollectionListener(a)};Home.prototype.getFurniture=function(){return this.furniture};Home.prototype.addPieceOfFurniture=function(b,a){if(a===undefined){a=this.furniture.length}this.furniture=this.furniture.slice(0);b.setLevel(this.selectedLevel);this.furniture.splice(a,0,b);this.furnitureChangeSupport.fireCollectionChanged(b,a,CollectionEvent.Type.ADD)};Home.prototype.addPieceOfFurnitureToGroup=function(b,c,a){b.setLevel(this.selectedLevel);c.addPieceOfFurniture(b,a);this.furnitureChangeSupport.fireCollectionChanged(b,CollectionEvent.Type.ADD)};Home.prototype.deletePieceOfFurniture=function(b){this.deselectItem(b);var a=this.furniture.indexOf(b);var c=a===-1?this.getPieceOfFurnitureGroup(b,null,this.furniture):null;if(a!==-1||c!==null){b.setLevel(null);this.furniture=this.furniture.slice(0);if(c!==null){c.deletePieceOfFurniture(b);this.furnitureChangeSupport.fireCollectionChanged(b,CollectionEvent.Type.DELETE)}else{this.furniture.splice(a,1);this.furnitureChangeSupport.fireCollectionChanged(b,a,CollectionEvent.Type.DELETE)}}};Home.prototype.getPieceOfFurnitureGroup=function(c,b,e){for(var a=0;a<e.length;a++){var d=e[a];if(d===c){return b}else{if(d instanceof HomeFurnitureGroup){var f=this.getPieceOfFurnitureGroup(c,d,d.getFurniture());if(f!==null){return f}}}}return null};Home.prototype.addSelectionListener=function(a){this.selectionListeners.push(a)};Home.prototype.removeSelectionListener=function(b){var a=this.selectionListeners.indexOf(b);if(a!==-1){this.selectionListeners.splice(a,1)}};Home.prototype.getSelectedItems=function(){return this.selectedItems};Home.prototype.setSelectedItems=function(d){this.selectedItems=d.slice(0);if(this.selectionListeners.length!==0){var a=new SelectionEvent(this,this.getSelectedItems());var c=this.selectionListeners.slice(0);for(var b=0;b<c.length;b++){c[b](a)}}};Home.prototype.deselectItem=function(b){var a=this.selectedItems.indexOf(b);if(a!==-1){var c=this.getSelectedItems().slice(0);c.splice(a,1);this.setSelectedItems(c)}};Home.prototype.addRoomsListener=function(a){this.roomsChangeSupport.addCollectionListener(a)};Home.prototype.removeRoomsListener=function(a){this.roomsChangeSupport.removeCollectionListener(a)};Home.prototype.getRooms=function(){return this.rooms};Home.prototype.addRoom=function(b,a){if(a===undefined){a=this.rooms.length}this.rooms=this.rooms.slice(0);this.rooms.splice(a,0,b);b.setLevel(this.selectedLevel);this.roomsChangeSupport.fireCollectionChanged(b,a,CollectionEvent.Type.ADD)};Home.prototype.deleteRoom=function(b){this.deselectItem(b);var a=this.rooms.indexOf(b);if(a!==-1){b.setLevel(null);this.rooms=this.rooms.slice(0);this.rooms.splice(a,1);this.roomsChangeSupport.fireCollectionChanged(b,a,CollectionEvent.Type.DELETE)}};Home.prototype.addWallsListener=function(a){this.wallsChangeSupport.addCollectionListener(a)};Home.prototype.removeWallsListener=function(a){this.wallsChangeSupport.removeCollectionListener(a)};Home.prototype.getWalls=function(){return this.walls};Home.prototype.addWall=function(a){this.walls=this.walls.slice(0);this.walls.push(a);a.setLevel(this.selectedLevel);this.wallsChangeSupport.fireCollectionChanged(a,CollectionEvent.Type.ADD)};Home.prototype.deleteWall=function(a){this.deselectItem(a);var c=this.getWalls();for(var d=0;d<c.length;d++){var e=c[d];if(a===e.getWallAtStart()){e.setWallAtStart(null)}else{if(a===e.getWallAtEnd()){e.setWallAtEnd(null)}}}var b=this.walls.indexOf(a);if(b!==-1){a.setLevel(null);this.walls=this.walls.slice(0);this.walls.splice(b,1);this.wallsChangeSupport.fireCollectionChanged(a,CollectionEvent.Type.DELETE)}};Home.prototype.addPolylinesListener=function(a){this.polylinesChangeSupport.addCollectionListener(a)};Home.prototype.removePolylinesListener=function(a){this.polylinesChangeSupport.removeCollectionListener(a)};Home.prototype.getPolylines=function(){return this.polylines};Home.prototype.addPolyline=function(a,b){if(b===undefined){b=this.polylines.length}this.polylines=this.polylines.slice(0);this.polylines.splice(b,0,a);a.setLevel(this.selectedLevel);this.polylinesChangeSupport.fireCollectionChanged(a,CollectionEvent.Type.ADD)};Home.prototype.deletePolyline=function(a){this.deselectItem(a);var b=this.polylines.indexOf(a);if(b!==-1){a.setLevel(null);this.polylines=this.polylines.slice(0);this.polylines.splice(b,1);this.polylinesChangeSupport.fireCollectionChanged(a,CollectionEvent.Type.DELETE)}};Home.prototype.addDimensionLinesListener=function(a){this.dimensionLinesChangeSupport.addCollectionListener(a)};Home.prototype.removeDimensionLinesListener=function(a){this.dimensionLinesChangeSupport.removeCollectionListener(a)};Home.prototype.getDimensionLines=function(){return this.dimensionLines};Home.prototype.addDimensionLine=function(a){this.dimensionLines=this.dimensionLines.slice(0);this.dimensionLines.push(a);a.setLevel(this.selectedLevel);this.dimensionLinesChangeSupport.fireCollectionChanged(a,CollectionEvent.Type.ADD)};Home.prototype.deleteDimensionLine=function(a){this.deselectItem(a);var b=this.dimensionLines.indexOf(a);if(b!==-1){a.setLevel(null);this.dimensionLines=this.dimensionLines.slice(0);this.dimensionLines.splice(b,1);this.dimensionLinesChangeSupport.fireCollectionChanged(a,CollectionEvent.Type.DELETE)}};Home.prototype.addLabelsListener=function(a){this.labelsChangeSupport.addCollectionListener(a)};Home.prototype.removeLabelsListener=function(a){this.labelsChangeSupport.removeCollectionListener(a)};Home.prototype.getLabels=function(){return this.labels};Home.prototype.addLabel=function(a){this.labels=this.labels.slice(0);this.labels.push(a);a.setLevel(this.selectedLevel);this.labelsChangeSupport.fireCollectionChanged(a,CollectionEvent.Type.ADD)};Home.prototype.deleteLabel=function(b){this.deselectItem(b);var a=this.labels.indexOf(b);if(a!==-1){b.setLevel(null);this.labels=this.labels.slice(0);this.labels.splice(a,1);this.labelsChangeSupport.fireCollectionChanged(b,CollectionEvent.Type.DELETE)}};Home.prototype.getSelectableViewableItems=function(){var b=[];this.addViewableItems(this.walls,b);this.addViewableItems(this.rooms,b);this.addViewableItems(this.dimensionLines,b);this.addViewableItems(this.polylines,b);this.addViewableItems(this.labels,b);var d=this.getFurniture();for(var a=0;a<d.length;a++){var c=d[a];if(c.isVisible()&&(c.getLevel()===null||c.getLevel().isViewable())){b.push(c)}}if(this.getCompass().isVisible()){b.push(getCompass())}return b};Home.prototype.addViewableItems=function(a,e){for(var b=0;b<a.length;b++){var c=a[b];if(c.getLevel){var d=c;if(d.getLevel()===null||d.getLevel().isViewable()){e.push(c)}}}};Home.prototype.isEmpty=function(){return this.furniture.length===0&&this.walls.length===0&&this.rooms.length===0&&this.dimensionLines.length===0&&this.polylines.length===0&&this.labels.length===0};Home.prototype.addPropertyChangeListener=function(b,a){this.propertyChangeSupport.addPropertyChangeListener(b,a)};Home.prototype.removePropertyChangeListener=function(b,a){this.propertyChangeSupport.removePropertyChangeListener(b,a)};Home.prototype.getWallHeight=function(){return this.wallHeight};Home.prototype.getName=function(){return this.name};Home.prototype.setName=function(a){if(a!=this.name){var b=this.name;this.name=a;this.propertyChangeSupport.firePropertyChange("NAME",b,a)}};Home.prototype.isModified=function(){return this.modified};Home.prototype.setModified=function(a){if(a!==this.modified){this.modified=a;this.propertyChangeSupport.firePropertyChange("MODIFIED",!a,a)}};Home.prototype.isRecovered=function(){return this.recovered};Home.prototype.setRecovered=function(a){if(a!==this.recovered){this.recovered=a;this.propertyChangeSupport.firePropertyChange("RECOVERED",!a,a)}};Home.prototype.isRepaired=function(){return this.repaired};Home.prototype.setRepaired=function(a){if(a!==this.repaired){this.repaired=a;this.propertyChangeSupport.firePropertyChange("REPAIRED",!a,a)}};Home.prototype.getFurnitureSortedProperty=function(){return this.furnitureSortedProperty};Home.prototype.setFurnitureSortedProperty=function(a){if(a!=this.furnitureSortedProperty){var b=this.furnitureSortedProperty;this.furnitureSortedProperty=a;this.propertyChangeSupport.firePropertyChange("FURNITURE_SORTED_PROPERTY",b,a)}};Home.prototype.isFurnitureDescendingSorted=function(){return this.furnitureDescendingSorted};Home.prototype.setFurnitureDescendingSorted=function(a){if(a!==this.furnitureDescendingSorted){this.furnitureDescendingSorted=a;this.propertyChangeSupport.firePropertyChange("FURNITURE_DESCENDING_SORTED",!a,a)}};Home.prototype.getFurnitureVisibleProperties=function(){if(this.furnitureVisibleProperties===null){return[]}else{return this.furnitureVisibleProperties}};Home.prototype.setFurnitureVisibleProperties=function(b){if(b!==this.furnitureVisibleProperties){var a=this.furnitureVisibleProperties;this.furnitureVisibleProperties=b.slice(0);this.propertyChangeSupport.firePropertyChange("FURNITURE_VISIBLE_PROPERTIES",Collections.unmodifiableList(a),Collections.unmodifiableList(b))}};Home.prototype.getBackgroundImage=function(){return this.backgroundImage};Home.prototype.setBackgroundImage=function(b){if(b!==this.backgroundImage){var a=this.backgroundImage;this.backgroundImage=b;this.propertyChangeSupport.firePropertyChange("BACKGROUND_IMAGE",a,b)}};Home.prototype.getTopCamera=function(){return this.topCamera};Home.prototype.getObserverCamera=function(){return this.observerCamera};Home.prototype.setCamera=function(b){if(b!==this.camera){var a=this.camera;this.camera=b;this.propertyChangeSupport.firePropertyChange("CAMERA",a,b)}};Home.prototype.getCamera=function(){if(this.camera===null){this.camera=this.getTopCamera()}return this.camera};Home.prototype.setStoredCameras=function(b){if(this.storedCameras!==b){var a=this.storedCameras;if(b===null){this.storedCameras=[]}else{this.storedCameras=b.slice(0)}this.propertyChangeSupport.firePropertyChange("STORED_CAMERAS",a,b)}};Home.prototype.getStoredCameras=function(){return this.storedCameras};Home.prototype.getEnvironment=function(){return this.environment};Home.prototype.getCompass=function(){if(this.compass===null){this.compass=new Compass(-100,50,100);this.compass.setVisible(true)}return this.compass};Home.prototype.getPrint=function(){return this.print};Home.prototype.setPrint=function(a){if(a!==this.print){var b=this.print;this.print=a;this.propertyChangeSupport.firePropertyChange(PRINT,b,a)}this.print=a};Home.prototype.getProperty=function(a){return this.properties[a]};Home.prototype.getNumericProperty=function(a){var b=this.properties[a];if(b!==undefined){number=parseFloat(b);if(!isNaN(number)){return number}}return null};Home.prototype.setProperty=function(a,b){if(b===null){if(this.properties.hasOwnProperty(a)){delete this.properties[a]}}else{this.properties[a]=b}};Home.prototype.getPropertyNames=function(){return Object.keys(this.properties)};Home.prototype.isBasePlanLocked=function(){return this.basePlanLocked};Home.prototype.setBasePlanLocked=function(a){if(a!==this.basePlanLocked){this.basePlanLocked=a;this.propertyChangeSupport.firePropertyChange("BASE_PLAN_LOCKED",!a,a)}};Home.prototype.getVersion=function(){return this.version};Home.prototype.setVersion=function(a){this.version=a};Home.prototype.clone=function(){return new Home(this)};Home.copyHomeData=function(a,f){f.allLevelsSelection=a.allLevelsSelection;f.name=a.name;f.modified=a.modified;f.recovered=a.recovered;f.repaired=a.repaired;f.backgroundImage=a.backgroundImage;f.print=a.print;f.furnitureDescendingSorted=a.furnitureDescendingSorted;f.version=a.version;f.basePlanLocked=a.basePlanLocked;f.furnitureSortedProperty=a.furnitureSortedProperty;f.furnitureVisibleProperties=a.furnitureVisibleProperties;f.selectedItems=[];f.furniture=Home.cloneSelectableItems(a.furniture,a.selectedItems,f.selectedItems);for(var b=0;b<a.furniture.length;b++){var n=a.furniture[b];if(typeof HomeDoorOrWindow!=="undefined"&&n instanceof HomeDoorOrWindow&&n.isBoundToWall()){f.furniture[b].setBoundToWall(true)}}f.rooms=Home.cloneSelectableItems(a.rooms,a.selectedItems,f.selectedItems);f.dimensionLines=Home.cloneSelectableItems(a.dimensionLines,a.selectedItems,f.selectedItems);f.polylines=Home.cloneSelectableItems(a.polylines,a.selectedItems,f.selectedItems);f.labels=Home.cloneSelectableItems(a.labels,a.selectedItems,f.selectedItems);if(typeof Wall!=="undefined"){f.walls=Wall.clone(a.walls)}else{f.walls=[]}for(var b=0;b<a.walls.length;b++){var h=a.walls[b];if(a.selectedItems.contains(h)){f.selectedItems.push(f.walls[b])}}f.levels=[];if(a.levels.length>0){for(var b=0;b<a.levels.length;b++){f.levels.push(a.levels[b].clone())}for(var b=0;b<a.furniture.length;b++){var j=a.furniture[b].getLevel();if(j!==null){f.furniture[b].setLevel(f.levels[a.levels.indexOf(j)])}}for(var b=0;b<a.rooms.length;b++){var m=a.rooms[b].getLevel();if(m!==null){f.rooms[b].setLevel(f.levels.get(a.levels.indexOf(m)))}}for(var b=0;b<a.dimensionLines.length;b++){var l=a.dimensionLines[b].getLevel();if(l!==null){f.dimensionLines[b].setLevel(f.levels[a.levels.indexOf(l)])}}for(var b=0;b<a.polylines.length;b++){var g=a.polylines[b].getLevel();if(g!==null){f.polylines[b].setLevel(f.levels[a.levels.indexOf(g)])}}for(var b=0;b<a.labels.length;b++){var e=a.labels[b].getLevel();if(e!==null){f.labels[b].setLevel(f.levels[a.levels.indexOf(e)])}}for(var b=0;b<a.walls.length;b++){var d=a.walls[b].getLevel();if(d!==null){f.walls[b].setLevel(f.levels[a.levels.indexOf(d)])}}if(a.selectedLevel!==null){f.selectedLevel=f.levels[a.levels.indexOf(a.selectedLevel)]}}else{f.selectedLevel=null}f.observerCamera=a.observerCamera.clone();f.topCamera=a.topCamera.clone();if(a.camera===a.observerCamera){f.camera=f.observerCamera;if(a.selectedItems.indexOf(a.observerCamera)!==-1){f.selectedItems.push(f.observerCamera)}}else{f.camera=f.topCamera}f.storedCameras=new Array(a.storedCameras.length);for(var b=0;b<a.storedCameras.length;b++){var c=a.storedCameras[b];f.storedCameras[b]=c.clone()}f.environment=a.environment.clone();if(a.compass!==null){f.compass=a.compass.clone()}f.furnitureVisibleProperties=a.furnitureVisibleProperties.slice(0);f.properties={};for(var k in a.properties){if(a.properties.hasOwnProperty(k)){f.properties[k]=a.properties[k]}}f.structure=a.structure};Home.cloneSelectableItems=function(a,g,b){var k=new Array(a.length);for(var f=0;f<a.length;f++){var l=a[f];var h=l.clone();k[f]=h;if(g.indexOf(l)!==-1){b.push(h)}else{if(l instanceof HomeFurnitureGroup){var m=l.getAllFurniture();var c=null;for(var e=0,d=m.length;e<d;e++){var o=m[e];if(g.indexOf(o)!==-1){if(c===null){c=h.getAllFurniture()}b.push(c[e])}}}}}return k};Home.duplicate=function(a){var d=[];for(var b=0;b<a.length;b++){var c=a[b];if(!(c instanceof Wall)&&!(c instanceof Camera)&&!(c instanceof Compass)){d.push(c.clone())}}d.push.apply(d,Wall.clone(Home.getWallsSubList(a)));return d};Home.getFurnitureSubList=function(a){return Home.getSubList(a,HomePieceOfFurniture)};Home.getWallsSubList=function(a){if(typeof Wall!=="undefined"){return Home.getSubList(a,Wall)}else{return[]}};Home.getRoomsSubList=function(a){if(typeof Room!=="undefined"){return Home.getSubList(a,Room)}else{return[]}};Home.getPolylinesSubList=function(a){if(typeof Polyline!=="undefined"){return Home.getSubList(a,Polyline)}else{return[]}};Home.getDimensionLinesSubList=function(a){if(typeof DimensionLine!=="undefined"){return Home.getSubList(a,DimensionLine)}else{return[]}};Home.getLabelsSubList=function(a){if(typeof Label!=="undefined"){return Home.getSubList(a,Label)}else{return[]}};Home.getSubList=function(b,e){var a=[];for(var c=0;c<b.length;c++){var d=b[c];if(d instanceof e){a.push(d)}}return a};var LengthUnit={};LengthUnit.getMagnetizedMeterLength=function(d,a){a*=2;var b=1/10;if(a>100){b=100}else{if(a>10){b=10}else{if(a>5){b=5}else{if(a>1){b=1}else{if(a>0.5){b=0.5}}}}}var c=Math.round(d/b)*b;if(c===0&&d>0){return d}else{return c}};LengthUnit.getMagnetizedInchLength=function(d,a){a=LengthUnit.centimeterToInch(a)*2;var b=1/8;if(a>6){b=6}else{if(a>3){b=3}else{if(a>1){b=1}else{if(a>0.5){b=0.5}else{if(a>0.25){b=0.25}}}}}var c=LengthUnit.inchToCentimeter(Math.round(LengthUnit.centimeterToInch(d)/b)*b);if(c===0&&d>0){return d}else{return c}};LengthUnit.centimeterToInch=function(a){return a/2.54};LengthUnit.centimeterToFoot=function(a){return a/2.54/12};LengthUnit.inchToCentimeter=function(a){return a*2.54};LengthUnit.footToCentimeter=function(a){return a*2.54*12};LengthUnit.MILLIMETER={formatLocale:null};LengthUnit.MILLIMETER.getFormatWithUnit=function(){this.checkLocaleChange();return this.lengthFormatWithUnit};LengthUnit.MILLIMETER.getAreaFormatWithUnit=function(){this.checkLocaleChange();return this.areaFormatWithUnit};LengthUnit.MILLIMETER.getFormat=function(){this.checkLocaleChange();return this.lengthFormat};LengthUnit.MILLIMETER.getName=function(){this.checkLocaleChange();return this.name};LengthUnit.MILLIMETER.checkLocaleChange=function(){throw new UnsupportedOperationException("Not implemented yet");if(!Locale.getDefault().equals(this.formatLocale)){this.formatLocale=Locale.getDefault();var b=ResourceBundle.getBundle(LengthUnit.name);this.name=b.getString("millimeterUnit");this.lengthFormatWithUnit=new MeterFamilyFormat("#,##0 "+this.name,10);this.lengthFormat=new MeterFamilyFormat("#,##0",10);var a=b.getString("squareMeterUnit");this.areaFormatWithUnit=new SquareMeterAreaFormatWithUnit(a)}};LengthUnit.MILLIMETER.getMagnetizedLength=function(b,a){return LengthUnit.getMagnetizedMeterLength(b,a)};LengthUnit.MILLIMETER.getMinimumLength=function(){return 0.1};LengthUnit.MILLIMETER.getMaximumLength=function(){return 100000};LengthUnit.MILLIMETER.getMaximumElevation=function(){return this.getMaximumLength()/10};LengthUnit.MILLIMETER.centimeterToUnit=function(a){return a*10};LengthUnit.MILLIMETER.unitToCentimeter=function(a){return a/10};LengthUnit.CENTIMETER={formatLocale:null};LengthUnit.CENTIMETER.getFormatWithUnit=function(){this.checkLocaleChange();return this.lengthFormatWithUnit};LengthUnit.CENTIMETER.getAreaFormatWithUnit=function(){this.checkLocaleChange();return this.areaFormatWithUnit};LengthUnit.CENTIMETER.getFormat=function(){this.checkLocaleChange();return this.lengthFormat};LengthUnit.CENTIMETER.getName=function(){this.checkLocaleChange();return this.name};LengthUnit.CENTIMETER.checkLocaleChange=function(){throw new UnsupportedOperationException("Not implemented yet");if(!Locale.getDefault().equals(this.formatLocale)){this.formatLocale=Locale.getDefault();var b=ResourceBundle.getBundle(LengthUnit.name);this.name=b.getString("centimeterUnit");this.lengthFormatWithUnit=new MeterFamilyFormat("#,##0.# "+this.name,1);this.lengthFormat=new MeterFamilyFormat("#,##0.#",1);var a=b.getString("squareMeterUnit");this.areaFormatWithUnit=new SquareMeterAreaFormatWithUnit(a)}};LengthUnit.CENTIMETER.getMagnetizedLength=function(b,a){return LengthUnit.getMagnetizedMeterLength(b,a)};LengthUnit.CENTIMETER.getMinimumLength=function(){return 0.1};LengthUnit.CENTIMETER.getMaximumLength=function(){return 100000};LengthUnit.CENTIMETER.getMaximumElevation=function(){return this.getMaximumLength()/10};LengthUnit.CENTIMETER.centimeterToUnit=function(a){return a};LengthUnit.CENTIMETER.unitToCentimeter=function(a){return a};LengthUnit.METER={formatLocale:null};LengthUnit.METER.getFormatWithUnit=function(){this.checkLocaleChange();return this.lengthFormatWithUnit};LengthUnit.METER.getAreaFormatWithUnit=function(){this.checkLocaleChange();return this.areaFormatWithUnit};LengthUnit.METER.getFormat=function(){this.checkLocaleChange();return this.lengthFormat};LengthUnit.METER.getName=function(){this.checkLocaleChange();return this.name};LengthUnit.METER.checkLocaleChange=function(){throw new UnsupportedOperationException("Not implemented yet");if(!Locale.getDefault().equals(this.formatLocale)){this.formatLocale=Locale.getDefault();var b=ResourceBundle.getBundle(LengthUnit.name);this.name=b.getString("meterUnit");this.lengthFormatWithUnit=new MeterFamilyFormat("#,##0.00# "+this.name,0.01);this.lengthFormat=new MeterFamilyFormat("#,##0.00#",0.01);var a=b.getString("squareMeterUnit");this.areaFormatWithUnit=new SquareMeterAreaFormatWithUnit(a)}};LengthUnit.METER.getMagnetizedLength=function(b,a){return LengthUnit.getMagnetizedMeterLength(b,a)};LengthUnit.METER.getMinimumLength=function(){return 0.1};LengthUnit.METER.getMaximumLength=function(){return 100000};LengthUnit.METER.getMaximumElevation=function(){return this.getMaximumLength()/10};LengthUnit.METER.centimeterToUnit=function(a){return a/100};LengthUnit.METER.unitToCentimeter=function(a){return a*100};LengthUnit.INCH={formatLocale:null};LengthUnit.INCH.getFormatWithUnit=function(){this.checkLocaleChange();return this.lengthFormat};LengthUnit.INCH.getFormat=function(){return this.getFormatWithUnit()};LengthUnit.INCH.getAreaFormatWithUnit=function(){this.checkLocaleChange();return this.areaFormatWithUnit};LengthUnit.INCH.getName=function(){this.checkLocaleChange();return this.name};LengthUnit.INCH.checkLocaleChange=function(){throw new UnsupportedOperationException("Not implemented yet");if(!Locale.getDefault().equals(this.formatLocale)){this.formatLocale=Locale.getDefault();var b=ResourceBundle.getBundle(LengthUnit.name);this.name=b.getString("inchUnit");var a=b.getString("squareFootUnit");this.areaFormatWithUnit=new SquareFootAreaFormatWithUnit("#,##0 "+a)}};LengthUnit.INCH.getMagnetizedLength=function(b,a){return LengthUnit.getMagnetizedInchLength(b,a)};LengthUnit.INCH.getMinimumLength=function(){return LengthUnit.inchToCentimeter(0.125)};LengthUnit.INCH.getMaximumLength=function(){return LengthUnit.inchToCentimeter(99974.4)};LengthUnit.INCH.getMaximumElevation=function(){return this.getMaximumLength()/10};LengthUnit.INCH.centimeterToUnit=function(a){return LengthUnit.centimeterToInch(a)};LengthUnit.INCH.unitToCentimeter=function(a){return LengthUnit.inchToCentimeter(a)};LengthUnit.INCH_DECIMALS={formatLocale:null};LengthUnit.INCH_DECIMALS.getFormatWithUnit=function(){this.checkLocaleChange();return this.lengthFormatWithUnit};LengthUnit.INCH_DECIMALS.getFormat=function(){this.checkLocaleChange();return this.lengthFormat};LengthUnit.INCH_DECIMALS.getAreaFormatWithUnit=function(){this.checkLocaleChange();return this.areaFormatWithUnit};LengthUnit.INCH_DECIMALS.getName=function(){this.checkLocaleChange();return this.name};LengthUnit.INCH_DECIMALS.checkLocaleChange=function(){throw new UnsupportedOperationException("Not implemented yet");if(!Locale.getDefault().equals(this.formatLocale)){this.formatLocale=Locale.getDefault();var b=ResourceBundle.getBundle(LengthUnit.name);this.name=b.getString("inchUnit");this.lengthFormat=new InchDecimalsFormat(new MessageFormat(b.getString("inchDecimalsFormat")));this.lengthFormatWithUnit=new InchDecimalsFormat(new MessageFormat(b.getString("inchDecimalsFormatWithUnit")));var a=b.getString("squareFootUnit");this.areaFormatWithUnit=new SquareFootAreaFormatWithUnit("#,##0.## "+a)}};LengthUnit.INCH_DECIMALS.getMagnetizedLength=function(b,a){return LengthUnit.getMagnetizedInchLength(b,a)};LengthUnit.INCH_DECIMALS.getMinimumLength=function(){return LengthUnit.inchToCentimeter(0.125)};LengthUnit.INCH_DECIMALS.getMaximumLength=function(){return LengthUnit.inchToCentimeter(99974.4)};LengthUnit.INCH_DECIMALS.getMaximumElevation=function(){return this.getMaximumLength()/10};LengthUnit.INCH_DECIMALS.centimeterToUnit=function(a){return centimeterToInch(a)};LengthUnit.INCH_DECIMALS.unitToCentimeter=function(a){return LengthUnit.inchToCentimeter(a)};function UserPreferences(){this.propertyChangeSupport=new PropertyChangeSupport(this);this.supportedLanguages=UserPreferences.DEFAULT_SUPPORTED_LANGUAGES;this.defaultCountry=navigator.language.substring(navigator.language.indexOf("_")+1,navigator.language.length);var c=navigator.language.substring(0,navigator.language.indexOf("_"));for(var a=0;a<this.supportedLanguages;a++){var b=this.supportedLanguages[a];if(b==c+"_"+this.defaultCountry){this.language=b;break}else{if(this.language===null&&b.indexOf(c)===0){this.language=b}}}if(this.language===null){this.language="en"}this.resourceBundles={};this.furnitureCatalog=null;this.texturesCatalog=null;this.patternsCatalog=null;this.currency=null;this.unit=null;this.furnitureCatalogViewedInTree=true;this.aerialViewCenteredOnSelectionEnabled=false;this.navigationPanelVisible=true;this.magnetismEnabled=true;this.rulersVisible=true;this.gridVisible=true;this.defaultFontName=null;this.furnitureViewedFromTop=true;this.roomFloorColoredOrTextured=true;this.wallPattern=null;this.newWallPattern=null;this.newWallThickness=7.5;this.newWallHeight=250;this.newWallBaseboardThickness=1;this.newWallBaseboardHeight=7;this.newFloorThickness=12;this.recentHomes=[];this.autoSaveDelayForRecovery;this.autoCompletionStrings={};this.recentColors=[];this.recentTextures=[]}UserPreferences.DEFAULT_SUPPORTED_LANGUAGES=["en"];UserPreferences.DEFAULT_TEXT_STYLE=new TextStyle(18);UserPreferences.DEFAULT_ROOM_TEXT_STYLE=new TextStyle(24);UserPreferences.prototype.addPropertyChangeListener=function(b,a){this.propertyChangeSupport.addPropertyChangeListener(b,a)};UserPreferences.prototype.removePropertyChangeListener=function(b,a){this.propertyChangeSupport.removePropertyChangeListener(b,a)};UserPreferences.prototype.getFurnitureCatalog=function(){return this.furnitureCatalog};UserPreferences.prototype.setFurnitureCatalog=function(a){this.furnitureCatalog=a};UserPreferences.prototype.getTexturesCatalog=function(){return this.texturesCatalog};UserPreferences.prototype.setTexturesCatalog=function(a){this.texturesCatalog=a};UserPreferences.prototype.getPatternsCatalog=function(){return this.patternsCatalog};UserPreferences.prototype.setPatternsCatalog=function(a){this.patternsCatalog=a};UserPreferences.prototype.getLengthUnit=function(){return this.unit};UserPreferences.prototype.setUnit=function(a){if(this.unit!==a){var b=this.unit;this.unit=a;this.propertyChangeSupport.firePropertyChange("UNIT",b,a)}};UserPreferences.prototype.getLanguage=function(){return this.language};UserPreferences.prototype.setLanguage=function(b){if(b!=this.language&&this.isLanguageEditable()){var a=this.language;this.language=b;this.propertyChangeSupport.firePropertyChange("LANGUAGE",a,b)}};UserPreferences.prototype.isLanguageEditable=function(){return true};UserPreferences.prototype.getDefaultSupportedLanguages=function(){return UserPreferences.DEFAULT_SUPPORTED_LANGUAGES.slice(0)};UserPreferences.prototype.getSupportedLanguages=function(){return this.supportedLanguages.slice(0)};UserPreferences.prototype.setSupportedLanguages=function(a){if(this.supportedLanguages!=a){var b=this.supportedLanguages;this.supportedLanguages=a.slice(0);this.propertyChangeSupport.firePropertyChange("SUPPORTED_LANGUAGES",b,a)}};UserPreferences.prototype.getLocalizedString=function(c,j,i){throw new UnsupportedOperationException("Not implemented yet");if(typeof c!=="string"){var e=this.classResourceBundles[c];if(e===null){try{e=this.getResourceBundle(c.constructor.name);this.classResourceBundles[c.constructor.name]=e}catch(h){try{var g=c.constructor.name;var d=g.lastIndexOf(".");var f;if(d!==-1){f=g.substring(0,d)+".package"}else{f="package"}e=new PrefixedResourceBundle(getResourceBundle(f),c.constructor.name+".");this.classResourceBundles[c.constructor.name]=e}catch(a){throw new IllegalArgumentException("Can't find resource bundle for "+c,h)}}}return this.getBundleLocalizedString(e,j,i)}else{var f=c;try{var b=this.getResourceBundle(f);return this.getBundleLocalizedString(b,j,i)}catch(h){throw new IllegalArgumentException("Can't find resource bundle for "+f,h)}}};UserPreferences.prototype.getResourceBundle=function(h){h=h.replace(".","/");var b=this.resourceBundles.get(h);if(b!==null){return b}var p=this.language;var e=p.getLanguage();var c=p.getCountry();var o=[".properties","_"+e+".properties","_"+e+"_"+c+".properties"];for(var f=0;f<o.length;f++){var n=o[f];var g=this.getResourceClassLoaders();for(var d=0;d<g.length;d++){var a=g[d];var m=a.getResourceAsStream(h+n);if(m!==null){var k=b;try{b=new PropertyResourceBundle(m);b.setParent(k);break}catch(l){l.printStackTrace()}finally{m.close()}}}}if(b===null){throw new IOException("No available resource bundle for "+h)}this.resourceBundles.put(h,b);return b};UserPreferences.prototype.getBundleLocalizedString=function(d,c,e){try{var a=d.getString(c);if(e.length>0){a=String.format(a,e)}return a}catch(b){throw new IllegalArgumentException("Unknown key "+c)}};UserPreferences.prototype.getResourceClassLoaders=function(){throw new UnsupportedOperationException("Not implemented yet");return DEFAULT_CLASS_LOADER};UserPreferences.prototype.getCurrency=function(){return this.currency};UserPreferences.prototype.setCurrency=function(a){this.currency=a};UserPreferences.prototype.isFurnitureCatalogViewedInTree=function(){return this.furnitureCatalogViewedInTree};UserPreferences.prototype.setFurnitureCatalogViewedInTree=function(a){if(this.furnitureCatalogViewedInTree!==a){this.furnitureCatalogViewedInTree=a;this.propertyChangeSupport.firePropertyChange("FURNITURE_CATALOG_VIEWED_IN_TREE",!a,a)}};UserPreferences.prototype.isNavigationPanelVisible=function(){return this.navigationPanelVisible};UserPreferences.prototype.setNavigationPanelVisible=function(a){if(this.navigationPanelVisible!==a){this.navigationPanelVisible=a;this.propertyChangeSupport.firePropertyChange("NAVIGATION_PANEL_VISIBLE",!a,a)}};UserPreferences.prototype.setAerialViewCenteredOnSelectionEnabled=function(a){if(a!==this.aerialViewCenteredOnSelectionEnabled){this.aerialViewCenteredOnSelectionEnabled=a;this.propertyChangeSupport.firePropertyChange("AERIAL_VIEW_CENTERED_ON_SELECTION_ENABLED",!a,a)}};UserPreferences.prototype.isAerialViewCenteredOnSelectionEnabled=function(){return this.aerialViewCenteredOnSelectionEnabled};UserPreferences.prototype.isMagnetismEnabled=function(){return this.magnetismEnabled};UserPreferences.prototype.setMagnetismEnabled=function(a){if(this.magnetismEnabled!==a){this.magnetismEnabled=a;this.propertyChangeSupport.firePropertyChange("MAGNETISM_ENABLED",!a,a)}};UserPreferences.prototype.isRulersVisible=function(){return this.rulersVisible};UserPreferences.prototype.setRulersVisible=function(a){if(this.rulersVisible!==a){this.rulersVisible=a;this.propertyChangeSupport.firePropertyChange("RULERS_VISIBLE",!a,a)}};UserPreferences.prototype.isGridVisible=function(){return this.gridVisible};UserPreferences.prototype.setGridVisible=function(a){if(this.gridVisible!==a){this.gridVisible=a;this.propertyChangeSupport.firePropertyChange("GRID_VISIBLE",!a,a)}};UserPreferences.prototype.getDefaultFontName=function(){return this.defaultFontName};UserPreferences.prototype.setDefaultFontName=function(b){if(b!=this.defaultFontName){var a=this.defaultFontName;this.defaultFontName=b;this.propertyChangeSupport.firePropertyChange("DEFAULT_FONT_NAME",a,b)}};UserPreferences.prototype.isFurnitureViewedFromTop=function(){return this.furnitureViewedFromTop};UserPreferences.prototype.setFurnitureViewedFromTop=function(a){if(this.furnitureViewedFromTop!==a){this.furnitureViewedFromTop=a;this.propertyChangeSupport.firePropertyChange("FURNITURE_VIEWED_FROM_TOP",!a,a)}};UserPreferences.prototype.isRoomFloorColoredOrTextured=function(){return this.roomFloorColoredOrTextured};UserPreferences.prototype.setFloorColoredOrTextured=function(a){if(this.roomFloorColoredOrTextured!==a){this.roomFloorColoredOrTextured=a;this.propertyChangeSupport.firePropertyChange("ROOM_FLOOR_COLORED_OR_TEXTURED",!a,a)}};UserPreferences.prototype.getWallPattern=function(){return this.wallPattern};UserPreferences.prototype.setWallPattern=function(a){if(this.wallPattern!==a){var b=this.wallPattern;this.wallPattern=a;this.propertyChangeSupport.firePropertyChange("WALL_PATTERN",b,a)}};UserPreferences.prototype.getNewWallPattern=function(){return this.newWallPattern};UserPreferences.prototype.setNewWallPattern=function(a){if(this.newWallPattern!==a){var b=this.newWallPattern;this.newWallPattern=a;this.propertyChangeSupport.firePropertyChange("NEW_WALL_PATTERN",b,a)}};UserPreferences.prototype.getNewWallThickness=function(){return this.newWallThickness};UserPreferences.prototype.setNewWallThickness=function(b){if(this.newWallThickness!==b){var a=this.newWallThickness;this.newWallThickness=b;this.propertyChangeSupport.firePropertyChange("NEW_WALL_THICKNESS",a,b)}};UserPreferences.prototype.getNewWallHeight=function(){return this.newWallHeight};UserPreferences.prototype.setNewWallHeight=function(a){if(this.newWallHeight!==a){var b=this.newWallHeight;this.newWallHeight=a;this.propertyChangeSupport.firePropertyChange("NEW_WALL_HEIGHT",b,a)}};UserPreferences.prototype.getNewWallBaseboardThickness=function(){return this.newWallBaseboardThickness};UserPreferences.prototype.setNewWallBaseboardThickness=function(b){if(this.newWallBaseboardThickness!==b){var a=this.newWallBaseboardThickness;this.newWallBaseboardThickness=b;this.propertyChangeSupport.firePropertyChange("NEW_WALL_SIDEBOARD_THICKNESS",a,b)}};UserPreferences.prototype.getNewWallBaseboardHeight=function(){return this.newWallBaseboardHeight};UserPreferences.prototype.setNewWallBaseboardHeight=function(a){if(this.newWallBaseboardHeight!==a){var b=this.newWallBaseboardHeight;this.newWallBaseboardHeight=a;this.propertyChangeSupport.firePropertyChange("NEW_WALL_SIDEBOARD_HEIGHT",b,a)}};UserPreferences.prototype.getNewFloorThickness=function(){return this.newFloorThickness};UserPreferences.prototype.setNewFloorThickness=function(a){if(this.newFloorThickness!==a){var b=this.newFloorThickness;this.newFloorThickness=a;this.propertyChangeSupport.firePropertyChange("NEW_FLOOR_THICKNESS",b,a)}};UserPreferences.prototype.getAutoSaveDelayForRecovery=function(){return this.autoSaveDelayForRecovery};UserPreferences.prototype.setAutoSaveDelayForRecovery=function(b){if(this.autoSaveDelayForRecovery!==b){var a=this.autoSaveDelayForRecovery;this.autoSaveDelayForRecovery=b;this.propertyChangeSupport.firePropertyChange("AUTO_SAVE_DELAY_FOR_RECOVERY",a,b)}};UserPreferences.prototype.getRecentHomes=function(){return Collections.unmodifiableList(this.recentHomes)};UserPreferences.prototype.setRecentHomes=function(b){if(b!=this.recentHomes){var a=this.recentHomes;this.recentHomes=new ArrayList<String>(b);this.propertyChangeSupport.firePropertyChange("RECENT_HOMES",a,this.getRecentHomes())}};UserPreferences.prototype.getRecentHomesMaxCount=function(){return 10};UserPreferences.prototype.getStoredCamerasMaxCount=function(){return 50};UserPreferences.prototype.setActionTipIgnored=function(a){this.propertyChangeSupport.firePropertyChange("IGNORED_ACTION_TIP",null,a)};UserPreferences.prototype.isActionTipIgnored=function(a){return true};UserPreferences.prototype.resetIgnoredActionTips=function(){this.propertyChangeSupport.firePropertyChange("IGNORED_ACTION_TIP",null,null)};UserPreferences.prototype.getDefaultTextStyle=function(a){if(a.name=="Room"){return UserPreferences.DEFAULT_ROOM_TEXT_STYLE}else{return UserPreferences.DEFAULT_TEXT_STYLE}};UserPreferences.prototype.getAutoCompletionStrings=function(b){var a=this.autoCompletionStrings.get(b);if(a!==null){return Collections.unmodifiableList(a)}else{return[]}};UserPreferences.prototype.addAutoCompletionString=function(c,b){if(b!==null&&b.length()>0){var a=this.autoCompletionStrings[c];if(a===undefined){a=[]}else{if(!a.contains(b)){a=new ArrayList<String>(a)}else{return}}a.splice(0,0,b);this.setAutoCompletionStrings(c,a)}};UserPreferences.prototype.setAutoCompletionStrings=function(b,c){var a=this.autoCompletionStrings[b];if(c!=a){this.autoCompletionStrings.put(b,c.slice(0));this.propertyChangeSupport.firePropertyChange("AUTO_COMPLETION_STRINGS",null,b)}};UserPreferences.prototype.getAutoCompletedProperties=function(){if(this.autoCompletionStrings!==null){return Object.keys(this.autoCompletionStrings)}else{return Collections.emptyList()}};UserPreferences.prototype.getRecentColors=function(){return this.recentColors};UserPreferences.prototype.setRecentColors=function(a){if(a!=this.recentColors){var b=this.recentColors;this.recentColors=a.slice(0);this.propertyChangeSupport.firePropertyChange("RECENT_COLORS",b,this.getRecentColors())}};UserPreferences.prototype.getRecentTextures=function(){return this.recentTextures};UserPreferences.prototype.setRecentTextures=function(b){if(b!=this.recentTextures){var a=this.recentTextures;this.recentTextures=b.slice(0);this.propertyChangeSupport.firePropertyChange("RECENT_TEXTURES",a,this.getRecentTextures())}};function DefaultUserPreferences(){UserPreferences.call(this);this.setUnit(LengthUnit.CENTIMETER);this.setNavigationPanelVisible(false)}DefaultUserPreferences.prototype=Object.create(UserPreferences.prototype);DefaultUserPreferences.prototype.constructor=DefaultUserPreferences;function HomeRecorder(){}HomeRecorder.READING_HOME="Reading home";HomeRecorder.PARSING_HOME="Parsing home";HomeRecorder.prototype.readHome=function(c,b){b.progression(HomeRecorder.READING_HOME,c,0);var a=this;ZIPTools.getZIP(c,{zipReady:function(e){try{var f=e.file("Home.xml");if(f!==null){a.parseHomeXMLEntry(e.file("Home.xml"),e,c,b)}else{this.zipError("No Home.xml entry in "+c)}}catch(d){this.zipError(d)}},zipError:function(d){if(b.homeError!==undefined){b.homeError(d)}},progression:function(e,f,d){if(b.progression!==undefined){b.progression(HomeRecorder.READING_HOME,c,d)}}})};HomeRecorder.prototype.parseHomeXMLEntry=function(g,c,d,b){var f=g.asText();b.progression(HomeRecorder.READING_HOME,g.name,1);b.progression(HomeRecorder.PARSING_HOME,g.name,0);var a=new DOMParser().parseFromString(f,"text/xml");var e=this.getHomeObject(a.documentElement,d,{});b.progression(HomeRecorder.PARSING_HOME,g.name,1);b.homeLoaded(e)};HomeRecorder.prototype.getHomeObject=function(a,b,c){switch(a.tagName){case"home":return this.getHome(a,b,c);case"furnitureGroup":case"pieceOfFurniture":case"doorOrWindow":case"light":return this.getPieceOfFurniture(a,b,c);default:return null}};HomeRecorder.prototype.getHome=function(j,b,d){var a=parseFloat(j.getAttribute("wallHeight"));if(isNaN(a)){a=undefined}var n=new Home(a);n.setVersion(parseInt(j.getAttribute("version")));n.setName(j.getAttribute("name"));this.parseProperties(j,n);var f=this.getHomeEnvironment(j.getElementsByTagName("environment")[0],b);var m=n.getEnvironment();m.setObserverCameraElevationAdjusted(f.isObserverCameraElevationAdjusted());m.setGroundColor(f.getGroundColor());m.setGroundTexture(f.getGroundTexture());m.setSkyColor(f.getSkyColor());m.setSkyTexture(f.getSkyTexture());m.setLightColor(f.getLightColor());m.setWallsAlpha(f.getWallsAlpha());m.setDrawingMode(f.getDrawingMode());m.setSubpartSizeUnderLight(f.getSubpartSizeUnderLight());m.setAllLevelsVisible(f.isAllLevelsVisible());m.setPhotoHeight(f.getPhotoHeight());m.setPhotoAspectRatio(f.getPhotoAspectRatio());m.setVideoWidth(f.getVideoWidth());m.setVideoAspectRatio(f.getVideoAspectRatio());m.setVideoQuality(f.getVideoQuality());m.setVideoFrameRate(f.getVideoFrameRate());m.setVideoCameraPath(f.getVideoCameraPath());var k=[];for(var h=0;h<j.childNodes.length;h++){var g=j.childNodes[h];if(g.tagName=="camera"||g.tagName=="observerCamera"){var l=this.getCamera(g,b);if(g.getAttribute("attribute")=="observerCamera"){n.getObserverCamera().setCamera(l)}else{if(g.getAttribute("attribute")=="topCamera"){n.getTopCamera().setCamera(l)}else{k.push(l)}}}else{if(g.tagName=="level"){break}}}n.setStoredCameras(k);n.setCamera(j.getAttribute("camera")=="observerCamera"?n.getObserverCamera():n.getTopCamera());var e=this.getLevels(j.getElementsByTagName("level"),b);for(var o in e){n.addLevel(e[o])}d.levelsMap=e;for(var h=0;h<j.childNodes.length;h++){var g=j.childNodes[h];var c=this.getHomeObject(g,b,d);if(c instanceof HomePieceOfFurniture){n.setSelectedLevel(c.getLevel());n.addPieceOfFurniture(c)}}n.setSelectedLevel(j.hasAttribute("selectedLevel")?e[j.getAttribute("selectedLevel")]:null);if(j.hasAttribute("structure")){n.structure=this.getContent(j,"structure",b)}return n};HomeRecorder.prototype.getHomeEnvironment=function(d,a){var r=d.hasAttribute("groundColor")?parseInt("0x"+d.getAttribute("groundColor")):null;var p=d.hasAttribute("skyColor")?parseInt("0x"+d.getAttribute("skyColor")):null;var j=parseInt("0x"+d.getAttribute("lightColor"));var e=d.hasAttribute("wallsAlpha")?parseFloat(d.getAttribute("wallsAlpha")):0;var s="true"==d.getAttribute("allLevelsVisible");var c="false"!=d.getAttribute("observerCameraElevationAdjusted");var n=d.getElementsByTagName("texture");var f=null;var h=null;for(var m=0;m<n.length;m++){var k=n[m];var g=this.getTexture(k,a);if(k.getAttribute("attribute")=="skyTexture"){h=g}else{if(k.getAttribute("attribute")=="groundTexture"){f=g}}}var l=[];for(var m=0;m<d.childNodes.length;m++){var b=d.childNodes[m];if(b.tagName=="camera"||b.tagName=="observerCamera"){var o=this.getCamera(b,a);if(b.getAttribute("attribute")=="cameraPath"){l.push(o)}}}var q=new HomeEnvironment(r,f,p,h,j,e);q.setAllLevelsVisible(s);q.setObserverCameraElevationAdjusted(c);q.setVideoCameraPath(l);return q};HomeRecorder.prototype.getCamera=function(j,d){var b=j.getAttribute("name");var i=j.getAttribute("lens");var n=parseFloat(j.getAttribute("x"));var m=parseFloat(j.getAttribute("y"));var l=parseFloat(j.getAttribute("z"));var f=parseFloat(j.getAttribute("yaw"));var c=parseFloat(j.getAttribute("pitch"));var h=parseFloat(j.getAttribute("fieldOfView"));var e=j.getAttribute("time");var a="true"==j.getAttribute("fixedSize");var g;if(i=="NORMAL"){g=Camera.Lens.NORMAL}else{if(i=="FISHEYE"){g=Camera.Lens.FISHEYE}else{if(i=="SPHERICAL"){g=Camera.Lens.SPHERICAL}else{g=Camera.Lens.PINHOLE}}}var k;if(j.tagName=="observerCamera"){k=new ObserverCamera(n,m,l,f,c,h,e,g);k.setFixedSize(a)}else{k=new Camera(n,m,l,f,c,h,e,g)}this.parseProperties(j,k);k.setName(b);return k};HomeRecorder.prototype.getLevels=function(k,d){var f={};for(var h=0;h<k.length;h++){var m=k[h];var c=m.getAttribute("id");var b=m.getAttribute("name");var o=parseFloat(m.getAttribute("elevation"));var j=parseFloat(m.getAttribute("floorThickness"));var n=parseFloat(m.getAttribute("height"));var l=parseInt(m.getAttribute("elevationIndex"));var e="false"!=m.getAttribute("visible");var g="false"!=m.getAttribute("viewable");var a=new Level(b,o,j,n);this.parseProperties(m,a);a.setElevationIndex(l);a.setVisible(e);a.setViewable(g);f[c]=a}return f};HomeRecorder.prototype.getPieceOfFurniture=function(E,b,c){var q=c.levelsMap;var k=E.hasAttribute("level")?q[E.getAttribute("level")]:null;var t=E.getAttribute("name");var w=E.hasAttribute("catalogId")?E.getAttribute("catalogId"):null;var C=E.hasAttribute("creator")?E.getAttribute("creator"):null;var e=this.getContent(E,"model",b);var r=this.getContent(E,"icon",b);var h=this.getContent(E,"planIcon",b);var N=parseFloat(E.getAttribute("x"));var K=parseFloat(E.getAttribute("y"));var n=E.hasAttribute("elevation")?parseFloat(E.getAttribute("elevation")):0;var z=E.hasAttribute("angle")?parseFloat(E.getAttribute("angle")):0;var a=parseFloat(E.getAttribute("width"));var o=parseFloat(E.getAttribute("depth"));var d=parseFloat(E.getAttribute("height"));var v="true"==E.getAttribute("backFaceShown");var j="true"==E.getAttribute("modelMirrored");var F="false"!=E.getAttribute("visible");var G=E.hasAttribute("color")?parseInt("0x"+E.getAttribute("color")):null;var m=E.hasAttribute("shininess")?parseFloat(E.getAttribute("shininess")):null;var T;if(E.hasAttribute("modelRotation")){var U=E.getAttribute("modelRotation").split(/\s+/);T=[[parseFloat(U[0]),parseFloat(U[1]),parseFloat(U[2])],[parseFloat(U[3]),parseFloat(U[4]),parseFloat(U[5])],[parseFloat(U[6]),parseFloat(U[7]),parseFloat(U[8])]]}else{T=null}var u=E.hasAttribute("description")?E.getAttribute("description"):null;var R=E.hasAttribute("information")?E.getAttribute("information"):null;var D="false"!=E.getAttribute("movable");var I="true"==E.getAttribute("doorOrWindow")||E.tagName=="doorOrWindow";var J="false"!=E.getAttribute("resizable");var p="false"!=E.getAttribute("deformable");var l="false"!=E.getAttribute("texturable");var H=E.hasAttribute("price")?new Big(E.getAttribute("price")):null;var g=E.hasAttribute("valueAddedTaxPercentage")?new Big(E.getAttribute("valueAddedTaxPercentage")):null;var P=E.hasAttribute("currency")?E.getAttribute("currency"):null;var M=E.hasAttribute("staircaseCutOutShape")?E.getAttribute("staircaseCutOutShape"):null;var f=E.hasAttribute("dropOnTopElevation")?parseFloat(E.getAttribute("dropOnTopElevation")):1;var L=[];var B=null;var O=null;for(var Q=0;Q<E.childNodes.length;Q++){var s=E.childNodes[Q];if(s.tagName=="texture"){B=this.getTexture(s,b)}else{if(s.tagName=="material"){if(O===null){O=[]}O.push(this.getMaterial(s,b))}else{var S=this.getHomeObject(s,b,c);if(S instanceof HomePieceOfFurniture){L.push(S)}}}}var A;if(E.tagName=="furnitureGroup"){A=new HomeFurnitureGroup(L,z,j,t);if(H!=null){A.setPrice(H)}A.setMovable(D)}else{A=new HomePieceOfFurniture(new CatalogPieceOfFurniture(w,t,u,R,null,null,null,r,h,e,a,o,d,n,f,D,I,G,M,T,v,C,J,p,l,H,g,P));A.setX(N);A.setY(K);A.setAngle(z);if(A.isResizable()){A.setModelMirrored(j)}if(A.isTexturable()){A.setTexture(B);A.setModelMaterials(O);A.setShininess(m)}}this.parseProperties(E,A);A.setVisible(F);A.setLevel(k);return A};HomeRecorder.prototype.parseProperties=function(d,a){for(var c=0;c<d.childNodes.length;c++){var b=d.childNodes[c];if(b.tagName=="property"){a.setProperty(b.getAttribute("name"),b.getAttribute("value"))}}};HomeRecorder.prototype.getMaterial=function(f,g){var b=f.getAttribute("name");var a=f.hasAttribute("color")?parseInt("0x"+f.getAttribute("color")):null;var d=f.hasAttribute("shininess")?parseFloat(f.getAttribute("shininess")):null;var c=f.hasAttribute("key")?f.getAttribute("key"):null;var e;var h=f.getElementsByTagName("texture");if(h.length!==0){e=this.getTexture(h[0],g)}else{e=null}return new HomeMaterial(b,c,a,e,d)};HomeRecorder.prototype.getTexture=function(g,c){var a=g.getAttribute("name");var f=g.getAttribute("catalogId");var b=parseFloat(g.getAttribute("width"));var h=parseFloat(g.getAttribute("height"));var e=g.hasAttribute("angle")?parseFloat(g.getAttribute("angle")):0;var i="false"!=g.getAttribute("leftToRightOriented");var d=this.getContent(g,"image",c);return new HomeTexture(new CatalogTexture(f,a,d,b,h,null),e,i)};HomeRecorder.prototype.getContent=function(b,a,d){if(b.hasAttribute(a)){var c=b.getAttribute(a);if(c.match(/\w+:\/\/\w+/)){return new URLContent(c)}else{return new URLContent("jar:"+d+"!/"+c)}}else{return null}};function Object3DBranch(){BranchGroup3D.call(this)}Object3DBranch.prototype=Object.create(BranchGroup3D.prototype);Object3DBranch.prototype.constructor=Object3DBranch;Object3DBranch.DEFAULT_COLOR=16777215;Object3DBranch.DEFAULT_AMBIENT_COLOR=3355443;Object3DBranch.prototype.updateAppearanceMaterial=function(a,d,b,c){if(d!==null){a.setAmbientColor(vec3.fromValues(((b>>>16)&255)/255,((b>>>8)&255)/255,(b&255)/255));a.setDiffuseColor(vec3.fromValues(((d>>>16)&255)/255,((d>>>8)&255)/255,(d&255)/255));a.setSpecularColor(vec3.fromValues(c,c,c));a.setShininess(c*128)}else{a.setAmbientColor(vec3.fromValues(0.2,0.2,0.2));a.setDiffuseColor(vec3.fromValues(1,1,1));a.setSpecularColor(vec3.fromValues(c,c,c));a.setShininess(c*128)}};Object3DBranch.prototype.getUserData=function(){return this.userData};Object3DBranch.prototype.setUserData=function(a){this.userData=a};function HomeComponent3D(e,d,c,b,a){this.home=d;this.object3dFactory=b!==null?b:new Object3DBranchFactory();this.approximateHomeBoundsCache=null;this.defaultLights=[];this.camera=null;this.windowSizeListener=null;this.cameraChangeListener=null;this.homeCameraListener=null;this.backgroundChangeListener=null;this.lightColorListener=null;this.elevationChangeListener=null;this.furnitureListener=null;this.furnitureChangeListener=null;this.createComponent3D(e,c,a)}HomeComponent3D.prototype.createComponent3D=function(d,c,a){this.canvas3D=new HTMLCanvas3D(d);if(a){this.addMouseListeners(a,this.canvas3D);if(c!==null){this.navigationPanelId=this.createNavigationPanel(this.home,c,a);this.setNavigationPanelVisible(c.isNavigationPanelVisible());var b=this;c.addPropertyChangeListener("NAVIGATION_PANEL_VISIBLE",function(e){b.setNavigationPanelVisible(e.getNewValue())})}this.createActions(a);this.installKeyboardActions()}this.updateView(this.home.getCamera(),this.home.getTopCamera()===this.home.getCamera());this.updateViewPlatformTransform(this.home.getCamera(),false);this.addCameraListeners();this.canvas3D.setScene(this.createSceneTree(true,false))};HomeComponent3D.prototype.disposeGeometries=function(){if(this.home.structure){ModelManager.getInstance().unloadModel(this.home.structure,true)}ModelManager.getInstance().disposeGeometries(this.canvas3D.getScene())};HomeComponent3D.prototype.createNavigationPanel=function(m,h,j){var a=this.getSimulatedKeyElements(document.getElementsByTagName("body")[0]);var k=null;var c;try{c=h.getLocalizedString(HomeComponent3D,"navigationPanel.innerHTML")}catch(l){c='<img src="'+ZIPTools.getScriptFolder("gl-matrix-min.js")+'/navigationPanel.png"     style="width: 56px; height:59px; margin:5px; user-drag: none; user-select: none; -moz-user-select: none; -webkit-user-drag: none; -webkit-user-select: none; -ms-user-select: none;"     usemap="#navigationPanelMap"/><map name="navigationPanelMap" id="navigationPanelMap">  <area shape="poly" coords="19,13,28,2,36,13,31,13,31,18,24,18,24,13" data-simulated-key="UP" />  <area shape="poly" coords="3,28,13,20,13,25,18,25,18,32,13,32,13,37" data-simulated-key="LEFT" />  <area shape="poly" coords="24,40,31,40,31,45,36,45,27,55,19,45,24,45" data-simulated-key="DOWN" />  <area shape="poly" coords="37,25,42,25,42,20,52,28,42,37,42,32,37,31" data-simulated-key="RIGHT" />  <area shape="poly" coords="20,28,28,19,35,28" data-simulated-key="PAGE_UP" />  <area shape="poly" coords="20,30,36,30,28,39" data-simulated-key="PAGE_DOWN" /></map>'}var n=this;if(c!==null){k=document.createElement("div");k.setAttribute("id","div"+Math.floor(Math.random()*10000000000));k.style.position="absolute";var b=this.canvas3D.getCanvas();this.windowSizeListener=function(){var i=b.getBoundingClientRect();k.style.left=(i.left+window.pageXOffset)+"px";k.style.top=(i.top+window.pageYOffset)+"px";n.canvas3D.updateViewportSize()};window.addEventListener("resize",this.windowSizeListener);this.windowSizeListener();var e=0;for(var g=this.canvas3D.getCanvas();g&&g.style&&isNaN(e=parseInt(g.style.zIndex));g=g.parentElement){}k.style.zIndex=isNaN(e)?"1":(e+1).toString();k.style.visibility="hidden";k.innerHTML=c;a.push.apply(a,this.getSimulatedKeyElements(k));var d=document.getElementsByTagName("body")[0];d.insertBefore(k,d.firstChild);k.addEventListener("mousedown",function(i){n.userActionsListener.mousePressed(i)})}this.simulatedElementMousePressedListener=function(p){var r=p.target;var i=function(){var s=r.getAttribute("data-simulated-key");n.callAction(s.substring(s.indexOf(":")+1),p)};var q=function(s){window.clearInterval(o);r.removeEventListener("mouseup",q);r.removeEventListener("mouseleave",q);n.userActionsListener.windowMouseReleased(s);s.stopPropagation()};r.addEventListener("mouseup",q);r.addEventListener("mouseleave",q);i();var o=window.setInterval(i,80)};for(var f=0;f<a.length;f++){a[f].addEventListener("mousedown",this.simulatedElementMousePressedListener)}if(k!==null){return k.getAttribute("id")}else{return null}};HomeComponent3D.prototype.getSimulatedKeyElements=function(c){var e=[];if(c.hasChildNodes()){for(var b=0;b<c.childNodes.length;b++){var d=c.childNodes[b];if(d.hasAttribute&&d.hasAttribute("data-simulated-key")){var a=d.getAttribute("data-simulated-key");if(a.indexOf(":")===-1||a.indexOf(this.canvas3D.getCanvas().getAttribute("id")+":")===0){e.push(d)}}e.push.apply(e,this.getSimulatedKeyElements(d))}}return e};HomeComponent3D.prototype.setNavigationPanelVisible=function(a){if(this.navigationPanelId!=null){document.getElementById(this.navigationPanelId).style.visibility=a?"visible":"hidden"}};HomeComponent3D.prototype.getClosestItemAt=function(a,c){var b=this.canvas3D.getClosestShapeAt(a,c);while(b!==null&&!(b instanceof Object3DBranch)){b=b.getParent()}if(b!=null){return b.getUserData()}else{return null}};HomeComponent3D.prototype.removeHomeListeners=function(){this.home.removePropertyChangeListener("CAMERA",this.homeCameraListener);this.home.getCamera().removePropertyChangeListener(this.cameraChangeListener);var a=this.home.getEnvironment();a.removePropertyChangeListener("SKY_COLOR",this.backgroundChangeListener);a.removePropertyChangeListener("SKY_TEXTURE",this.backgroundChangeListener);a.removePropertyChangeListener("GROUND_COLOR",this.backgroundChangeListener);a.removePropertyChangeListener("GROUND_TEXTURE",this.backgroundChangeListener);a.removePropertyChangeListener("LIGHT_COLOR",this.lightColorListener);this.home.removePropertyChangeListener("CAMERA",this.elevationChangeListener);this.home.getCamera().removePropertyChangeListener(this.elevationChangeListener);this.home.removeFurnitureListener(this.furnitureListener);var f=this.home.getFurniture();for(var d=0;d<f.length;d++){var e=f[d];e.removePropertyChangeListener(this.furnitureChangeListener);if(e instanceof HomeFurnitureGroup){var c=e.getAllFurniture();for(var b=0;b<c.length;b++){c[b].removePropertyChangeListener(this.furnitureChangeListener)}}}};HomeComponent3D.prototype.removeMouseListeners=function(a){if(this.userActionsListener){if(window.PointerEvent){a.getCanvas().removeEventListener("pointerdown",this.userActionsListener.pointerPressed);a.getCanvas().removeEventListener("mousedown",this.userActionsListener.pointerMousePressed);window.removeEventListener("pointermove",this.userActionsListener.windowPointerMoved);window.removeEventListener("pointerup",this.userActionsListener.windowPointerReleased)}else{a.getCanvas().removeEventListener("touchstart",this.userActionsListener.touchStarted);a.getCanvas().removeEventListener("touchmove",this.userActionsListener.touchMoved);a.getCanvas().removeEventListener("touchend",this.userActionsListener.touchEnded);a.getCanvas().removeEventListener("mousedown",this.userActionsListener.mousePressed);window.removeEventListener("mousemove",this.userActionsListener.windowMouseMoved);window.removeEventListener("mouseup",this.userActionsListener.windowMouseReleased)}a.getCanvas().removeEventListener("DOMMouseScroll",this.userActionsListener.mouseScrolled);a.getCanvas().removeEventListener("mousewheel",this.userActionsListener.mouseWheelMoved)}};HomeComponent3D.prototype.dispose=function(){this.removeHomeListeners();this.removeMouseListeners(this.canvas3D);if(this.navigationPanelId!=null){window.removeEventListener("resize",this.windowSizeListener);var c=this.getSimulatedKeyElements(document.getElementsByTagName("body")[0]);for(var b=0;b<c.length;b++){c[b].removeEventListener("mousedown",this.simulatedElementMousePressedListener)}var a=document.getElementById(this.navigationPanelId);a.parentElement.removeChild(a)}this.canvas3D.clear()};HomeComponent3D.prototype.addCameraListeners=function(){var a=this;var b=this.home;this.cameraChangeListener=function(c){setTimeout(function(){if(a.canvas3D){a.updateView(b.getCamera(),b.getTopCamera()===b.getCamera());a.updateViewPlatformTransform(b.getCamera(),true)}},0)};b.getCamera().addPropertyChangeListener(this.cameraChangeListener);this.homeCameraListener=function(c){a.updateView(b.getCamera(),b.getTopCamera()===b.getCamera());a.updateViewPlatformTransform(b.getCamera(),false);c.getOldValue().removePropertyChangeListener(a.cameraChangeListener);b.getCamera().addPropertyChangeListener(a.cameraChangeListener)};this.home.addPropertyChangeListener("CAMERA",this.homeCameraListener)};HomeComponent3D.prototype.updateView=function(h,i){var g=h.getFieldOfView();if(g===0){g=Math.PI*63/180}this.canvas3D.setFieldOfView(g);var k;var e;if(i){var a=this.getApproximateHomeBoundsCache();if(a===null){k=5}else{var f=vec3.create();a.getLower(f);var j=vec3.create();a.getUpper(j);k=1+Math.sqrt(Math.pow((f[0]+j[0])/2-h.getX(),2)+Math.pow((f[1]+j[1])/2-h.getY(),2)+Math.pow((f[2]+j[2])/2-h.getZ(),2))/100}e=k*3000}else{k=2.5;e=k*5000;var d=125;if(h.getZ()>d){var c=1/250;var a=this.getApproximateHomeBoundsCache();var b=0;if(a!==null){var j=vec3.create();a.getUpper(j);b=Math.min(j[2],10000)}if(h.getZ()<b+d){k+=(h.getZ()-d)*c;e+=(k-2.5)*25000}else{k+=b*c+(h.getZ()-b-d)/50;e+=+(b*c)*25000+(k-b*c-2.5)*5000}}}this.canvas3D.setFrontClipDistance(k);this.canvas3D.setBackClipDistance(e)};HomeComponent3D.prototype.getApproximateHomeBoundsCache=function(){if(this.approximateHomeBoundsCache===null){var f=null;var k=this.home.getFurniture();for(var h=0;h<k.length;h++){var n=k[h];if(n.isVisible()&&(n.getLevel()===null||n.getLevel().isViewable())){var d=vec3.fromValues(n.getX(),n.getY(),n.getGroundElevation());if(f===null){f=new BoundingBox3D(d,d)}else{f.combine(d)}}}var e=this.home.getWalls();for(var h=0;h<e.length;h++){var m=e[h];if(m.getLevel()===null||m.getLevel().isViewable()){var c=vec3.fromValues(m.getXStart(),m.getYStart(),m.getLevel()!==null?m.getLevel().getElevation():0);if(f===null){f=new BoundingBox3D(c,c)}else{f.combine(c)}f.combine(new Point3d(m.getXEnd(),m.getYEnd(),c[2]+(m.getHeight()!==null?m.getHeight():this.home.getWallHeight())))}}var g=this.home.getRooms();for(var h=0;h<g.length;h++){var b=g[h];if(b.getLevel()===null||b.getLevel().isViewable()){var a=vec3.fromValues(b.getXCenter(),b.getYCenter(),b.getLevel()!==null?b.getLevel().getElevation():0);if(f===null){f=new BoundingBox3D(a,a)}else{f.combine(a)}}}var j=this.home.getLabels();for(var h=0;h<j.length;h++){var l=j[h];if((l.getLevel()===null||l.getLevel().isViewable())&&l.getPitch()!==null){var a=vec3.fromValues(l.getX(),l.getY(),l.getGroundElevation());if(f===null){f=new BoundingBox3D(a,a)}else{f.combine(a)}}}this.approximateHomeBoundsCache=f}return this.approximateHomeBoundsCache};HomeComponent3D.prototype.updateViewPlatformTransform=function(b,a){if(a){this.moveCameraWithAnimation(b)}else{delete this.cameraInterpolator;var c=mat4.create();this.computeViewPlatformTransform(c,b.getX(),b.getY(),b.getZ(),b.getYaw(),b.getPitch());this.canvas3D.setViewPlatformTransform(c)}};HomeComponent3D.prototype.moveCameraWithAnimation=function(c){if(this.cameraInterpolator===undefined){this.cameraInterpolator={initialCamera:null,finalCamera:null,alpha:null}}if(this.cameraInterpolator.finalCamera===null||this.cameraInterpolator.finalCamera.getX()!==c.getX()||this.cameraInterpolator.finalCamera.getY()!==c.getY()||this.cameraInterpolator.finalCamera.getZ()!==c.getZ()||this.cameraInterpolator.finalCamera.getYaw()!==c.getYaw()||this.cameraInterpolator.finalCamera.getPitch()!==c.getPitch()){if(this.cameraInterpolator.alpha===null||this.cameraInterpolator.alpha===1){this.cameraInterpolator.initialCamera=new Camera(this.camera.getX(),this.camera.getY(),this.camera.getZ(),this.camera.getYaw(),this.camera.getPitch(),this.camera.getFieldOfView())}else{if(this.cameraInterpolator.alpha<0.3){var b=mat4.create();this.computeViewPlatformTransform(b,this.cameraInterpolator.finalCamera.getX(),this.cameraInterpolator.finalCamera.getY(),this.cameraInterpolator.finalCamera.getZ(),this.cameraInterpolator.finalCamera.getYaw(),this.cameraInterpolator.finalCamera.getPitch());this.canvas3D.setViewPlatformTransform(b);this.cameraInterpolator.initialCamera=this.cameraInterpolator.finalCamera}else{this.cameraInterpolator.initialCamera=new Camera(this.cameraInterpolator.initialCamera.getX()+(this.cameraInterpolator.finalCamera.getX()-this.cameraInterpolator.initialCamera.getX())*this.cameraInterpolator.alpha,this.cameraInterpolator.initialCamera.getY()+(this.cameraInterpolator.finalCamera.getY()-this.cameraInterpolator.initialCamera.getY())*this.cameraInterpolator.alpha,this.cameraInterpolator.initialCamera.getZ()+(this.cameraInterpolator.finalCamera.getZ()-this.cameraInterpolator.initialCamera.getZ())*this.cameraInterpolator.alpha,this.cameraInterpolator.initialCamera.getYaw()+(this.cameraInterpolator.finalCamera.getYaw()-this.cameraInterpolator.initialCamera.getYaw())*this.cameraInterpolator.alpha,this.cameraInterpolator.initialCamera.getPitch()+(this.cameraInterpolator.finalCamera.getPitch()-this.cameraInterpolator.initialCamera.getPitch())*this.cameraInterpolator.alpha,c.getFieldOfView())}}this.cameraInterpolator.finalCamera=new Camera(c.getX(),c.getY(),c.getZ(),c.getYaw(),c.getPitch(),c.getFieldOfView());if(this.cameraInterpolator.alpha===null){this.cameraInterpolator.animationDuration=75}this.cameraInterpolator.startTime=Date.now();this.cameraInterpolator.alpha=0;var a=this;requestAnimationFrame(function(){a.interpolateUntilAlphaEquals1()})}};HomeComponent3D.prototype.interpolateUntilAlphaEquals1=function(){if(this.cameraInterpolator){var c=Date.now();var d=Math.min(1,(c-this.cameraInterpolator.startTime)/this.cameraInterpolator.animationDuration);if(this.cameraInterpolator.alpha!==d){var b=mat4.create();this.computeTransform(d,b);this.canvas3D.setViewPlatformTransform(b);this.cameraInterpolator.alpha=d}if(this.cameraInterpolator.alpha<1){var a=this;requestAnimationFrame(function(){a.interpolateUntilAlphaEquals1()})}}};HomeComponent3D.prototype.computeTransform=function(b,a){this.computeViewPlatformTransform(a,this.cameraInterpolator.initialCamera.getX()+(this.cameraInterpolator.finalCamera.getX()-this.cameraInterpolator.initialCamera.getX())*b,this.cameraInterpolator.initialCamera.getY()+(this.cameraInterpolator.finalCamera.getY()-this.cameraInterpolator.initialCamera.getY())*b,this.cameraInterpolator.initialCamera.getZ()+(this.cameraInterpolator.finalCamera.getZ()-this.cameraInterpolator.initialCamera.getZ())*b,this.cameraInterpolator.initialCamera.getYaw()+(this.cameraInterpolator.finalCamera.getYaw()-this.cameraInterpolator.initialCamera.getYaw())*b,this.cameraInterpolator.initialCamera.getPitch()+(this.cameraInterpolator.finalCamera.getPitch()-this.cameraInterpolator.initialCamera.getPitch())*b)};HomeComponent3D.prototype.computeViewPlatformTransform=function(a,g,f,d,c,e){var h=mat4.create();mat4.rotateY(h,h,-c+Math.PI);var b=mat4.create();mat4.rotateX(b,b,-e);mat4.mul(h,h,b);mat4.identity(a);mat4.translate(a,a,vec3.fromValues(g,d,f));mat4.mul(a,a,h);this.camera=new Camera(g,f,d,c,e,0)};HomeComponent3D.prototype.addMouseListeners=function(a,d){var b=this;var c={xLastMove:-1,yLastMove:-1,buttonPressed:-1,pointerTouches:{},distanceLastPinch:-1,mousePressed:function(e){c.xLastMove=e.clientX;c.yLastMove=e.clientY;c.buttonPressed=e.button;c.mousePressedInCanvas=true;e.stopPropagation()},windowMouseMoved:function(e){if(c.mousePressedInCanvas){c.moved(e.clientX,e.clientY,e.altKey,e.shiftKey)}},windowMouseReleased:function(e){c.buttonPressed=-1;if(c.mousePressedInCanvas){delete c.mousePressedInCanvas}},pointerPressed:function(e){if(e.pointerType=="mouse"){c.mousePressed(e)}else{c.copyPointerToTargetTouches(e);c.touchStarted(e)}},pointerMousePressed:function(e){e.stopPropagation()},windowPointerMoved:function(e){if(e.pointerType=="mouse"){c.windowMouseMoved(e)}else{c.copyPointerToTargetTouches(e);c.touchMoved(e)}},windowPointerReleased:function(e){if(e.pointerType=="mouse"){c.windowMouseReleased(e)}else{delete c.pointerTouches[e.pointerId];c.touchEnded(e)}},touchStarted:function(e){e.preventDefault();if(e.targetTouches.length==1){c.xLastMove=e.targetTouches[0].pageX;c.yLastMove=e.targetTouches[0].pageY;if(b.home.getCamera()===b.home.getObserverCamera()){c.xLastMove=-c.xLastMove;c.yLastMove=-c.yLastMove}c.buttonPressed=0}else{if(e.targetTouches.length==2){c.distanceLastPinch=c.distance(e.targetTouches[0],e.targetTouches[1])}}},touchMoved:function(g){g.preventDefault();if(g.targetTouches.length==1){if(b.home.getCamera()===b.home.getObserverCamera()){c.moved(-g.targetTouches[0].pageX,-g.targetTouches[0].pageY,false,false)}else{c.moved(g.targetTouches[0].pageX,g.targetTouches[0].pageY,false,false)}}else{if(g.targetTouches.length==2){var f=c.distance(g.targetTouches[0],g.targetTouches[1]);var e=f/c.distanceLastPinch;c.zoomed((1-e)*50,false);c.distanceLastPinch=f}}},touchEnded:function(e){c.buttonPressed=-1},copyPointerToTargetTouches:function(f){c.pointerTouches[f.pointerId]={pageX:f.clientX,pageY:f.clientY};f.targetTouches=[];for(var e in c.pointerTouches){if(c.pointerTouches.hasOwnProperty(e)){f.targetTouches.push(c.pointerTouches[e])}}},distance:function(f,e){return Math.sqrt(Math.pow(e.pageX-f.pageX,2)+Math.pow(e.pageY-f.pageY,2))},moved:function(e,l,i,g){if(c.buttonPressed===0){if(i){var k=1.25*(c.yLastMove-l);if(g){k*=5}a.moveCamera(k)}else{var j=0.005;var h=j*(e-c.xLastMove);if(g){h*=5}a.rotateCameraYaw(h);var f=j*(l-c.yLastMove);a.rotateCameraPitch(f)}c.xLastMove=e;c.yLastMove=l}},mouseScrolled:function(e){c.zoomed(e.detail,e.shiftKey)},mouseWheelMoved:function(e){e.preventDefault();c.zoomed((e.deltaY!==undefined?e.deltaY:-e.wheelDelta)/4,e.shiftKey)},zoomed:function(f,e){var f=-2.5*f;if(e){f*=5}a.moveCamera(f)}};if(window.PointerEvent){d.getCanvas().addEventListener("pointerdown",c.pointerPressed);d.getCanvas().addEventListener("mousedown",c.pointerMousePressed);window.addEventListener("pointermove",c.windowPointerMoved);window.addEventListener("pointerup",c.windowPointerReleased)}else{d.getCanvas().addEventListener("touchstart",c.touchStarted);d.getCanvas().addEventListener("touchmove",c.touchMoved);d.getCanvas().addEventListener("touchend",c.touchEnded);d.getCanvas().addEventListener("mousedown",c.mousePressed);window.addEventListener("mousemove",c.windowMouseMoved);window.addEventListener("mouseup",c.windowMouseReleased)}d.getCanvas().addEventListener("DOMMouseScroll",c.mouseScrolled);d.getCanvas().addEventListener("mousewheel",c.mouseWheelMoved);this.userActionsListener=c};HomeComponent3D.prototype.installKeyboardActions=function(){this.inputMap={"shift pressed UP":"MOVE_CAMERA_FAST_FORWARD","alt shift pressed UP":"MOVE_CAMERA_FAST_FORWARD","shift pressed W":"MOVE_CAMERA_FAST_FORWARD","pressed UP":"MOVE_CAMERA_FORWARD","alt pressed UP":"MOVE_CAMERA_FORWARD","pressed W":"MOVE_CAMERA_FORWARD","shift pressed DOWN":"MOVE_CAMERA_FAST_BACKWARD","alt shift pressed DOWN":"MOVE_CAMERA_FAST_BACKWARD","shift pressed S":"MOVE_CAMERA_FAST_BACKWARD","pressed DOWN":"MOVE_CAMERA_BACKWARD","alt pressed DOWN":"MOVE_CAMERA_BACKWARD","pressed S":"MOVE_CAMERA_BACKWARD","alt shift pressed LEFT":"MOVE_CAMERA_FAST_LEFT","alt pressed LEFT":"MOVE_CAMERA_LEFT","alt shift pressed RIGHT":"MOVE_CAMERA_FAST_RIGHT","alt pressed RIGHT":"MOVE_CAMERA_RIGHT","shift pressed LEFT":"ROTATE_CAMERA_YAW_FAST_LEFT","shift pressed A":"ROTATE_CAMERA_YAW_FAST_LEFT","pressed LEFT":"ROTATE_CAMERA_YAW_LEFT","pressed A":"ROTATE_CAMERA_YAW_LEFT","shift pressed RIGHT":"ROTATE_CAMERA_YAW_FAST_RIGHT","shift pressed D":"ROTATE_CAMERA_YAW_FAST_RIGHT","pressed RIGHT":"ROTATE_CAMERA_YAW_RIGHT","pressed D":"ROTATE_CAMERA_YAW_RIGHT","shift pressed PAGE_UP":"ROTATE_CAMERA_PITCH_FAST_UP","pressed PAGE_UP":"ROTATE_CAMERA_PITCH_UP","shift pressed PAGE_DOWN":"ROTATE_CAMERA_PITCH_FAST_DOWN","pressed PAGE_DOWN":"ROTATE_CAMERA_PITCH_DOWN","shift pressed HOME":"ELEVATE_CAMERA_FAST_UP","pressed HOME":"ELEVATE_CAMERA_UP","shift pressed END":"ELEVATE_CAMERA_FAST_DOWN","pressed END":"ELEVATE_CAMERA_DOWN"};var a=this;this.canvas3D.getCanvas().addEventListener("keydown",function(b){if(HomeComponent3D.KEY_CODE_TEXTS===undefined){HomeComponent3D.KEY_CODE_TEXTS=new Array(223);HomeComponent3D.KEY_CODE_TEXTS[8]="BACK_SPACE";HomeComponent3D.KEY_CODE_TEXTS[9]="TAB";HomeComponent3D.KEY_CODE_TEXTS[13]="ENTER";HomeComponent3D.KEY_CODE_TEXTS[16]="SHIFT";HomeComponent3D.KEY_CODE_TEXTS[17]="CONTROL";HomeComponent3D.KEY_CODE_TEXTS[18]="ALT";HomeComponent3D.KEY_CODE_TEXTS[19]="PAUSE";HomeComponent3D.KEY_CODE_TEXTS[20]="CAPS_LOCK";HomeComponent3D.KEY_CODE_TEXTS[27]="ESCAPE";HomeComponent3D.KEY_CODE_TEXTS[33]="PAGE_UP";HomeComponent3D.KEY_CODE_TEXTS[34]="PAGE_DOWN";HomeComponent3D.KEY_CODE_TEXTS[35]="END";HomeComponent3D.KEY_CODE_TEXTS[36]="HOME";HomeComponent3D.KEY_CODE_TEXTS[37]="LEFT";HomeComponent3D.KEY_CODE_TEXTS[38]="UP";HomeComponent3D.KEY_CODE_TEXTS[39]="RIGHT";HomeComponent3D.KEY_CODE_TEXTS[40]="DOWN";HomeComponent3D.KEY_CODE_TEXTS[45]="INSERT";HomeComponent3D.KEY_CODE_TEXTS[46]="DELETE";HomeComponent3D.KEY_CODE_TEXTS[48]="0";HomeComponent3D.KEY_CODE_TEXTS[49]="1";HomeComponent3D.KEY_CODE_TEXTS[50]="2";HomeComponent3D.KEY_CODE_TEXTS[51]="3";HomeComponent3D.KEY_CODE_TEXTS[52]="4";HomeComponent3D.KEY_CODE_TEXTS[53]="5";HomeComponent3D.KEY_CODE_TEXTS[54]="6";HomeComponent3D.KEY_CODE_TEXTS[55]="7";HomeComponent3D.KEY_CODE_TEXTS[56]="8";HomeComponent3D.KEY_CODE_TEXTS[57]="9";HomeComponent3D.KEY_CODE_TEXTS[65]="A";HomeComponent3D.KEY_CODE_TEXTS[66]="B";HomeComponent3D.KEY_CODE_TEXTS[67]="C";HomeComponent3D.KEY_CODE_TEXTS[68]="D";HomeComponent3D.KEY_CODE_TEXTS[69]="E";HomeComponent3D.KEY_CODE_TEXTS[70]="F";HomeComponent3D.KEY_CODE_TEXTS[71]="G";HomeComponent3D.KEY_CODE_TEXTS[72]="H";HomeComponent3D.KEY_CODE_TEXTS[73]="I";HomeComponent3D.KEY_CODE_TEXTS[74]="J";HomeComponent3D.KEY_CODE_TEXTS[75]="K";HomeComponent3D.KEY_CODE_TEXTS[76]="L";HomeComponent3D.KEY_CODE_TEXTS[77]="M";HomeComponent3D.KEY_CODE_TEXTS[78]="N";HomeComponent3D.KEY_CODE_TEXTS[79]="O";HomeComponent3D.KEY_CODE_TEXTS[80]="P";HomeComponent3D.KEY_CODE_TEXTS[81]="Q";HomeComponent3D.KEY_CODE_TEXTS[82]="R";HomeComponent3D.KEY_CODE_TEXTS[83]="S";HomeComponent3D.KEY_CODE_TEXTS[84]="T";HomeComponent3D.KEY_CODE_TEXTS[85]="U";HomeComponent3D.KEY_CODE_TEXTS[86]="V";HomeComponent3D.KEY_CODE_TEXTS[87]="W";HomeComponent3D.KEY_CODE_TEXTS[88]="X";HomeComponent3D.KEY_CODE_TEXTS[89]="Y";HomeComponent3D.KEY_CODE_TEXTS[90]="Z";HomeComponent3D.KEY_CODE_TEXTS[91]="META";HomeComponent3D.KEY_CODE_TEXTS[92]="META";HomeComponent3D.KEY_CODE_TEXTS[96]="NUMPAD0";HomeComponent3D.KEY_CODE_TEXTS[97]="NUMPAD1";HomeComponent3D.KEY_CODE_TEXTS[98]="NUMPAD2";HomeComponent3D.KEY_CODE_TEXTS[99]="NUMPAD3";HomeComponent3D.KEY_CODE_TEXTS[100]="NUMPAD4";HomeComponent3D.KEY_CODE_TEXTS[101]="NUMPAD5";HomeComponent3D.KEY_CODE_TEXTS[102]="NUMPAD6";HomeComponent3D.KEY_CODE_TEXTS[103]="NUMPAD7";HomeComponent3D.KEY_CODE_TEXTS[104]="NUMPAD8";HomeComponent3D.KEY_CODE_TEXTS[105]="NUMPAD9";HomeComponent3D.KEY_CODE_TEXTS[106]="MULTIPLY";HomeComponent3D.KEY_CODE_TEXTS[107]="ADD";HomeComponent3D.KEY_CODE_TEXTS[109]="VK_SUBTRACT";HomeComponent3D.KEY_CODE_TEXTS[110]="VK_DECIMAL";HomeComponent3D.KEY_CODE_TEXTS[111]="VK_DIVIDE";HomeComponent3D.KEY_CODE_TEXTS[112]="F1";HomeComponent3D.KEY_CODE_TEXTS[113]="F2";HomeComponent3D.KEY_CODE_TEXTS[114]="F3";HomeComponent3D.KEY_CODE_TEXTS[115]="F4";HomeComponent3D.KEY_CODE_TEXTS[116]="F5";HomeComponent3D.KEY_CODE_TEXTS[117]="F6";HomeComponent3D.KEY_CODE_TEXTS[118]="F7";HomeComponent3D.KEY_CODE_TEXTS[119]="F8";HomeComponent3D.KEY_CODE_TEXTS[120]="F9";HomeComponent3D.KEY_CODE_TEXTS[121]="F10";HomeComponent3D.KEY_CODE_TEXTS[122]="F11";HomeComponent3D.KEY_CODE_TEXTS[123]="F12";HomeComponent3D.KEY_CODE_TEXTS[144]="VK_NUM_LOCK";HomeComponent3D.KEY_CODE_TEXTS[145]="VK_SCROLL_LOCK";HomeComponent3D.KEY_CODE_TEXTS[186]="VK_SEMICOLON";HomeComponent3D.KEY_CODE_TEXTS[187]="VK_EQUALS";HomeComponent3D.KEY_CODE_TEXTS[188]="VK_COMMA";HomeComponent3D.KEY_CODE_TEXTS[190]="VK_PERIOD";HomeComponent3D.KEY_CODE_TEXTS[191]="VK_SLASH";HomeComponent3D.KEY_CODE_TEXTS[219]="VK_OPEN_BRACKET";HomeComponent3D.KEY_CODE_TEXTS[220]="VK_BACK_SLASH";HomeComponent3D.KEY_CODE_TEXTS[221]="VK_CLOSE_BRACKET";HomeComponent3D.KEY_CODE_TEXTS[222]="VK_QUOTE"}a.callAction(HomeComponent3D.KEY_CODE_TEXTS[b.keyCode],b)},false)};HomeComponent3D.prototype.callAction=function(a,b){if(a){var e="";if(b.ctrlKey||a.indexOf("control ")!=-1){e+="control "}if(b.altKey||a.indexOf("alt ")!=-1){e+="alt "}if(b.metaKey||a.indexOf("meta ")!=-1){e+="meta "}if(b.shiftKey||a.indexOf("shift ")!=-1){e+="shift "}e+="pressed "+a.substring(a.lastIndexOf(" ")+1);var d=this.inputMap[e];if(d!==undefined){var c=this.actionMap[d];if(c!==undefined){c.actionPerformed(b)}b.stopPropagation()}}};HomeComponent3D.prototype.createActions=function(a){function f(g){this.delta=g}f.prototype.actionPerformed=function(g){a.moveCamera(this.delta)};function b(g){this.delta=g}b.prototype.actionPerformed=function(g){a.moveCameraSideways(this.delta)};function e(g){this.delta=g}e.prototype.actionPerformed=function(g){a.elevateCamera(this.delta)};function d(g){this.delta=g}d.prototype.actionPerformed=function(g){a.rotateCameraYaw(this.delta)};function c(g){this.delta=g}c.prototype.actionPerformed=function(g){a.rotateCameraPitch(this.delta)};this.actionMap={MOVE_CAMERA_FORWARD:new f(6.5),MOVE_CAMERA_FAST_FORWARD:new f(32.5),MOVE_CAMERA_BACKWARD:new f(-6.5),MOVE_CAMERA_FAST_BACKWARD:new f(-32.5),MOVE_CAMERA_LEFT:new b(-2.5),MOVE_CAMERA_FAST_LEFT:new b(-10),MOVE_CAMERA_RIGHT:new b(2.5),MOVE_CAMERA_FAST_RIGHT:new b(10),ELEVATE_CAMERA_DOWN:new e(-2.5),ELEVATE_CAMERA_FAST_DOWN:new e(-10),ELEVATE_CAMERA_UP:new e(2.5),ELEVATE_CAMERA_FAST_UP:new e(10),ROTATE_CAMERA_YAW_LEFT:new d(-Math.PI/60),ROTATE_CAMERA_YAW_FAST_LEFT:new d(-Math.PI/12),ROTATE_CAMERA_YAW_RIGHT:new d(Math.PI/60),ROTATE_CAMERA_YAW_FAST_RIGHT:new d(Math.PI/12),ROTATE_CAMERA_PITCH_UP:new c(-Math.PI/120),ROTATE_CAMERA_PITCH_FAST_UP:new c(-Math.PI/24),ROTATE_CAMERA_PITCH_DOWN:new c(Math.PI/120),ROTATE_CAMERA_PITCH_FAST_DOWN:new c(Math.PI/24)}};HomeComponent3D.prototype.getActionMap=function(){return this.actionMap};HomeComponent3D.prototype.getInputMap=function(){return this.inputMap};HomeComponent3D.prototype.createSceneTree=function(b,d){var a=new Group3D();var e=this.createGroundNode(-5000000,-5000000,10000000,10000000,b,d);a.addChild(e);a.addChild(this.createBackgroundNode(b,d));a.addChild(this.createHomeTree(b,d));this.defaultLights=this.createLights(b);for(var c=0;c<this.defaultLights.length;c++){a.addChild(this.defaultLights[c])}return a};HomeComponent3D.prototype.createBackgroundNode=function(d,e){var j=new Appearance3D();var f=this.createHalfSphereGeometry(true);var a=new Shape3D(f,j);var c=new BranchGroup3D();c.addChild(a);c.addChild(new Shape3D(this.createHalfSphereGeometry(false)));var h=new Appearance3D();var g=new Shape3D(new IndexedTriangleArray3D([vec3.fromValues(-1,-0.01,-1),vec3.fromValues(-1,-0.01,1),vec3.fromValues(1,-0.01,1),vec3.fromValues(1,-0.01,-1)],[0,1,2,0,2,3],[],[],[vec3.fromValues(0,1,0)],[0,0,0,0,0,0]),h);c.addChild(g);var b=new Background3D(c);this.updateBackgroundColorAndTexture(j,h,this.home,e);h.setVisible(this.home.getCamera().getZ()>=0);if(d){var i=this;this.backgroundChangeListener=function(k){i.updateBackgroundColorAndTexture(j,h,i.home,e)};i.home.getEnvironment().addPropertyChangeListener("SKY_COLOR",this.backgroundChangeListener);i.home.getEnvironment().addPropertyChangeListener("SKY_TEXTURE",this.backgroundChangeListener);i.home.getEnvironment().addPropertyChangeListener("GROUND_COLOR",this.backgroundChangeListener);i.home.getEnvironment().addPropertyChangeListener("GROUND_TEXTURE",this.backgroundChangeListener);this.elevationChangeListener=function(k){if(k.getSource()===i.home){k.getOldValue().removePropertyChangeListener(i.elevationChangeListener);i.home.getCamera().addPropertyChangeListener(i.elevationChangeListener);h.setVisible(i.home.getCamera().getZ()>=0)}else{if(k.getPropertyName()==="Z"){h.setVisible(i.home.getCamera().getZ()>=0)}}};this.home.getCamera().addPropertyChangeListener(this.elevationChangeListener);this.home.addPropertyChangeListener("CAMERA",this.elevationChangeListener)}return b};HomeComponent3D.prototype.createHalfSphereGeometry=function(l){var w=48;var q=[];var e=[];var r=[];for(var s=0,n=0;s<w;s++){var b=s*2*Math.PI/w;var g=Math.cos(b);var m=Math.sin(b);var d=(s+1)*2*Math.PI/w;var c=Math.cos(d);var u=Math.sin(d);for(var o=0;o<w/4;o++,n+=4){var v=2*o*Math.PI/w;var t=Math.cos(v);var x=Math.sin(v);var h=o!==0?(l?x:-x):-0.01;var f=2*(o+1)*Math.PI/w;if(!l){f=-f}var a=Math.cos(f);var p=Math.sin(f);q.push(vec3.fromValues(g*t,h,m*t));q.push(vec3.fromValues(c*t,h,u*t));q.push(vec3.fromValues(c*a,p,u*a));q.push(vec3.fromValues(g*a,p,m*a));if(l){e.push(n);e.push(n+1);e.push(n+2);e.push(n);e.push(n+2);e.push(n+3);r.push(vec2.fromValues(s/w,x));r.push(vec2.fromValues((s+1)/w,x));r.push(vec2.fromValues((s+1)/w,p));r.push(vec2.fromValues(s/w,p))}else{e.push(n);e.push(n+2);e.push(n+1);e.push(n);e.push(n+3);e.push(n+2)}}}return new IndexedTriangleArray3D(q,e,r,e,[],[])};HomeComponent3D.prototype.updateBackgroundColorAndTexture=function(h,f,e,d){var g=e.getEnvironment().getSkyColor();h.setDiffuseColor(vec3.fromValues(((g>>>16)&255)/255,((g>>>8)&255)/255,(g&255)/255));var i=e.getEnvironment().getSkyTexture();if(i!==null){TextureManager.getInstance().loadTexture(i.getImage(),0,d,{textureUpdated:function(j){h.setTextureImage(j)},textureError:function(j){return this.textureUpdated(TextureManager.getInstance().getErrorImage())},progression:function(k,l,j){}})}else{h.setTextureImage(null)}var b=e.getEnvironment().getGroundColor();var c=vec3.fromValues(((b>>>16)&255)/255,((b>>>8)&255)/255,(b&255)/255);f.setDiffuseColor(c);f.setAmbientColor(c);var a=e.getEnvironment().getGroundTexture();if(a!==null){TextureManager.getInstance().loadTexture(a.getImage(),0,d,{textureUpdated:function(j){f.setTextureImage(j);f.setTextureCoordinatesGeneration({planeS:vec4.fromValues(100000,0,0,0),planeT:vec4.fromValues(0,0,100000,0)})},textureError:function(j){return this.textureUpdated(TextureManager.getInstance().getErrorImage())},progression:function(k,l,j){}})}else{f.setTextureImage(null)}};HomeComponent3D.prototype.createGroundNode=function(g,f,b,c,d,e){if(this.home.structure){var j=new BranchGroup3D();j.setCapability(Group3D.ALLOW_CHILDREN_EXTEND);ModelManager.getInstance().loadModel(this.home.structure,e,{modelUpdated:function(k){j.addChild(k)},modelError:function(k){var l=new Appearance3D();l.setDiffuseColor(vec3.fromValues(1,0,0));j.addChild(new Box3D(10000000,0,10000000,l))},progression:function(){}});return j}else{var i=new Ground3D(this.home,g,f,b,c,e);var a=mat4.create();a.translate(vec3.fromValues(0,-0.2,0));var h=new TransformGroup(a);h.addChild(i);return h}};HomeComponent3D.prototype.createLights=function(b){var c=[new DirectionalLight3D(vec3.fromValues(0.9,0.9,0.9),vec3.fromValues(1.5,-0.8,-1)),new DirectionalLight3D(vec3.fromValues(0.9,0.9,0.9),vec3.fromValues(-1.5,-0.8,-1)),new DirectionalLight3D(vec3.fromValues(0.9,0.9,0.9),vec3.fromValues(0,-0.8,1)),new DirectionalLight3D(vec3.fromValues(0.7,0.7,0.7),vec3.fromValues(0,1,0)),new AmbientLight3D(vec3.fromValues(0.2,0.2,0.2))];for(var d=0;d<c.length-1;d++){c[d].defaultColor=c[d].getColor();this.updateLightColor(c[d])}if(b){var a=this;this.lightColorListener=function(f){for(var e=0;e<c.length-1;e++){a.updateLightColor(c[e])}};this.home.getEnvironment().addPropertyChangeListener("LIGHT_COLOR",this.lightColorListener)}return c};HomeComponent3D.prototype.updateLightColor=function(b){var c=b.defaultColor;var a=this.home.getEnvironment().getLightColor();b.setColor(vec3.fromValues(((a>>>16)&255)/255*c[0],((a>>>8)&255)/255*c[1],(a&255)/255*c[2]))};HomeComponent3D.prototype.createHomeTree=function(g,h){var a=new BranchGroup3D();a.setCapability(Group3D.ALLOW_CHILDREN_EXTEND);var k=this.home.getLabels();for(var f=0;f<k.length;f++){this.addObject(a,k[f],g,h)}var d=this.home.getRooms();for(var f=0;f<d.length;f++){this.addObject(a,d[f],g,h)}var b=this.home.getWalls();for(var f=0;f<b.length;f++){this.addObject(a,b[f],g,h)}var l=this.home.getFurniture();for(var f=0;f<l.length;f++){var n=l[f];if(n instanceof HomeFurnitureGroup){var c=n.getAllFurniture();for(var e=0;e<c.length;e++){var m=c[e];if(!(m instanceof HomeFurnitureGroup)){this.addObject(a,m,g,h)}}}else{this.addObject(a,n,g,h)}}if(g){this.addFurnitureListener(a)}return a};HomeComponent3D.prototype.addFurnitureListener=function(g){var a=this;this.furnitureChangeListener=function(j){var h=j.getSource();var i=j.getPropertyName();if("X"==i||"Y"==i||"ANGLE"==i||"WIDTH"==i||"DEPTH"==i){a.updateObjects([h])}else{if("HEIGHT"==i||"ELEVATION"==i||"MODEL_MIRRORED"==i||"VISIBLE"==i||"LEVEL"==i){a.updateObjects([h])}else{if("COLOR"==i||"TEXTURE"==i||"MODEL_MATERIALS"==i||"SHININESS"==i||("POWER"==i&&home.getEnvironment().getSubpartSizeUnderLight()>0)){a.updateObjects([h])}}}};var f=this.home.getFurniture();for(var d=0;d<f.length;d++){var e=f[d];if(e instanceof HomeFurnitureGroup){var c=e.getAllFurniture();for(var b=0;b<c.length;b++){c[b].addPropertyChangeListener(this.furnitureChangeListener)}}else{e.addPropertyChangeListener(this.furnitureChangeListener)}}this.furnitureListener=function(m){var l=m.getItem();switch(m.getType()){case CollectionEvent.Type.ADD:if(l instanceof HomeFurnitureGroup){var k=l.getAllFurniture();for(var i=0;i<k.length;i++){var h=k[i];if(!(h instanceof HomeFurnitureGroup)){a.addObject(g,h,true,false);h.addPropertyChangeListener(a.furnitureChangeListener)}}}else{a.addObject(g,l,true,false);l.addPropertyChangeListener(a.furnitureChangeListener)}break;case CollectionEvent.Type.DELETE:if(l instanceof HomeFurnitureGroup){var k=l.getAllFurniture();for(var i=0;i<k.length;i++){var h=k[i];if(!(h instanceof HomeFurnitureGroup)){a.deleteObject(h);h.removePropertyChangeListener(a.furnitureChangeListener)}}}else{a.deleteObject(l);l.removePropertyChangeListener(a.furnitureChangeListener)}break}};this.home.addFurnitureListener(this.furnitureListener)};HomeComponent3D.prototype.addObject=function(e,b,c,a,d){if(d===undefined){d=a;a=c;c=-1}var f=this.object3dFactory.createObject3D(this.home,b,d);if(a){b.object3D=f}if(c===-1){e.addChild(f)}else{e.insertChild(f,c)}return f};HomeComponent3D.prototype.deleteObject=function(a){if(a.object3D){a.object3D.detach();delete a.object3D}};HomeComponent3D.prototype.updateObjects=function(c){if(this.homeObjectsToUpdate){for(var b=0;b<c.length;b++){var a=c[b];if(this.homeObjectsToUpdate.indexOf(a)<=-1){this.homeObjectsToUpdate.push(a)}}}else{this.homeObjectsToUpdate=c.slice(0);setTimeout(function(e){for(var f=0;f<e.homeObjectsToUpdate.length;f++){var d=e.homeObjectsToUpdate[f];if(d.object3D){d.object3D.update()}}delete e.homeObjectsToUpdate},0,this)}this.approximateHomeBoundsCache=null};function Object3DBranchFactory(){}Object3DBranchFactory.prototype.createObject3D=function(c,a,b){if(a instanceof HomePieceOfFurniture){return new HomePieceOfFurniture3D(a,c,b)}else{return null}};function HomePieceOfFurniture3D(a,c,b){Object3DBranch.call(this);this.setUserData(a);this.home=c;this.createPieceOfFurnitureNode(a,b)}HomePieceOfFurniture3D.prototype=Object.create(Object3DBranch.prototype);HomePieceOfFurniture3D.prototype.constructor=HomePieceOfFurniture3D;HomePieceOfFurniture3D.prototype.createPieceOfFurnitureNode=function(d,e){var a=new TransformGroup3D();a.setCapability(Group3D.ALLOW_CHILDREN_EXTEND);a.setCapability(TransformGroup3D.ALLOW_TRANSFORM_WRITE);this.addChild(a);var c=new BranchGroup3D();c.addChild(this.getModelBox(vec3.fromValues(1,1,1)));a.addChild(c);this.updatePieceOfFurnitureTransform();var b=d.getModel();var f=this;ModelManager.getInstance().loadModel(b,e,{modelUpdated:function(i){var h=d.getModelRotation();var g=ModelManager.getInstance().getNormalizedTransformGroup(i,h,1);f.updatePieceOfFurnitureModelNode(i,g,e)},modelError:function(g){f.updatePieceOfFurnitureModelNode(f.getModelBox(vec3.fromValues(1,0,0)),new TransformGroup3D(),e)},progression:function(){}})};HomePieceOfFurniture3D.prototype.update=function(){this.updatePieceOfFurnitureTransform();this.updatePieceOfFurnitureModelMirrored();this.updatePieceOfFurnitureColorAndTexture(false);this.updatePieceOfFurnitureVisibility()};HomePieceOfFurniture3D.prototype.updatePieceOfFurnitureTransform=function(){var a=ModelManager.getInstance().getPieceOFFurnitureNormalizedModelTransformation(this.getUserData());this.getChild(0).setTransform(a)};HomePieceOfFurniture3D.prototype.updatePieceOfFurnitureColorAndTexture=function(c){var b=this.getUserData();var a=this.getModelNode();if(b.getColor()!==null){this.setColorAndTexture(a,b.getColor(),null,b.getShininess(),null,false,null,null,[])}else{if(b.getTexture()!==null){this.setColorAndTexture(a,null,b.getTexture(),b.getShininess(),null,c,vec3.fromValues(b.getWidth(),b.getHeight(),b.getDepth()),ModelManager.getInstance().getBounds(a.getChild(0)),[])}else{if(b.getModelMaterials()!==null){this.setColorAndTexture(a,null,null,null,b.getModelMaterials(),c,vec3.fromValues(b.getWidth(),b.getHeight(),b.getDepth()),ModelManager.getInstance().getBounds(a.getChild(0)),[])}else{this.setColorAndTexture(a,null,null,b.getShininess(),null,false,null,null,[])}}}};HomePieceOfFurniture3D.prototype.getModelNode=function(){var a=this.getChild(0);var b=a.getChild(0);return b.getChild(0)};HomePieceOfFurniture3D.prototype.updatePieceOfFurnitureVisibility=function(){var b=this.getUserData();var c=b.isVisible()&&(b.getLevel()===null||b.getLevel().isViewableAndVisible());var a=b.getColor()===null&&b.getTexture()===null?b.getModelMaterials():null;this.setVisible(this.getModelNode(),c,a)};HomePieceOfFurniture3D.prototype.updatePieceOfFurnitureModelMirrored=function(){var a=this.getUserData();this.setCullFace(this.getModelNode(),a.isModelMirrored(),a.isBackFaceShown())};HomePieceOfFurniture3D.prototype.updatePieceOfFurnitureModelNode=function(b,a,e){a.addChild(b);var c=new BranchGroup3D();c.addChild(a);var d=this.getChild(0);d.removeAllChildren();d.addChild(c);if(this.getUserData().isBackFaceShown()){this.setBackFaceNormalFlip(this.getModelNode(),true)}this.updatePieceOfFurnitureModelMirrored();this.updatePieceOfFurnitureColorAndTexture(e);this.updatePieceOfFurnitureVisibility();if(this.getUserData().isDoorOrWindow()){this.setTransparentShapeNotPickable(this)}};HomePieceOfFurniture3D.prototype.getModelBox=function(a){var b=new Appearance3D();b.setDiffuseColor(a);b.setAmbientColor(vec3.scale(vec3.create(),a,0.7));return new Box3D(0.5,0.5,0.5,b)};HomePieceOfFurniture3D.prototype.setColorAndTexture=function(s,u,o,t,c,l,z,d,y){if(s instanceof Group3D){var e=s.getChildren();for(var w=0;w<e.length;w++){this.setColorAndTexture(e[w],u,o,t,c,l,z,d,y)}}else{if(s instanceof Shape3D){var b=s;var v=b.getName();var n=b.getAppearance();if(n===null){n=new Appearance3D();s.setAppearance(n)}if(y.indexOf(n)===-1){var a=null;var x=u!==null;var q=!x&&o!==null;var g=!x&&!q&&c!==null&&c.length>0;var k=x||q||g||t!==null;var r=v!==null&&v.indexOf(ModelManager.WINDOW_PANE_SHAPE_PREFIX)===0;if(!r&&k||r&&g){if(n.defaultAppearance===undefined){n.defaultAppearance=n.clone()}a=n.defaultAppearance}var f=0;if(k){f=t!==null?t:(n.getSpecularColor()!==undefined&&n.getShininess()!==undefined?n.getShininess()/128:0)}if(x){if(r){this.restoreDefaultAppearance(n,null)}else{this.updateAppearanceMaterial(n,u,u,f);if(a.getTransparency()!==undefined){n.setTransparency(a.getTransparency())}if(a.getCullFace()!==undefined){n.setCullFace(a.getCullFace())}if(a.getBackFaceNormalFlip()!==undefined){n.setBackFaceNormalFlip(a.getBackFaceNormalFlip())}n.setTextureCoordinatesGeneration(a.getTextureCoordinatesGeneration());n.setTextureImage(null)}}else{if(q){if(r){this.restoreDefaultAppearance(n,null)}else{n.setTextureCoordinatesGeneration(this.getTextureCoordinates(n,o,z,d));var j=mat3.create();mat3.rotate(j,j,o.getAngle());n.setTextureTransform(j);this.updateAppearanceMaterial(n,Object3DBranch.DEFAULT_COLOR,Object3DBranch.DEFAULT_AMBIENT_COLOR,f);TextureManager.getInstance().loadTexture(o.getImage(),0,l,this.getTextureObserver(n))}}else{if(g){var p=false;for(var w=0;w<c.length;w++){var m=c[w];if(m!==null&&(m.getKey()!=null&&m.getKey()==n.getName()||m.getKey()==null&&m.getName()==n.getName())){if(m.getShininess()!==null){f=m.getShininess()}u=m.getColor();if(u!==null&&(u&4278190080)!=0){this.updateAppearanceMaterial(n,u,u,f);if(a.getTransparency()!==undefined){n.setTransparency(a.getTransparency())}if(a.getCullFace()!==undefined){n.setCullFace(a.getCullFace())}if(a.getBackFaceNormalFlip()!==undefined){n.setBackFaceNormalFlip(a.getBackFaceNormalFlip())}n.setTextureImage(null)}else{if(u===null&&m.getTexture()!==null){if(this.isTexturesCoordinatesDefined(b)){this.restoreDefaultTextureCoordinatesGeneration(n)}else{n.setTextureCoordinatesGeneration(this.getTextureCoordinates(n,m.getTexture(),z,d))}var j=mat3.create();mat3.rotate(j,j,m.getTexture().getAngle());n.setTextureTransform(j);this.updateAppearanceMaterial(n,Object3DBranch.DEFAULT_COLOR,Object3DBranch.DEFAULT_AMBIENT_COLOR,f);var h=m.getTexture();TextureManager.getInstance().loadTexture(h.getImage(),0,l,this.getTextureObserver(n))}else{this.restoreDefaultAppearance(n,m.getShininess())}}p=true;break}}if(!p){this.restoreDefaultAppearance(n,null)}}else{this.restoreDefaultAppearance(n,t)}}}y.push(n)}}}};HomePieceOfFurniture3D.prototype.getTextureObserver=function(a){return{textureUpdated:function(b){if(TextureManager.getInstance().isTextureTransparent(b)){a.setCullFace(Appearance3D.CULL_NONE)}else{var c=a.defaultAppearance;if(c!==null&&c.getCullFace()!==null){a.setCullFace(c.getCullFace())}}if(a.getTextureImage()!==b){a.setTextureImage(b)}},textureError:function(b){return this.textureUpdated(TextureManager.getInstance().getErrorImage())},progression:function(c,d,b){}}};HomePieceOfFurniture3D.prototype.getTextureCoordinates=function(i,j,d,m){var e=vec3.create();m.getLower(e);var o=vec3.create();m.getUpper(o);var a=ModelManager.getInstance().getMinimumSize();var f=TextureManager.getInstance();var h=f.getRotatedTextureWidth(j);var n=f.getRotatedTextureHeight(j);var k=d[0]/Math.max(o[0]-e[0],a)/h;var l=-e[0]*k;var c=d[1]/Math.max(o[1]-e[1],a)/n;var b=d[2]/Math.max(o[2]-e[2],a)/n;var g=-e[1]*c+o[2]*b;return{planeS:vec4.fromValues(k,0,0,l),planeT:vec4.fromValues(0,c,-b,g)}};HomePieceOfFurniture3D.prototype.isTexturesCoordinatesDefined=function(a){var c=a.getGeometries();for(var b=0,d=c.length;b<d;b++){if(!c[b].hasTextureCoordinates()){return false}}return true};HomePieceOfFurniture3D.prototype.restoreDefaultAppearance=function(a,b){if(a.defaultAppearance!==undefined){var c=a.defaultAppearance;if(c.getAmbientColor()!==undefined){a.setAmbientColor(c.getAmbientColor())}if(c.getDiffuseColor()!==undefined){a.setDiffuseColor(c.getDiffuseColor());a.setSpecularColor(vec3.fromValues(b,b,b));a.setShininess(b*128)}if(c.getTransparency()!==undefined){a.setTransparency(c.getTransparency())}if(a.getCullFace()!==undefined){a.setCullFace(c.getCullFace());a.setBackFaceNormalFlip(c.isBackFaceNormalFlip())}if(c.getTextureCoordinatesGeneration()!==undefined){a.setTextureCoordinatesGeneration(c.getTextureCoordinatesGeneration())}if(a.getTextureImage()!==undefined){a.setTextureImage(c.getTextureImage())}}};HomePieceOfFurniture3D.prototype.restoreDefaultTextureCoordinatesGeneration=function(a){if(a.defaultAppearance!==undefined){var b=a.defaultAppearance;if(b.getTextureCoordinatesGeneration()!==undefined){a.setTextureCoordinatesGeneration(b.getTextureCoordinatesGeneration())}}};HomePieceOfFurniture3D.prototype.setVisible=function(c,b,k){if(c instanceof Group3D){var a=c.getChildren();for(var e=0;e<a.length;e++){this.setVisible(a[e],b,k)}}else{if(c instanceof Shape3D){var h=c;var f=h.getAppearance();if(f===null){f=new Appearance3D();c.setAppearance(f)}var j=h.getName();if(b&&j!==null&&j.indexOf(ModelManager.LIGHT_SHAPE_PREFIX)===0&&this.home!==null&&!this.isSelected(this.home.getSelectedItems())&&(typeof HomeLight==="undefined"||this.getUserData() instanceof HomeLight)){b=false}if(b&&k!==null){for(var e=0;e<k.length;e++){var g=k[e];if(g!==null&&g.getName()==f.getName()){var d=g.getColor();b=d===null||(d&4278190080)!==0;break}}}f.setVisible(b)}}};HomePieceOfFurniture3D.prototype.isSelected=function(c){for(var a=0;a<c.length;a++){var b=c[a];if(b===this.getUserData()||(b instanceof HomeFurnitureGroup&&this.isSelected(b.getFurniture()))){return true}}return false};HomePieceOfFurniture3D.prototype.setCullFace=function(f,g,h){if(f instanceof Group3D){var e=f.getChildren();for(var d=0;d<e.length;d++){this.setCullFace(e[d],g,h)}}else{if(f instanceof Shape3D){var a=f.getAppearance();if(a===null){a=new Appearance3D();f.setAppearance(a)}if(a.getCullFace()!==Appearance3D.CULL_NONE){var c=a.getCullFace()!==undefined?a.getCullFace():Appearance3D.CULL_BACK;var b=a.defaultCullFace;if(b===undefined){a.defaultCullFace=(b=c)}a.setCullFace((g^h^b===Appearance3D.CULL_FRONT)?Appearance3D.CULL_FRONT:Appearance3D.CULL_BACK)}}}};HomePieceOfFurniture3D.prototype.setBackFaceNormalFlip=function(d,e){if(d instanceof Group3D){var c=d.getChildren();for(var b=0;b<c.length;b++){this.setBackFaceNormalFlip(c[b],e)}}else{if(d instanceof Shape3D){var a=d.getAppearance();if(a===null){a=new Appearance3D();d.setAppearance(a)}a.setBackFaceNormalFlip(e^a.getCullFace()===Appearance3D.CULL_FRONT)}}};HomePieceOfFurniture3D.prototype.setTransparentShapeNotPickable=function(d){if(d instanceof Group3D){var c=d.getChildren();for(var b=0;b<c.length;b++){this.setTransparentShapeNotPickable(c[b])}}else{if(d instanceof Shape3D){var a=d.getAppearance();if(a!==null&&a.getTransparency()>0){d.setPickable(false)}}}};function TextureManager(){this.loadedTextureImages={};this.loadingTextureObservers={}}TextureManager.READING_TEXTURE="Reading texture";TextureManager.instance=null;TextureManager.getInstance=function(){if(TextureManager.instance==null){TextureManager.instance=new TextureManager()}return TextureManager.instance};TextureManager.prototype.clear=function(){this.loadedTextureImages={};this.loadingTextureObservers={}};TextureManager.prototype.loadTexture=function(d,g,b,c){if(c===undefined){c=b;b=false}var f=d.getURL();if(f in this.loadedTextureImages){c.textureUpdated(this.loadedTextureImages[f])}else{if(f in this.loadingTextureObservers){this.loadingTextureObservers[f].push(c)}else{var e=[];e.push(c);this.loadingTextureObservers[f]=e;var a=this;this.load(f,b,{textureLoaded:function(h){var k=a.loadingTextureObservers[f];if(k){delete a.loadingTextureObservers[f];a.loadedTextureImages[f]=h;for(var j=0;j<k.length;j++){k[j].textureUpdated(h)}}},textureError:function(j){var k=a.loadingTextureObservers[f];if(k){delete a.loadingTextureObservers[f];for(var h=0;h<k.length;h++){k[h].textureError(j)}}},progression:function(j,l,h){var m=a.loadingTextureObservers[f];if(m){for(var k=0;k<m.length;k++){m[k].progression(j,l,h)}}}})}}};TextureManager.prototype.load=function(b,a,d){d.progression(TextureManager.READING_TEXTURE,b,0);var h=new Image();h.url=b;var e=function(j){h.removeEventListener("load",i);h.removeEventListener("error",e);d.textureError("Can't load "+b)};var i=function(){h.removeEventListener("load",i);h.removeEventListener("error",e);d.progression(TextureManager.READING_TEXTURE,b,1);d.textureLoaded(h)};if(b.indexOf("jar:")===0){var g=b.indexOf("!/");var c=decodeURIComponent(b.substring(g+2));var f=b.substring(4,g);ZIPTools.getZIP(f,a,{zipReady:function(l){try{h.addEventListener("load",i);h.addEventListener("error",e);var j=l.file(c);var n=j.asBinary();var m=btoa(n);h.transparent=ZIPTools.isTranparentImage(n);h.src="data:image;base64,"+m;if(h.width!==0){h.removeEventListener("load",i);h.removeEventListener("error",e);d.progression(TextureManager.READING_TEXTURE,b,1);d.textureLoaded(h)}}catch(k){this.zipError(k)}},zipError:function(j){if(d.textureError!==undefined){d.textureError("Can't load "+f)}},progression:function(k,l,j){if(d.progression!==undefined){d.progression(k,l,j)}}})}else{h.addEventListener("load",i);h.addEventListener("error",e);h.src=b;if(h.width!==0){h.removeEventListener("load",i);h.removeEventListener("error",e);d.progression(TextureManager.READING_TEXTURE,b,1);d.textureLoaded(h)}}};TextureManager.prototype.isTextureTransparent=function(a){return a.transparent===true};TextureManager.prototype.getRotatedTextureWidth=function(a){var b=a.getAngle();if(b!==0){return Math.round(Math.abs(a.getWidth()*Math.cos(b))+Math.abs(a.getHeight()*Math.sin(b)))}else{return a.getWidth()}};TextureManager.prototype.getRotatedTextureHeight=function(a){var b=a.getAngle();if(b!==0){return Math.round(Math.abs(a.getWidth()*Math.sin(b))+Math.abs(a.getHeight()*Math.cos(b)))}else{return a.getHeight()}};TextureManager.prototype.getErrorImage=function(){if(TextureManager.errorImage===undefined){var b=document.createElement("canvas");b.width=2;b.height=2;var c=b.getContext("2d");c.fillStyle="#FF0000";c.fillRect(0,0,2,2);var d=b.toDataURL();var a=new Image();a.url=d;a.src=d;TextureManager.errorImage=a}return TextureManager.errorImage};function HomeController3D(e,b,a,d,c){this.home=e;this.preferences=b;this.viewFactory=a;this.contentManager=d;this.undoSupport=c;this.home3DView=null;this.topCameraState=new TopCameraState(e,b);this.observerCameraState=new ObserverCameraState(e,b);this.cameraState=null;this.setCameraState(e.getCamera()===e.getTopCamera()?this.topCameraState:this.observerCameraState);this.addModelListeners(e)}HomeController3D.prototype.addModelListeners=function(e){var c=this;e.addPropertyChangeListener("CAMERA",function(f){c.setCameraState(e.getCamera()==e.getTopCamera()?c.topCameraState:c.observerCameraState)});var b=function(f){if("ELEVATION"==f.getPropertyName()&&e.getEnvironment().isObserverCameraElevationAdjusted()){e.getObserverCamera().setZ(Math.max(c.getObserverCameraMinimumElevation(e),e.getObserverCamera().getZ()+f.getNewValue()-f.getOldValue()))}};var d=e.getSelectedLevel();if(d!==null){d.addPropertyChangeListener(b)}e.addPropertyChangeListener("SELECTED_LEVEL",function(g){var f=g.getOldValue();var h=e.getSelectedLevel();if(e.getEnvironment().isObserverCameraElevationAdjusted()){e.getObserverCamera().setZ(Math.max(c.getObserverCameraMinimumElevation(e),e.getObserverCamera().getZ()+(h===null?0:h.getElevation())-(f===null?0:f.getElevation())))}if(f!==null){f.removePropertyChangeListener(b)}if(h!==null){h.addPropertyChangeListener(b)}});var a=function(g){var j=e.getLevels();var h=e.getSelectedLevel();var k=true;for(var f=0;f<j.length;f++){j[f].setVisible(k);if(j[f]===h&&!e.getEnvironment().isAllLevelsVisible()){k=false}}};e.addPropertyChangeListener("SELECTED_LEVEL",a);e.getEnvironment().addPropertyChangeListener("ALL_LEVELS_VISIBLE",a)};HomeController3D.prototype.getObserverCameraMinimumElevation=function(c){var b=c.getLevels();var a=b.length===0?10:10+b[0].getElevation();return a};HomeController3D.prototype.getView=function(){if(this.home3DView==null){this.home3DView=this.viewFactory.createView3D(this.home,this.preferences,this)}return this.home3DView};HomeController3D.prototype.viewFromTop=function(){this.home.setCamera(this.home.getTopCamera())};HomeController3D.prototype.viewFromObserver=function(){this.home.setCamera(this.home.getObserverCamera())};HomeController3D.prototype.storeCamera=function(b){var e=this.home.getCamera().clone();e.setName(b);var d=this.home.getStoredCameras();var a=[];a.push.apply(a,d);for(var c=a.length;c>=0;c--){var f=a[c];if(b==f.getName()||(e.getX()==f.getX()&&e.getY()==f.getY()&&e.getZ()==f.getZ()&&e.getPitch()==f.getPitch()&&e.getYaw()==f.getYaw()&&e.getFieldOfView()==f.getFieldOfView()&&e.getTime()==f.getTime()&&e.getLens()==f.getLens())){a.splice(c,1)}}a.splice(0,0,e);while(a.length>this.preferences.getStoredCamerasMaxCount()){a.splice(a.length-1)}this.home.setStoredCameras(a)};HomeController3D.prototype.goToCamera=function(b){if(b instanceof ObserverCamera){this.viewFromObserver()}else{this.viewFromTop()}this.cameraState.goToCamera(b);var a=this.home.getStoredCameras().slice(0);a.splice(a.indexOf(b),1);a.splice(0,0,b);this.home.setStoredCameras(a)};HomeController3D.prototype.deleteCameras=function(d){var c=this.home.getStoredCameras();var a=[];for(var b=0;b<c.length;b++){var e=c[b];if(d.indexOf(e)===-1){a.push(e)}}this.home.setStoredCameras(a)};HomeController3D.prototype.displayAllLevels=function(){this.home.getEnvironment().setAllLevelsVisible(true)};HomeController3D.prototype.displaySelectedLevel=function(){this.home.getEnvironment().setAllLevelsVisible(false)};HomeController3D.prototype.modifyAttributes=function(){};HomeController3D.prototype.setCameraState=function(a){if(this.cameraState!==null){this.cameraState.exit()}this.cameraState=a;this.cameraState.enter()};HomeController3D.prototype.moveCamera=function(a){this.cameraState.moveCamera(a)};HomeController3D.prototype.moveCameraSideways=function(a){this.cameraState.moveCameraSideways(a)};HomeController3D.prototype.elevateCamera=function(a){this.cameraState.elevateCamera(a)};HomeController3D.prototype.rotateCameraYaw=function(a){this.cameraState.rotateCameraYaw(a)};HomeController3D.prototype.rotateCameraPitch=function(a){this.cameraState.rotateCameraPitch(a)};HomeController3D.prototype.getObserverCameraState=function(){return this.observerCameraState};HomeController3D.prototype.getTopCameraState=function(){return this.topCameraState};function CameraControllerState(){}CameraControllerState.prototype.enter=function(){};CameraControllerState.prototype.exit=function(){};CameraControllerState.prototype.moveCamera=function(a){};CameraControllerState.prototype.moveCameraSideways=function(a){};CameraControllerState.prototype.elevateCamera=function(a){};CameraControllerState.prototype.rotateCameraYaw=function(a){};CameraControllerState.prototype.rotateCameraPitch=function(a){};CameraControllerState.prototype.goToCamera=function(a){};function TopCameraState(d,a){CameraControllerState.call(this);this.home=d;this.topCamera=null;this.aerialViewBoundsLowerPoint=null;this.aerialViewBoundsUpperPoint=null;this.minDistanceToAerialViewCenter=0;this.maxDistanceToAerialViewCenter=0;this.aerialViewCenteredOnSelectionEnabled=a.isAerialViewCenteredOnSelectionEnabled();var c=this;a.addPropertyChangeListener("AERIAL_VIEW_CENTERED_ON_SELECTION_ENABLED",function(e){c.setAerialViewCenteredOnSelectionEnabled(a.isAerialViewCenteredOnSelectionEnabled())});var b=function(e){c.updateCameraFromHomeBounds(false)};this.objectChangeListener=b;this.levelsListener=function(e){if(e.getType()===CollectionEvent.Type.ADD){e.getItem().addPropertyChangeListener(b)}else{if(e.getType()===CollectionEvent.Type.DELETE){e.getItem().removePropertyChangeListener(b)}}c.updateCameraFromHomeBounds(false)};this.wallsListener=function(e){if(e.getType()===CollectionEvent.Type.ADD){e.getItem().addPropertyChangeListener(b)}else{if(e.getType()===CollectionEvent.Type.DELETE){e.getItem().removePropertyChangeListener(b)}}c.updateCameraFromHomeBounds(false)};this.furnitureListener=function(e){if(e.getType()===CollectionEvent.Type.ADD){e.getItem().addPropertyChangeListener(b);c.updateCameraFromHomeBounds(c.home.getFurniture().length===1&&c.home.getWalls().length===0&&c.home.getRooms().length===0)}else{if(e.getType()===CollectionEvent.Type.DELETE){e.getItem().removePropertyChangeListener(b);c.updateCameraFromHomeBounds(false)}}};this.roomsListener=function(e){if(e.getType()===CollectionEvent.Type.ADD){e.getItem().addPropertyChangeListener(b)}else{if(e.getType()===CollectionEvent.Type.DELETE){e.getItem().removePropertyChangeListener(b)}}c.updateCameraFromHomeBounds(false)};this.labelsListener=function(e){if(e.getType()===CollectionEvent.Type.ADD){e.getItem().addPropertyChangeListener(b)}else{if(e.getType()===CollectionEvent.Type.DELETE){e.getItem().removePropertyChangeListener(b)}}c.updateCameraFromHomeBounds(false)};this.selectionListener=function(e){c.updateCameraFromHomeBounds(false)}}TopCameraState.prototype=Object.create(CameraControllerState.prototype);TopCameraState.prototype.constructor=TopCameraState;TopCameraState.MIN_WIDTH=100;TopCameraState.MIN_DEPTH=TopCameraState.MIN_WIDTH;TopCameraState.MIN_HEIGHT=20;TopCameraState.prototype.enter=function(){this.topCamera=this.home.getCamera();this.updateCameraFromHomeBounds(false);var d=this.home.getLevels();for(var b=0;b<d.length;b++){d[b].addPropertyChangeListener(this.objectChangeListener)}this.home.addLevelsListener(this.levelsListener);var a=this.home.getWalls();for(var b=0;b<a.length;b++){a[b].addPropertyChangeListener(this.objectChangeListener)}this.home.addWallsListener(this.wallsListener);var c=this.home.getFurniture();for(var b=0;b<c.length;b++){c[b].addPropertyChangeListener(this.objectChangeListener)}this.home.addFurnitureListener(this.furnitureListener);var e=this.home.getRooms();for(var b=0;b<e.length;b++){e[b].addPropertyChangeListener(this.objectChangeListener)}this.home.addRoomsListener(this.roomsListener);var f=this.home.getLabels();for(var b=0;b<f.length;b++){f[b].addPropertyChangeListener(this.objectChangeListener)}this.home.addLabelsListener(this.labelsListener);this.home.addSelectionListener(this.selectionListener)};TopCameraState.prototype.setAerialViewCenteredOnSelectionEnabled=function(a){this.aerialViewCenteredOnSelectionEnabled=a;this.updateCameraFromHomeBounds(false)};TopCameraState.prototype.updateCameraFromHomeBounds=function(b){if(this.aerialViewBoundsLowerPoint===null){this.updateAerialViewBoundsFromHomeBounds(this.aerialViewCenteredOnSelectionEnabled)}var a=this.getCameraToAerialViewCenterDistance();this.updateAerialViewBoundsFromHomeBounds(this.aerialViewCenteredOnSelectionEnabled);this.updateCameraIntervalToAerialViewCenter();this.placeCameraAt(a,b)};TopCameraState.prototype.getCameraToAerialViewCenterDistance=function(){return Math.sqrt(Math.pow((this.aerialViewBoundsLowerPoint[0]+this.aerialViewBoundsUpperPoint[0])/2-this.topCamera.getX(),2)+Math.pow((this.aerialViewBoundsLowerPoint[1]+this.aerialViewBoundsUpperPoint[1])/2-this.topCamera.getY(),2)+Math.pow((this.aerialViewBoundsLowerPoint[2]+this.aerialViewBoundsUpperPoint[2])/2-this.topCamera.getZ(),2))};TopCameraState.prototype.updateAerialViewBoundsFromHomeBounds=function(f){this.aerialViewBoundsLowerPoint=this.aerialViewBoundsUpperPoint=null;var e=[];if(f){var k=this.home.getSelectedItems();for(var q=0;q<k.length;q++){var w=k[q];if(typeof(w.getLevel)==="function"&&this.isItemAtVisibleLevel(w)&&(!(w instanceof HomePieceOfFurniture)||w.isVisible())&&(typeof Label==="undefined"||!(w instanceof Label)||w.getPitch()!==null)){e.push(w)}}}var d=e.length===0||!f;var l=false;var y=d?this.home.getWalls():Home.getWallsSubList(e);for(var q=0;q<y.length;q++){var t=y[q];if(this.isItemAtVisibleLevel(t)){l=true;var z=t.getLevel()!==null?t.getLevel().getElevation():0;var u=d?0:z;var h=t.getHeight();var r;if(h!==null){r=z+h}else{r=z+this.home.getWallHeight()}var m=t.getHeightAtEnd();if(m!==null){r=Math.max(r,z+m)}var p=t.getPoints();for(var o=0;o<p.length;o++){var n=p[o];this.updateAerialViewBounds(n[0],n[1],u,r)}}}var g=d?this.home.getFurniture():Home.getFurnitureSubList(e);for(var q=0;q<g.length;q++){var a=g[q];if(a.isVisible()&&this.isItemAtVisibleLevel(a)){var u;var r;if(d){u=Math.max(0,a.getGroundElevation());r=Math.max(0,a.getGroundElevation()+a.getHeight())}else{u=a.getGroundElevation();r=a.getGroundElevation()+a.getHeight()}var p=a.getPoints();for(var o=0;o<p.length;o++){var n=p[o];this.updateAerialViewBounds(n[0],n[1],u,r)}}}var x=d?this.home.getRooms():Home.getRoomsSubList(e);for(var q=0;q<x.length;q++){var s=x[q];if(this.isItemAtVisibleLevel(s)){var u=0;var r=MIN_HEIGHT;var b=s.getLevel();if(b!==null){u=b.getElevation()-b.getFloorThickness();r=b.getElevation();if(d){u=Math.max(0,u);r=Math.max(MIN_HEIGHT,b.getElevation())}}var p=s.getPoints();for(var o=0;o<p.length;o++){var n=p[o];this.updateAerialViewBounds(n[0],n[1],u,r)}}}var v=d?this.home.getLabels():Home.getLabelsSubList(e);for(var q=0;q<v.length;q++){var c=v[q];if(c.getPitch()!==null&&this.isItemAtVisibleLevel(c)){var u;var r;if(d){u=Math.max(0,c.getGroundElevation());r=Math.max(MIN_HEIGHT,c.getGroundElevation())}else{u=r=c.getGroundElevation()}var p=c.getPoints();for(var o=0;o<p.length;o++){var n=p[o];this.updateAerialViewBounds(n[0],n[1],u,r)}}}if(this.aerialViewBoundsLowerPoint===null){this.aerialViewBoundsLowerPoint=[0,0,0];this.aerialViewBoundsUpperPoint=[TopCameraState.MIN_WIDTH,TopCameraState.MIN_DEPTH,TopCameraState.MIN_HEIGHT]}else{if(l&&d){if(MIN_WIDTH>this.aerialViewBoundsUpperPoint[0]-this.aerialViewBoundsLowerPoint[0]){this.aerialViewBoundsLowerPoint[0]=(this.aerialViewBoundsLowerPoint[0]+this.aerialViewBoundsUpperPoint[0])/2-MIN_WIDTH/2;this.aerialViewBoundsUpperPoint[0]=this.aerialViewBoundsLowerPoint[0]+MIN_WIDTH}if(MIN_DEPTH>this.aerialViewBoundsUpperPoint[1]-this.aerialViewBoundsLowerPoint[1]){this.aerialViewBoundsLowerPoint[1]=(this.aerialViewBoundsLowerPoint[1]+this.aerialViewBoundsUpperPoint[1])/2-MIN_DEPTH/2;this.aerialViewBoundsUpperPoint[1]=this.aerialViewBoundsLowerPoint[1]+MIN_DEPTH}if(MIN_HEIGHT>this.aerialViewBoundsUpperPoint[2]-this.aerialViewBoundsLowerPoint[2]){this.aerialViewBoundsLowerPoint[2]=(this.aerialViewBoundsLowerPoint[2]+this.aerialViewBoundsUpperPoint[2])/2-MIN_HEIGHT/2;this.aerialViewBoundsUpperPoint[2]=this.aerialViewBoundsLowerPoint[2]+MIN_HEIGHT}}}};TopCameraState.prototype.updateAerialViewBounds=function(a,d,c,b){if(this.aerialViewBoundsLowerPoint===null){this.aerialViewBoundsLowerPoint=[a,d,c];this.aerialViewBoundsUpperPoint=[a,d,b]}else{this.aerialViewBoundsLowerPoint[0]=Math.min(this.aerialViewBoundsLowerPoint[0],a);this.aerialViewBoundsUpperPoint[0]=Math.max(this.aerialViewBoundsUpperPoint[0],a);this.aerialViewBoundsLowerPoint[1]=Math.min(this.aerialViewBoundsLowerPoint[1],d);this.aerialViewBoundsUpperPoint[1]=Math.max(this.aerialViewBoundsUpperPoint[1],d);this.aerialViewBoundsLowerPoint[2]=Math.min(this.aerialViewBoundsLowerPoint[2],c);this.aerialViewBoundsUpperPoint[2]=Math.max(this.aerialViewBoundsUpperPoint[2],b)}};TopCameraState.prototype.isItemAtVisibleLevel=function(a){return a.getLevel()===null||a.getLevel().isViewableAndVisible()};TopCameraState.prototype.updateCameraIntervalToAerialViewCenter=function(){var b=this.aerialViewBoundsUpperPoint[0]-this.aerialViewBoundsLowerPoint[0];var d=this.aerialViewBoundsUpperPoint[1]-this.aerialViewBoundsLowerPoint[1];var a=this.aerialViewBoundsUpperPoint[2]-this.aerialViewBoundsLowerPoint[2];var c=Math.sqrt(b*b+d*d+a*a)/2;this.minDistanceToAerialViewCenter=c*1.05;this.maxDistanceToAerialViewCenter=Math.max(5*this.minDistanceToAerialViewCenter,2500)};TopCameraState.prototype.moveCamera=function(b){b*=5;var a=this.getCameraToAerialViewCenterDistance()-b;this.placeCameraAt(a,false)};TopCameraState.prototype.placeCameraAt=function(a,c){a=Math.max(a,this.minDistanceToAerialViewCenter);a=Math.min(a,this.maxDistanceToAerialViewCenter);if(c){a=Math.min(a,3*this.minDistanceToAerialViewCenter)}var b=a*Math.cos(this.topCamera.getPitch());this.topCamera.setX((this.aerialViewBoundsLowerPoint[0]+this.aerialViewBoundsUpperPoint[0])/2+(Math.sin(this.topCamera.getYaw())*b));this.topCamera.setY((this.aerialViewBoundsLowerPoint[1]+this.aerialViewBoundsUpperPoint[1])/2-(Math.cos(this.topCamera.getYaw())*b));this.topCamera.setZ((this.aerialViewBoundsLowerPoint[2]+this.aerialViewBoundsUpperPoint[2])/2+Math.sin(this.topCamera.getPitch())*a)};TopCameraState.prototype.rotateCameraYaw=function(c){var a=this.topCamera.getYaw()+c;var b=this.getCameraToAerialViewCenterDistance()*Math.cos(this.topCamera.getPitch());this.topCamera.setYaw(a);this.topCamera.setX((this.aerialViewBoundsLowerPoint[0]+this.aerialViewBoundsUpperPoint[0])/2+Math.sin(a)*b);this.topCamera.setY((this.aerialViewBoundsLowerPoint[1]+this.aerialViewBoundsUpperPoint[1])/2-Math.cos(a)*b)};TopCameraState.prototype.rotateCameraPitch=function(d){var c=this.topCamera.getPitch()+d;c=Math.max(c,0);c=Math.min(c,Math.PI/2);var a=this.getCameraToAerialViewCenterDistance();var b=a*Math.cos(c);this.topCamera.setPitch(c);this.topCamera.setX((this.aerialViewBoundsLowerPoint[0]+this.aerialViewBoundsUpperPoint[0])/2+Math.sin(this.topCamera.getYaw())*b);this.topCamera.setY((this.aerialViewBoundsLowerPoint[1]+this.aerialViewBoundsUpperPoint[1])/2-Math.cos(this.topCamera.getYaw())*b);this.topCamera.setZ((this.aerialViewBoundsLowerPoint[2]+this.aerialViewBoundsUpperPoint[2])/2+a*Math.sin(c))};TopCameraState.prototype.goToCamera=function(a){this.topCamera.setCamera(a);this.topCamera.setTime(a.getTime());this.topCamera.setLens(a.getLens());this.updateCameraFromHomeBounds(false)};TopCameraState.prototype.exit=function(){this.topCamera=null;var a=this.home.getWalls();for(var b=0;b<a.length;b++){a[b].removePropertyChangeListener(this.objectChangeListener)}this.home.removeWallsListener(this.wallsListener);var d=this.home.getFurniture();for(var b=0;b<d.length;b++){d[b].removePropertyChangeListener(this.objectChangeListener)}this.home.removeFurnitureListener(this.furnitureListener);var e=this.home.getRooms();for(var b=0;b<e.length;b++){e[b].removePropertyChangeListener(this.objectChangeListener)}this.home.removeRoomsListener(this.roomsListener);var f=this.home.getLabels();for(var b=0;b<f.length;b++){f[b].removePropertyChangeListener(this.objectChangeListener)}this.home.removeLabelsListener(this.labelsListener);var c=this.home.getLevels();for(var b=0;b<c.length;b++){c[b].removePropertyChangeListener(this.objectChangeListener)}this.home.removeLevelsListener(this.levelsListener);this.home.removeSelectionListener(this.selectionListener)};function ObserverCameraState(c,b){CameraControllerState.call(this);this.home=c;this.preferences=b;this.observerCamera=null;var a=this;this.levelElevationChangeListener=function(d){if("ELEVATION"==d.getPropertyName()){a.updateCameraMinimumElevation()}};this.levelsListener=function(d){if(d.getType()===CollectionEvent.Type.ADD){d.getItem().addPropertyChangeListener(levelElevationChangeListener)}else{if(d.getType()===CollectionEvent.Type.DELETE){d.getItem().removePropertyChangeListener(levelElevationChangeListener)}}a.updateCameraMinimumElevation()}}ObserverCameraState.prototype=Object.create(CameraControllerState.prototype);ObserverCameraState.prototype.constructor=ObserverCameraState;ObserverCameraState.prototype.enter=function(){this.observerCamera=this.home.getCamera();var b=this.home.getLevels();for(var a=0;a<b.length;a++){var c=b[a];c.addPropertyChangeListener(this.levelElevationChangeListener)}this.home.addLevelsListener(this.levelsListener);this.home.setSelectedItems([this.observerCamera])};ObserverCameraState.prototype.moveCamera=function(a){this.observerCamera.setX(this.observerCamera.getX()-Math.sin(this.observerCamera.getYaw())*a);this.observerCamera.setY(this.observerCamera.getY()+Math.cos(this.observerCamera.getYaw())*a);this.home.setSelectedItems([this.observerCamera])};ObserverCameraState.prototype.moveCameraSideways=function(a){this.observerCamera.setX(this.observerCamera.getX()-Math.cos(this.observerCamera.getYaw())*a);this.observerCamera.setY(this.observerCamera.getY()-Math.sin(this.observerCamera.getYaw())*a);this.home.setSelectedItems([this.observerCamera])};ObserverCameraState.prototype.elevateCamera=function(b){var a=this.observerCamera.getZ()+b;a=Math.min(Math.max(a,this.getMinimumElevation()),this.preferences.getLengthUnit().getMaximumElevation());this.observerCamera.setZ(a);this.home.setSelectedItems([this.observerCamera])};ObserverCameraState.prototype.updateCameraMinimumElevation=function(){observerCamera.setZ(Math.max(observerCamera.getZ(),this.getMinimumElevation()))};ObserverCameraState.prototype.getMinimumElevation=function(){var a=this.home.getLevels();if(a.length>0){return 10+a[0].getElevation()}else{return 10}};ObserverCameraState.prototype.rotateCameraYaw=function(a){this.observerCamera.setYaw(this.observerCamera.getYaw()+a);this.home.setSelectedItems([this.observerCamera])};ObserverCameraState.prototype.rotateCameraPitch=function(b){var a=this.observerCamera.getPitch()+b;a=Math.max(a,-Math.PI/2);a=Math.min(a,Math.PI/2);this.observerCamera.setPitch(a);this.home.setSelectedItems([this.observerCamera])};ObserverCameraState.prototype.goToCamera=function(a){this.observerCamera.setCamera(a);this.observerCamera.setTime(a.getTime());this.observerCamera.setLens(a.getLens())};ObserverCameraState.prototype.exit=function(){var d=this.home.getSelectedItems();var a=d.indexOf(this.observerCamera);if(a!==-1){d=d.slice(0);d.splice(a,1);this.home.setSelectedItems(d)}var c=this.home.getLevels();for(var b=0;b<c.length;b++){c[b].removePropertyChangeListener(this.levelElevationChangeListener)}this.home.removeLevelsListener(this.levelsListener);this.observerCamera=null};function viewHome(e,c,a,b,d){return new HomePreviewComponent(e,c,a,b,d)}function viewHomeInOverlay(f,s){var g=4/3;if(s&&s.widthByHeightRatio){g=s.widthByHeightRatio}hideHomeOverlay();var o=document.createElement("div");o.setAttribute("id","viewerOverlay");o.style.position="absolute";o.style.left="0";o.style.top="0";o.style.zIndex="100";o.style.background="rgba(127, 127, 127, .5)";var m=document.getElementsByTagName("body").item(0);m.insertBefore(o,m.firstChild);var v=document.createElement("div");var l='<canvas id="viewerCanvas" class="viewerComponent"  style="background-color: #CCCCCC; border: 1px solid gray; position: absolute; outline: none; touch-action: none" tabIndex="1"></canvas><div id="viewerProgressDiv" style="position:absolute; width: 300px; background-color: rgba(128, 128, 128, 0.7); padding: 20px; border-radius: 25px">  <progress id="viewerProgress"  class="viewerComponent" value="0" max="200" style="width: 300px;"></progress>  <label id="viewerProgressLabel" class="viewerComponent" style="margin-top: 2px; margin-left: 10px; margin-right: 0px; display: block;"></label></div>';if(s&&(s.aerialViewButtonText&&s.virtualVisitButtonText||s.viewerControlsAdditionalHTML)){l+='<div id="viewerControls" style="position: absolute; padding: 10px; padding-top: 5px">';if(s.aerialViewButtonText&&s.virtualVisitButtonText){l+='   <input  id="aerialView" class="viewerComponent" name="cameraType" type="radio" style="visibility: hidden;"/>      <label class="viewerComponent" for="aerialView" style="visibility: hidden;">'+s.aerialViewButtonText+'</label>   <input  id="virtualVisit" class="viewerComponent" name="cameraType" type="radio" style="visibility: hidden;">      <label class="viewerComponent" for="virtualVisit" style="visibility: hidden;">'+s.virtualVisitButtonText+'</label>   <select id="levelsAndCameras" class="viewerComponent" style="visibility: hidden;"></select>'}if(s.viewerControlsAdditionalHTML){l+=s.viewerControlsAdditionalHTML}l+="</div>"}v.innerHTML=l;o.appendChild(v);var i=new Image();i.src=ZIPTools.getScriptFolder("jszip.min.js")+"/close.png";i.style.position="absolute";o.appendChild(i);o.escKeyListener=function(x){if(x.keyCode===27){hideHomeOverlay()}};window.addEventListener("keydown",o.escKeyListener);i.addEventListener("click",hideHomeOverlay);var t={mousePressed:function(x){t.mousePressedInOverlay=true},mouseClicked:function(x){if(t.mousePressedInOverlay){delete t.mousePressedInOverlay;hideHomeOverlay()}}};o.addEventListener("mousedown",t.mousePressed);o.addEventListener("click",t.mouseClicked);o.addEventListener("touchmove",function(x){x.preventDefault()});var w=self.innerWidth;var k=self.innerHeight;var u=document.documentElement.clientWidth;var j=document.documentElement.clientHeight;if(m&&m.scrollWidth){if(m.scrollWidth>u){u=m.scrollWidth}if(m.scrollHeight>j){j=m.scrollHeight}}var d=self.pageXOffset?self.pageXOffset:0;var b=self.pageYOffset?self.pageYOffset:0;o.style.height=Math.max(j,k)+"px";o.style.width=u<=w?"100%":u+"px";o.style.display="block";var e=document.getElementById("viewerCanvas");if(w<k*g){e.width=0.9*w;e.height=0.9*w/g}else{e.height=0.9*k;e.width=0.9*k*g}e.style.width=e.width+"px";e.style.height=e.height+"px";var q=d+(w-e.width-10)/2;e.style.left=q+"px";var r=b+(k-e.height-10)/2;e.style.top=r+"px";i.style.left=(q+e.width-5)+"px";i.style.top=(r-10)+"px";var p=document.getElementById("viewerControls");if(p){p.style.left=(q-10)+"px";p.style.top=(r+e.height)+"px";p.addEventListener("mousedown",function(x){x.stopPropagation()})}var h=document.getElementById("viewerProgressDiv");h.style.left=(q+(e.width-300)/2)+"px";h.style.top=(r+(e.height-50)/2)+"px";h.style.visibility="visible";var a=function(y){hideHomeOverlay();if(y=="No WebGL"){var x="Sorry, your browser doesn't support WebGL.";if(s.noWebGLSupportError){x=s.noWebGLSupportError}alert(x)}else{console.log(y.stack);alert("Error: "+(y.message?y.constructor.name+" "+y.message:y))}};var n=function(z,A,x){var y=document.getElementById("viewerProgress");if(y){var B=null;if(z===HomeRecorder.READING_HOME){y.value=x*100;A=A.substring(A.lastIndexOf("/")+1);B=s&&s.readingHomeText?s.readingHomeText:z}else{if(z===Node3D.READING_MODEL){y.value=100+x*100;if(x===1){document.getElementById("viewerProgressDiv").style.visibility="hidden"}B=s&&s.readingModelText?s.readingModelText:z}}if(B!==null){document.getElementById("viewerProgressLabel").innerHTML=(x?Math.floor(x*100)+"% ":"")+B+" "+A}}};var c=HomePreviewComponent;if(s){if(s.homePreviewComponentContructor){c=s.homePreviewComponentContructor}if(s.aerialViewButtonText&&s.virtualVisitButtonText){e.homePreviewComponent=new c("viewerCanvas",f,a,n,{roundsPerMinute:s.roundsPerMinute,navigationPanel:s.navigationPanel,aerialViewButtonId:"aerialView",virtualVisitButtonId:"virtualVisit",levelsAndCamerasListId:"levelsAndCameras",selectableLevels:s.selectableLevels})}else{e.homePreviewComponent=new c("viewerCanvas",f,a,n,{roundsPerMinute:s.roundsPerMinute,navigationPanel:s.navigationPanel})}}else{e.homePreviewComponent=new c("viewerCanvas",f,a,n)}}function hideHomeOverlay(){var b=document.getElementById("viewerOverlay");if(b){var a=document.getElementById("viewerCanvas");if(a.homePreviewComponent){a.homePreviewComponent.dispose()}ModelManager.getInstance().clear();TextureManager.getInstance().clear();ZIPTools.clear();window.removeEventListener("keydown",b.escKeyListener);document.getElementsByTagName("body").item(0).removeChild(b)}}function HomePreviewComponent(f,d,a,c,e){if(document.getElementById(f)){var b=this;this.createHomeRecorder().readHome(d,{homeLoaded:function(j){try{var g=document.getElementById(f);if(g){if(e&&e.navigationPanel!="none"&&e.navigationPanel!="default"){function i(k){DefaultUserPreferences.call(this);this.navigationPanel=k}i.prototype=Object.create(DefaultUserPreferences.prototype);i.prototype.constructor=i;i.prototype.getLocalizedString=function(k,l,m){if(k===HomeComponent3D&&l=="navigationPanel.innerHTML"){return this.navigationPanel}else{return UserPreferences.prototype.getLocalizedString.call(this,k,l,m)}};b.preferences=new i(e.navigationPanel)}else{b.preferences=new DefaultUserPreferences()}b.home=j;b.controller=new HomeController3D(j,b.preferences);b.component3D=b.createComponent3D(f,j,b.preferences,b.controller);b.prepareComponent(f,c,e?{roundsPerMinute:e.roundsPerMinute,navigationPanelVisible:e.navigationPanel&&e.navigationPanel!="none",aerialViewButtonId:e.aerialViewButtonId,virtualVisitButtonId:e.virtualVisitButtonId,levelsAndCamerasListId:e.levelsAndCamerasListId,selectableLevels:e.selectableLevels}:undefined)}}catch(h){a(h)}},homeError:function(g){a(g)},progression:c})}else{a("No canvas with id equal to "+f)}}HomePreviewComponent.prototype.createHomeRecorder=function(){return new HomeRecorder()};HomePreviewComponent.prototype.createComponent3D=function(a){return new HomeComponent3D(a,this.getHome(),this.getUserPreferences(),null,this.getController())};HomePreviewComponent.prototype.prepareComponent=function(n,k,q){var f=q&&q.roundsPerMinute?q.roundsPerMinute:0;this.startRotationAnimationAfterLoading=f!=0;if(q&&typeof q.navigationPanelVisible){this.getUserPreferences().setNavigationPanelVisible(q.navigationPanelVisible)}var o=this.getHome();o.getEnvironment().setAllLevelsVisible(true);o.getEnvironment().setObserverCameraElevationAdjusted(true);this.trackFurnitureModels(k,f);var p=this;var d=function(){p.stopRotationAnimation();if(q&&q.aerialViewButtonId&&q.virtualVisitButtonId){if(o.getCamera()===o.getTopCamera()){document.getElementById(q.aerialViewButtonId).checked=true}else{document.getElementById(q.virtualVisitButtonId).checked=true}}};var t=function(){p.startRotationAnimationAfterLoading=false;o.setCamera(o.getCamera()===o.getTopCamera()?o.getObserverCamera():o.getTopCamera());d()};var b=document.getElementById(n);b.addEventListener("keydown",function(i){if(i.keyCode===32){t()}});if(q&&q.aerialViewButtonId&&q.virtualVisitButtonId){var l=document.getElementById(q.aerialViewButtonId);l.addEventListener("change",function(){p.startRotationAnimationAfterLoading=false;o.setCamera(l.checked?o.getTopCamera():o.getObserverCamera())});var r=document.getElementById(q.virtualVisitButtonId);r.addEventListener("change",function(){p.startRotationAnimationAfterLoading=false;o.setCamera(r.checked?o.getObserverCamera():o.getTopCamera())});d();l.style.visibility="visible";r.style.visibility="visible";var e=function(v){var w=document.getElementsByTagName("label");for(var u=0;u<w.length;u++){if(w[u].getAttribute("for")==v){w[u].style.visibility="visible"}}};e(q.aerialViewButtonId);e(q.virtualVisitButtonId);o.addPropertyChangeListener("CAMERA",function(){d();if(q&&q.levelsAndCamerasListId){document.getElementById(q.levelsAndCamerasListId).disabled=o.getCamera()===o.getTopCamera()}})}if(q&&q.levelsAndCamerasListId){var s=document.getElementById(q.levelsAndCamerasListId);s.disabled=o.getCamera()===o.getTopCamera();var c=o.getLevels();if(c.length>0){for(var m=0;m<c.length;m++){var a=c[m];if(a.isViewable()&&(q===undefined||!q.selectableLevels||q.selectableLevels.indexOf(a.getName())>=0)){var h=document.createElement("option");h.text=a.getName();h.level=a;s.add(h);if(a===o.getSelectedLevel()){s.selectedIndex=m}}}if(s.options.length>1){s.addEventListener("change",function(){p.startRotationAnimationAfterLoading=false;o.setSelectedLevel(s.options[s.selectedIndex].level)});s.style.visibility="visible"}}}if(f){o.setCamera(o.getTopCamera());var j=this.getController();j.rotateCameraPitch(Math.PI/6-o.getCamera().getPitch());j.moveCamera(10000);j.moveCamera(-50);this.clickListener=function(i){p.startRotationAnimationAfterLoading=false;p.stopRotationAnimation()};b.addEventListener("keydown",this.clickListener);if(window.PointerEvent){b.addEventListener("pointerdown",this.clickListener);b.addEventListener("pointermove",this.clickListener)}else{b.addEventListener("mousedown",this.clickListener);b.addEventListener("touchstart",this.clickListener);b.addEventListener("touchmove",this.clickListener)}var g=this.component3D.getSimulatedKeyElements(document.getElementsByTagName("body").item(0));for(var m=0;m<g.length;m++){if(window.PointerEvent){g[m].addEventListener("pointerdown",this.clickListener)}else{g[m].addEventListener("mousedown",this.clickListener)}}this.visibilityChanged=function(i){if(document.visibilityState=="hidden"){p.stopRotationAnimation()}};document.addEventListener("visibilitychange",this.visibilityChanged);document.getElementById(n).focus()}};HomePreviewComponent.prototype.getHome=function(){return this.home};HomePreviewComponent.prototype.getComponent3D=function(){return this.component3D};HomePreviewComponent.prototype.getController=function(){return this.controller};HomePreviewComponent.prototype.getUserPreferences=function(){return this.preferences};HomePreviewComponent.prototype.trackFurnitureModels=function(o,h){var u=[];var b={};var k={};var s=this.getHome();var m=s.getFurniture();for(var q=0;q<m.length;q++){var c=m[q];var f=[];if(c instanceof HomeFurnitureGroup){var g=c.getAllFurniture();for(var p=0;p<g.length;p++){var n=g[p];if(!(n instanceof HomeFurnitureGroup)){f.push(n)}}}else{f.push(c)}u.push.apply(u,f);for(var p=0;p<f.length;p++){var d=f[p].getModel();if(d.isJAREntry()){var e=d.getJAREntryURL();if(e in b){b[e]++}else{b[e]=1}}var t=d.getURL();if(t in k){k[t]++}else{k[t]=1}}}if(u.length===0){o(Node3D.READING_MODEL,undefined,1)}else{var a=0;var r=this;for(var q=0;q<u.length;q++){var l=function(i){ModelManager.getInstance().loadModel(i.getModel(),false,{modelUpdated:function(x){var j=i.getModel();if(j.isJAREntry()){var w=j.getJAREntryURL();if(--b[w]===0){ZIPTools.disposeZIP(w);delete b[w]}}var v=j.getURL();if(--k[v]===0){ModelManager.getInstance().unloadModel(j);delete k[v]}o(Node3D.READING_MODEL,i.getName(),++a/u.length);if(a===u.length){r.component3D.disposeGeometries();u=[];if(r.startRotationAnimationAfterLoading){delete r.startRotationAnimationAfterLoading;r.startRotationAnimation(h)}}},modelError:function(j){this.modelUpdated()},progression:function(){}})};l(u[q])}}};HomePreviewComponent.prototype.dispose=function(){this.stopRotationAnimation();if(this.component3D){if(this.clickListener){document.removeEventListener("visibilitychange",this.visibilityChanged);var b=this.component3D.getSimulatedKeyElements(document.getElementsByTagName("body").item(0));for(var a=0;a<b.length;a++){if(window.PointerEvent){b[a].removeEventListener("pointerdown",this.clickListener)}else{b[a].removeEventListener("mousedown",this.clickListener)}}}this.component3D.dispose()}};HomePreviewComponent.prototype.startRotationAnimation=function(a){this.roundsPerMinute=a!==undefined?a:1;if(!this.rotationAnimationStarted){this.rotationAnimationStarted=true;this.animate()}};HomePreviewComponent.prototype.animate=function(){if(this.rotationAnimationStarted){var b=Date.now();if(this.lastRotationAnimationTime!==undefined){var a=this.roundsPerMinute*2*Math.PI/60000;var d=((b-this.lastRotationAnimationTime)*a)%(2*Math.PI);d-=this.home.getCamera().getYaw()-this.lastRotationAnimationYaw;if(d>0){this.controller.rotateCameraYaw(d)}}this.lastRotationAnimationTime=b;this.lastRotationAnimationYaw=this.home.getCamera().getYaw();var c=this;requestAnimationFrame(function(){c.animate()})}};HomePreviewComponent.prototype.stopRotationAnimation=function(){delete this.lastRotationAnimationTime;delete this.lastRotationAnimationYaw;delete this.rotationAnimationStarted};